# 📦 部署指南

恭喜！你已经成功构建了电子书的静态文件。下面是几种发布方式。

## ✅ 构建状态

```
✓ 构建成功
✓ 生成了 19 个页面
✓ 静态文件位于 _book/ 目录
```

> ⚠️ 注意：构建过程中的 csv/assembly 语言警告可以忽略，不影响使用。

## 📂 构建产物

构建后的静态文件在 `_book/` 目录：

```
_book/
├── index.html          # 首页
├── gitbook/           # GitBook 资源文件
├── part1/             # 第一部分的 HTML 文件
├── part2/             # 第二部分的 HTML 文件
├── search_index.json  # 搜索索引
└── ...
```

## 🚀 部署方式

### 方式1：本地预览（已完成）

```bash
npm run serve
```

访问：http://localhost:4000

### 方式2：GitHub Pages（推荐，免费）

#### 步骤1：初始化 Git 仓库

```bash
git init
git add .
git commit -m "初始提交：AI 医学编程指南"
```

#### 步骤2：创建 GitHub 仓库

1. 访问 https://github.com/new
2. 创建新仓库（如：`ai-medical-programming-guide`）
3. 不要勾选 "Initialize this repository with a README"

#### 步骤3：推送代码

```bash
git remote add origin https://github.com/你的用户名/ai-medical-programming-guide.git
git branch -M main
git push -u origin main
```

#### 步骤4：部署到 GitHub Pages

**方法A：自动部署（推荐）**

创建 `.github/workflows/deploy.yml`：

```yaml
name: Deploy GitBook

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Build book
        run: npm run build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_book
```

推送后，GitHub Actions 会自动构建并部署。

**方法B：手动部署**

```bash
# 构建
npm run build

# 安装 gh-pages
npm install -g gh-pages

# 部署到 gh-pages 分支
gh-pages -d _book
```

#### 步骤5：启用 GitHub Pages

1. 进入仓库 Settings → Pages
2. Source 选择 `gh-pages` 分支
3. 保存后等待几分钟

访问：`https://你的用户名.github.io/ai-medical-programming-guide/`

---

### 方式3：Netlify（简单快速）

#### 步骤1：注册 Netlify

访问 https://www.netlify.com/ 注册（可用 GitHub 登录）

#### 步骤2：部署

1. 点击 "Add new site" → "Import an existing project"
2. 连接 GitHub 仓库
3. 配置构建设置：
   - **Build command**: `npm run build`
   - **Publish directory**: `_book`
4. 点击 "Deploy site"

几分钟后，你会得到一个 `xxx.netlify.app` 的网址。

#### 步骤3：自定义域名（可选）

1. 在 Netlify 控制台点击 "Domain settings"
2. 添加自定义域名
3. 按提示配置 DNS

---

### 方式4：Vercel（速度快）

#### 步骤1：注册 Vercel

访问 https://vercel.com/ 注册

#### 步骤2：导入项目

1. 点击 "New Project"
2. 导入 GitHub 仓库
3. 配置：
   - **Framework Preset**: Other
   - **Build Command**: `npm run build`
   - **Output Directory**: `_book`
4. 点击 "Deploy"

自动获得 `xxx.vercel.app` 域名。

---

### 方式5：导出 PDF

生成 PDF 电子书（需要 Calibre）：

#### 安装 Calibre

**macOS**:
```bash
brew install --cask calibre
```

**Windows**:
访问 https://calibre-ebook.com/download 下载安装

#### 生成 PDF

```bash
npm run pdf
```

生成的 `book.pdf` 文件可以分享给读者。

---

### 方式6：本地静态服务器

如果只想在本地快速查看构建结果：

```bash
# 方法1：使用 Python（已安装 Python）
cd _book
python -m http.server 8000

# 方法2：使用 npx
npx serve _book
```

访问：http://localhost:8000

---

## 📝 更新内容后的工作流

### 1. 修改 Markdown 文件

编辑 `part1/`, `part2/` 等目录中的 `.md` 文件

### 2. 本地预览

```bash
npm run serve
```

在浏览器中查看效果（自动刷新）

### 3. 构建并部署

```bash
# 构建
npm run build

# 推送到 GitHub（如果使用 GitHub Actions，会自动部署）
git add .
git commit -m "更新内容"
git push

# 或手动部署到 gh-pages
gh-pages -d _book
```

---

## 🔧 常见问题

### Q1: 构建时出现 "Unknown language" 警告

**原因**：某些代码块使用了不支持的语法高亮语言

**解决**：
- 可以忽略，不影响功能
- 或将 ` ```csv` 改为 ` ```text`
- 或将 ` ```assembly` 改为 ` ```asm`

### Q2: GitHub Pages 显示 404

**检查**：
1. 确认 gh-pages 分支存在
2. 确认 Settings → Pages 已启用
3. 等待 5-10 分钟让 DNS 生效
4. 清空浏览器缓存

### Q3: 本地预览很慢

**原因**：可能有后台多个服务在运行

**解决**：
```bash
# 杀掉所有 node 进程
pkill -f node

# 重新启动
npm run serve
```

### Q4: 如何自定义样式？

修改 `book.json`，添加自定义 CSS：

```json
{
  "styles": {
    "website": "styles/website.css"
  }
}
```

然后创建 `styles/website.css` 文件。

---

## 📊 推荐部署方案对比

| 方案 | 难度 | 速度 | 费用 | 自定义域名 | 推荐度 |
|------|------|------|------|-----------|--------|
| GitHub Pages | ⭐⭐ | 快 | 免费 | ✅ | ⭐⭐⭐⭐⭐ |
| Netlify | ⭐ | 很快 | 免费 | ✅ | ⭐⭐⭐⭐⭐ |
| Vercel | ⭐ | 很快 | 免费 | ✅ | ⭐⭐⭐⭐ |
| PDF | ⭐⭐⭐ | - | 免费 | - | ⭐⭐⭐ |

**新手推荐**：Netlify 或 GitHub Pages

---

## 🎯 下一步行动

1. **选择部署方式**（推荐 GitHub Pages 或 Netlify）
2. **完成部署**（按上述步骤操作）
3. **获取链接**（分享给读者）
4. **持续更新**（修改内容后重新构建）

---

## 📢 分享你的作品

部署完成后，你可以：

- ✅ 分享链接给医学同事
- ✅ 在医学论坛/社区推广
- ✅ 收集读者反馈
- ✅ 持续改进内容

**祝贺你完成了一本可能改变很多医学工作者职业生涯的书！** 🎉
