# 12.5 批量处理医学图像

## 批量处理的重要性

**场景**: 处理100个CT序列,每个50张图像
- 手工处理: 不可能完成
- 批量脚本: 10分钟

## 批量处理框架

```python
from pathlib import Path
from tqdm import tqdm

def batch_process_images(input_folder, output_folder, process_func):
    """批量处理图像"""

    # 获取所有DICOM文件
    dicom_files = list(Path(input_folder).rglob('*.dcm'))

    print(f"找到 {len(dicom_files)} 个文件")

    # 创建输出目录
    Path(output_folder).mkdir(parents=True, exist_ok=True)

    # 批量处理
    for dicom_file in tqdm(dicom_files, desc="处理中"):
        try:
            # 调用处理函数
            result = process_func(str(dicom_file))

            # 保存结果
            output_file = Path(output_folder) / f"{dicom_file.stem}.png"
            result.save(str(output_file))

        except Exception as e:
            print(f"⚠️ {dicom_file.name} 失败: {e}")

    print("\n✓ 批量处理完成")

# 使用示例
def my_process(dicom_path):
    processor = DICOMProcessor(dicom_path)
    return processor.apply_window(-600, 1500)

batch_process_images('dicom_folder', 'output_folder', my_process)
```

## 并行处理加速

```python
from multiprocessing import Pool

def parallel_process(input_files, process_func, n_workers=4):
    """并行处理"""
    with Pool(n_workers) as pool:
        results = list(tqdm(
            pool.imap(process_func, input_files),
            total=len(input_files)
        ))
    return results
```

## 下一步

[12.6 完整案例](12.6-complete-case.md) - CT影像分析工具
