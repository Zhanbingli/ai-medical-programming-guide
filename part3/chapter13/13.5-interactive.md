# 13.5 交互式可视化

## 为什么需要交互式图表?

**静态图 vs 交互图**:

```
静态图(Matplotlib):
- 固定视角
- 无法缩放
- 适合论文

交互图(Plotly):
- 可缩放、拖拽
- 悬停显示数值
- 适合展示、汇报
```

## Plotly快速入门

### 安装

```bash
pip install plotly kaleido
```

### 基础示例

```python
import plotly.graph_objects as go
import numpy as np

# 数据
x = np.linspace(0, 10, 100)
y = np.sin(x)

# 创建图表
fig = go.Figure()
fig.add_trace(go.Scatter(x=x, y=y, mode='lines', name='sin(x)'))

fig.update_layout(
    title='交互式折线图',
    xaxis_title='X轴',
    yaxis_title='Y轴',
    hovermode='x unified'
)

# 显示
fig.show()

# 保存为HTML
fig.write_html('interactive_plot.html')

# 保存为静态图
fig.write_image('plot.png', width=800, height=600, scale=2)
```

### 柱状图

```python
import plotly.express as px
import pandas as pd

df = pd.DataFrame({
    '药物': ['A药', 'B药', 'C药'],
    '疗效': [15.2, 10.8, 12.5],
    '标准差': [3.5, 3.2, 3.8]
})

fig = px.bar(df, x='药物', y='疗效', error_y='标准差',
             title='三种药物疗效对比')

fig.show()
```

### 散点图+回归线

```python
fig = px.scatter(df, x='年龄', y='血压',
                trendline='ols',  # 添加回归线
                title='年龄与血压关系')

fig.show()
```

## Streamlit集成

```python
import streamlit as st
import plotly.express as px

st.title("交互式数据可视化")

# 用户选择
chart_type = st.selectbox("选择图表类型", ["散点图", "柱状图", "箱线图"])

if chart_type == "散点图":
    fig = px.scatter(df, x='年龄', y='血压')
elif chart_type == "柱状图":
    fig = px.bar(df, x='分组', y='血压')
else:
    fig = px.box(df, x='分组', y='血压')

# 显示交互图
st.plotly_chart(fig, use_container_width=True)
```

## 高级功能

### 1. 动画

```python
fig = px.scatter(df, x='年龄', y='血压',
                animation_frame='月份',  # 按月份动画
                size='BMI',
                color='分组')

fig.show()
```

### 2. 3D图

```python
fig = go.Figure(data=[go.Scatter3d(
    x=x, y=y, z=z,
    mode='markers',
    marker=dict(size=5, color=z, colorscale='Viridis')
)])

fig.show()
```

### 3. 热图

```python
fig = px.imshow(corr_matrix,
                labels=dict(color="相关系数"),
                x=columns,
                y=columns,
                color_continuous_scale='RdBu_r')

fig.show()
```

## 完整示例

见GitHub仓库中的`interactive_visualization.py`

## 下一步

[13.6 完整案例](13.6-complete-case.md) - 临床试验数据完整可视化
