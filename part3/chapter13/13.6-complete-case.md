# 13.6 完整案例:临床试验数据可视化

## 项目目标

为一个临床试验创建完整的数据可视化报告。

## 数据

```
trial_data.xlsx:
- 100位患者
- A药组 vs B药组
- 基线和随访数据
```

## 需要的图表

```
Figure 1: 患者入组流程图
Figure 2: 基线特征对比(Table 1可视化)
Figure 3: 主要疗效指标对比
Figure 4: 次要疗效指标(多子图)
Figure 5: 不良事件分析
Figure 6: 亚组分析(森林图)
```

## 完整代码框架

```python
"""
临床试验数据完整可视化
"""

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

# 设置论文级样式
plt.rcParams.update({
    'figure.dpi': 300,
    'font.size': 12,
    'font.family': 'Arial',
    'axes.linewidth': 1.5
})

class TrialVisualizer:
    """临床试验可视化工具"""

    def __init__(self, data_file):
        self.df = pd.read_excel(data_file)

    def create_figure1_flowchart(self):
        """Figure 1: 患者入组流程图"""
        # 使用matplotlib绘制流程图
        # 代码见GitHub
        pass

    def create_figure2_baseline(self):
        """Figure 2: 基线特征可视化"""
        fig, axes = plt.subplots(2, 2, figsize=(12, 10))

        # (A) 年龄分布
        sns.violinplot(data=self.df, x='分组', y='年龄', ax=axes[0,0])

        # (B) 性别分布
        # ... 代码

        # (C) BMI分布
        # ... 代码

        # (D) 合并症
        # ... 代码

        plt.tight_layout()
        plt.savefig('Figure2.png', dpi=600)

    def create_figure3_primary_outcome(self):
        """Figure 3: 主要疗效对比"""
        # 柱状图 + 误差棒 + P值
        # 代码见GitHub
        pass

    def create_figure4_secondary_outcomes(self):
        """Figure 4: 次要疗效(4x4子图)"""
        fig, axes = plt.subplots(2, 2, figsize=(12, 10))
        # 多个次要指标
        # 代码见GitHub
        pass

    def create_figure5_adverse_events(self):
        """Figure 5: 不良事件分析"""
        # 堆叠柱状图
        # 代码见GitHub
        pass

    def create_figure6_subgroup(self):
        """Figure 6: 亚组分析森林图"""
        # 森林图(Forest Plot)
        # 代码见GitHub
        pass

    def generate_all_figures(self):
        """生成所有图表"""
        print("生成Figure 1...")
        self.create_figure1_flowchart()

        print("生成Figure 2...")
        self.create_figure2_baseline()

        print("生成Figure 3...")
        self.create_figure3_primary_outcome()

        print("生成Figure 4...")
        self.create_figure4_secondary_outcomes()

        print("生成Figure 5...")
        self.create_figure5_adverse_events()

        print("生成Figure 6...")
        self.create_figure6_subgroup()

        print("\n✓ 所有图表生成完成!")

# 使用
if __name__ == "__main__":
    viz = TrialVisualizer('trial_data.xlsx')
    viz.generate_all_figures()
```

## 生成报告

```python
from docx import Document
from docx.shared import Inches

def create_figure_report():
    """生成图表说明文档"""

    doc = Document()

    doc.add_heading('临床试验数据可视化报告', 0)

    # Figure 1
    doc.add_heading('Figure 1. 患者入组流程图', 1)
    doc.add_picture('Figure1.png', width=Inches(6))
    doc.add_paragraph(
        '共筛选120位患者,最终纳入100位(A药组50位,B药组50位)。'
    )

    # Figure 2
    doc.add_heading('Figure 2. 患者基线特征', 1)
    doc.add_picture('Figure2.png', width=Inches(6))
    doc.add_paragraph(
        '(A) 年龄分布; (B) 性别分布; (C) BMI分布; (D) 合并症情况。'
    )

    # ... 其他图表

    doc.save('数据可视化报告.docx')
    print("✓ 报告已生成")
```

## 完整代码

详见GitHub仓库: `part3/chapter13/complete_visualization.py`

## 恭喜!

完成第13章,你已经掌握:
✅ Matplotlib绘图
✅ Seaborn统计图
✅ 论文级图表制作
✅ 交互式可视化
✅ 完整项目实践

## 第三部分总结

通过第9-13章,你学会了:

### 第9章: 文献管理自动化
- PubMed API
- PDF元数据提取
- AI文献总结

### 第10章: 临床数据处理
- 数据清洗
- 统计分析
- 假设检验

### 第11章: 病例管理系统
- SQLite数据库
- Streamlit Web开发
- 完整系统架构

### 第12章: 医学图像处理
- DICOM处理
- 图像预处理
- 批量处理

### 第13章: 科研数据可视化
- 论文级图表
- 交互式可视化
- 完整报告生成

---

## 🎉 全书完成!

你已经完成了《AI辅助医学编程》全部内容!

### 下一步建议

1. **实践项目**: 选择一个真实的医学问题,用学到的技能解决
2. **深入学习**: 根据兴趣选择专题深入(机器学习、生信、影像AI)
3. **分享经验**: 将你的项目分享给同事,帮助更多医生
4. **持续更新**: 关注AI最新进展,不断优化工作流程

### 获取帮助

- GitHub Issues: 提问和反馈
- 社区交流: 加入医学AI编程社区
- AI助手: Claude、ChatGPT随时帮你解决问题

**祝你在AI辅助医学编程的道路上越走越远! 🚀**
