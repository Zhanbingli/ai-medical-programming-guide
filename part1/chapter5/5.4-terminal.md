# 5.4 终端/命令行基础

## 为什么医生需要了解终端?

终端(Terminal)或命令行(Command Line),听起来很"极客",但实际上是**最高效的工具**之一。

### 医学类比

```
图形界面(GUI)  =  手工操作: 一个一个点击,适合单次操作
命令行(CLI)    =  自动化流程: 一次命令批量处理,适合重复任务
```

### 实际场景

**场景1: 批量重命名100个DICOM文件**
- GUI方式: 右键→重命名,重复100次 (😰 20分钟)
- 终端方式: 一行命令 (😎 5秒)

**场景2: 安装Python库**
- GUI方式: 下载安装包→点击安装→配置路径... (复杂)
- 终端方式: `pip install pandas` (简单)

**场景3: 运行AI生成的数据分析脚本**
- 很多AI工具生成的代码需要在终端运行
- 看懂基本命令 = 能顺利执行AI的建议

## 打开终端

### Mac用户

**方法1**: Spotlight搜索
- 按 `Cmd + Space`
- 输入 "Terminal"
- 回车

**方法2**: Finder
- `应用程序` → `实用工具` → `终端`

**方法3**: 推荐使用iTerm2 (功能更强大)
- 下载: https://iterm2.com

### Windows用户

**推荐: Anaconda Prompt** (已随Anaconda安装)
- `开始菜单` → `Anaconda3` → `Anaconda Prompt`

**原因**:
- 自动配置好Python环境
- 支持conda和pip命令
- 比Windows默认CMD更好用

**其他选择**:
- PowerShell: `开始菜单` → 搜索 "PowerShell"
- Windows Terminal: Microsoft Store搜索安装(现代化,推荐)

### VSCode集成终端(最方便)

在VSCode中:
- 快捷键: `Ctrl + `` (反引号,Tab键上方)
- 或菜单: `View > Terminal`

**优势**:
- 不用切换窗口
- 自动定位到项目目录
- 支持分屏

## 终端界面认识

打开终端后,你会看到:

```bash
(base) username@MacBook-Pro ~ %
```

或(Windows):
```bash
(base) C:\Users\username>
```

**解读**:
```
(base)              ← 当前Python环境(Anaconda的base环境)
username            ← 你的用户名
@MacBook-Pro        ← 电脑名称
~                   ← 当前目录(~表示用户主目录)
%                   ← 提示符(准备接受命令)
```

光标闪烁位置 = 你输入命令的地方。

## 核心概念:目录和路径

### 目录结构

终端中的文件系统像一棵树:

```
Mac/Linux:                Windows:
/                         C:\
├── Users                 ├── Users
│   └── yourname          │   └── yourname
│       ├── Desktop       │       ├── Desktop
│       ├── Documents     │       ├── Documents
│       └── medical_data  │       └── medical_data
└── Applications          └── Program Files

~ = /Users/yourname       ~ = C:\Users\yourname
```

### 路径类型

**绝对路径**: 从根目录开始的完整路径
```bash
Mac:     /Users/yourname/medical_data/patients.csv
Windows: C:\Users\yourname\medical_data\patients.csv
```

**相对路径**: 从当前目录开始
```bash
当前目录在 medical_data/
./patients.csv              ← 当前目录下的文件
../Documents/report.pdf     ← 上级目录的Documents文件夹
data/2025/january.csv       ← 子目录下的文件
```

**特殊符号**:
- `~` : 用户主目录
- `.` : 当前目录
- `..` : 上级目录

## 必备命令(Mac/Linux)

### 1. 查看当前位置: `pwd`

```bash
pwd
# 输出: /Users/yourname/medical_projects
```

全称: **P**rint **W**orking **D**irectory

### 2. 列出文件: `ls`

```bash
# 基本用法
ls
# 输出: patients.csv  analysis.py  data/

# 显示详细信息
ls -l
# 输出:
# -rw-r--r--  1 user  staff  1024 Jan 15 10:30 patients.csv
# drwxr-xr-x  3 user  staff    96 Jan 15 09:00 data/

# 显示隐藏文件(以.开头的文件)
ls -a

# 人类可读的文件大小
ls -lh
# 输出: -rw-r--r--  1 user  staff  1.0K Jan 15 10:30 patients.csv
```

全称: **L**i**s**t

### 3. 切换目录: `cd`

```bash
# 进入某个目录
cd medical_projects
cd Documents/research
cd /Users/yourname/Desktop

# 返回上级目录
cd ..

# 返回用户主目录
cd ~
# 或直接
cd

# 返回上一次所在目录
cd -
```

全称: **C**hange **D**irectory

### 4. 创建目录: `mkdir`

```bash
# 创建单个目录
mkdir new_project

# 创建多级目录
mkdir -p projects/2025/january
# -p 参数:如果父目录不存在,自动创建
```

全称: **M**a**k**e **Dir**ectory

### 5. 复制文件: `cp`

```bash
# 复制文件
cp patients.csv patients_backup.csv

# 复制到其他目录
cp analysis.py ~/Desktop/

# 复制整个目录(含子文件)
cp -r data/ backup/
```

全称: **C**o**p**y

### 6. 移动/重命名: `mv`

```bash
# 重命名
mv old_name.csv new_name.csv

# 移动文件
mv file.csv ~/Documents/

# 移动并重命名
mv old.csv ~/Desktop/new.csv
```

全称: **M**o**v**e

### 7. 删除: `rm`

```bash
# 删除文件
rm unwanted.csv

# 删除目录及其所有内容(谨慎使用!)
rm -r folder_name

# 删除前确认
rm -i file.csv
# 会提示: remove file.csv? (y/n)
```

⚠️ **警告**: 终端删除**没有回收站**,删除后无法恢复!

全称: **R**e**m**ove

### 8. 查看文件内容: `cat` / `head` / `tail`

```bash
# 显示完整文件内容
cat patients.csv

# 只显示前10行
head patients.csv

# 只显示前5行
head -n 5 patients.csv

# 显示后10行
tail patients.csv

# 实时查看文件更新(如日志)
tail -f logfile.txt
```

### 9. 查找文件: `find`

```bash
# 在当前目录查找所有.csv文件
find . -name "*.csv"

# 在指定目录查找
find ~/Documents -name "patient*"

# 查找最近7天修改的文件
find . -mtime -7
```

### 10. 搜索文件内容: `grep`

```bash
# 在文件中搜索包含"高血压"的行
grep "高血压" patients.csv

# 忽略大小写
grep -i "Hypertension" patients.csv

# 搜索多个文件
grep "糖尿病" *.csv

# 显示行号
grep -n "异常" report.txt
```

## Windows特定命令(CMD/PowerShell)

很多命令与Mac/Linux不同:

| 功能 | Mac/Linux | Windows CMD |
|------|-----------|-------------|
| 列出文件 | `ls` | `dir` |
| 查看当前目录 | `pwd` | `cd` (无参数) |
| 切换目录 | `cd` | `cd` |
| 创建目录 | `mkdir` | `mkdir` |
| 复制文件 | `cp` | `copy` |
| 复制目录 | `cp -r` | `xcopy /E` |
| 删除文件 | `rm` | `del` |
| 删除目录 | `rm -r` | `rmdir /S` |
| 查看文件 | `cat` | `type` |
| 清屏 | `clear` | `cls` |

**推荐**: Windows用户使用 **Git Bash** 或 **Windows Terminal + WSL**,可以使用Unix风格命令。

## Python相关命令

### 1. 检查Python版本

```bash
python --version
# 或
python3 --version

# 输出: Python 3.11.5
```

### 2. 运行Python脚本

```bash
# 运行.py文件
python analysis.py

# 进入交互式Python环境
python

# 退出交互环境
exit()  # 或按 Ctrl+D (Mac) / Ctrl+Z (Windows)
```

### 3. 安装Python包

```bash
# 使用pip安装
pip install pandas

# 安装特定版本
pip install numpy==1.24.0

# 从requirements.txt批量安装
pip install -r requirements.txt

# 查看已安装的包
pip list

# 升级包
pip install --upgrade pandas
```

### 4. 使用conda

```bash
# 查看conda版本
conda --version

# 查看环境列表
conda env list

# 激活环境
conda activate myenv

# 退出环境
conda deactivate

# 安装包
conda install pandas

# 搜索包
conda search scikit-learn
```

## 实用技巧

### 1. 自动补全(Tab键)

```bash
cd Docu[按Tab]
# 自动补全为: cd Documents/

cd med[按Tab]
# 自动补全为: cd medical_projects/
```

**如果有多个匹配项**:
- Mac/Linux: 按两次Tab显示所有选项
- Windows: 多次按Tab轮询选项

### 2. 历史命令

```bash
# 上/下箭头: 浏览之前执行过的命令

# 查看历史记录
history

# 搜索历史命令
Ctrl + R (然后输入关键词)

# 重复执行上一条命令
!!

# 重复执行第N条历史命令
!123
```

### 3. 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + C` | 中断当前命令/程序 |
| `Ctrl + D` | 退出当前会话 |
| `Ctrl + L` | 清屏(或输入`clear`) |
| `Ctrl + A` | 光标移到行首 |
| `Ctrl + E` | 光标移到行尾 |
| `Ctrl + U` | 删除光标前的所有字符 |
| `Ctrl + K` | 删除光标后的所有字符 |
| `Ctrl + W` | 删除光标前的一个单词 |

### 4. 管道和重定向

```bash
# 将输出保存到文件(覆盖)
ls > file_list.txt

# 追加到文件末尾
ls >> file_list.txt

# 将一个命令的输出作为另一个命令的输入(管道)
cat patients.csv | grep "高血压"

# 链式处理
cat data.csv | grep "张" | sort > result.txt
```

### 5. 后台运行

```bash
# 在后台运行长时间任务
python long_running_script.py &

# 查看后台任务
jobs

# 前台化某个任务
fg %1
```

## 实战案例

### 案例1: 组织医学项目文件

```bash
# 创建项目结构
mkdir -p medical_analysis/{data,scripts,results,figures}

# 验证
ls medical_analysis/
# 输出: data/  scripts/  results/  figures/

# 进入项目
cd medical_analysis

# 查看当前位置
pwd
# 输出: /Users/yourname/medical_analysis
```

### 案例2: 批量处理CSV文件

```bash
# 查看所有CSV文件
ls *.csv

# 统计每个CSV文件的行数
wc -l *.csv

# 合并所有CSV文件(保留一个标题行)
head -n 1 patient_001.csv > all_patients.csv
tail -n +2 -q patient_*.csv >> all_patients.csv

# 验证
wc -l all_patients.csv
```

### 案例3: 搜索特定患者数据

```bash
# 在所有CSV中搜索患者ID
grep "P12345" *.csv

# 搜索并显示文件名和行号
grep -Hn "高血压" medical_records/*.txt

# 统计匹配数量
grep -c "糖尿病" patients.csv
```

### 案例4: 备份重要数据

```bash
# 创建带日期的备份
cp important_data.csv important_data_$(date +%Y%m%d).csv

# 输出类似: important_data_20250115.csv

# 压缩备份
tar -czf backup_$(date +%Y%m%d).tar.gz data/

# 查看压缩包内容
tar -tzf backup_20250115.tar.gz
```

## AI生成代码中的终端命令

当你向ChatGPT等AI工具请求帮助时,它们经常会给出终端命令:

### 示例1: AI建议安装库

```
AI: 你需要先安装必要的库:

pip install pandas matplotlib seaborn
```

**你应该**:
1. 打开终端
2. 复制粘贴这行命令
3. 按回车执行

### 示例2: AI建议运行脚本

```
AI: 将代码保存为 analyze.py,然后在终端运行:

python analyze.py --input data.csv --output results/
```

**理解命令**:
- `python analyze.py`: 运行Python脚本
- `--input data.csv`: 传递输入文件参数
- `--output results/`: 传递输出目录参数

### 示例3: AI建议配置环境

```
AI: 创建虚拟环境并安装依赖:

conda create -n medical_analysis python=3.11
conda activate medical_analysis
pip install -r requirements.txt
```

**逐行执行**:
1. 创建新环境
2. 激活环境
3. 安装依赖包

## 常见问题

### Q1: 提示"command not found"

**原因**: 命令不存在或未安装

**解决**:
```bash
# 检查是否拼写错误
# Python可能叫python3
python3 --version

# 检查是否安装
which python
# 如果无输出 = 未安装
```

### Q2: 提示"Permission denied"

**原因**: 没有权限

**解决**:
```bash
# 添加sudo(Mac/Linux,需要输入密码)
sudo command_name

# 或修改文件权限
chmod +x script.py
```

### Q3: 无法删除"目录非空"

**原因**: `rm` 无法直接删除目录

**解决**:
```bash
rm -r directory_name  # 递归删除
```

### Q4: 中文文件名显示乱码(Windows)

**解决**:
```bash
# 在CMD中设置UTF-8编码
chcp 65001
```

### Q5: 路径中有空格

```bash
# 使用引号包裹
cd "My Documents"

# 或使用反斜杠转义
cd My\ Documents
```

## 实战练习

### 练习1: 基本导航

1. 查看当前目录
2. 进入Documents文件夹
3. 列出所有文件
4. 返回用户主目录

### 练习2: 文件操作

1. 创建目录 `terminal_practice`
2. 在该目录创建文件 `test.txt` (用`touch test.txt`)
3. 复制文件为 `test_backup.txt`
4. 查看目录内容
5. 删除 `test_backup.txt`

### 练习3: Python环境

1. 检查Python版本
2. 检查pip版本 (`pip --version`)
3. 查看已安装的包 (`pip list`)
4. (可选)尝试进入Python交互环境并退出

### 练习4: 综合应用

创建一个医学项目结构:
```bash
mkdir -p my_project/{data/{raw,processed},scripts,output}
cd my_project
ls -R  # 递归显示所有目录
```

## 检查清单

- [ ] 能够打开终端
- [ ] 理解目录和路径的概念
- [ ] 掌握基本导航命令(pwd, ls, cd)
- [ ] 能够创建、复制、移动、删除文件和目录
- [ ] 会使用Tab自动补全
- [ ] 会使用上下箭头查看历史命令
- [ ] 能够运行Python脚本
- [ ] 能够使用pip安装Python包
- [ ] 理解AI生成的终端命令并能执行
- [ ] (Windows用户)熟悉CMD和PowerShell的区别

## 下一步

- **5.5 包管理**: 深入学习pip和conda
- **5.7 Git基础**: 终端中使用版本控制
- **第7章**: AI工具(如Cursor)会在终端中运行命令

## 进阶资源

- Mac用户: iTerm2配置 https://iterm2.com
- Windows用户: Windows Terminal https://aka.ms/terminal
- 在线练习: https://www.learnshell.org
- 命令速查表: https://www.git-tower.com/blog/command-line-cheat-sheet/
