# 3.4 Python基础语法速成

> 本节是第2章编程思维的Python实现版,重点是语法细节和实战应用。

## 内容概览

本节涵盖Python核心语法:
- 变量与赋值
- 字符串操作(处理病历文本)
- 列表与字典(患者数据结构)
- 文件读写(处理.txt和.csv)

## 1. 变量与赋值

### 1.1 动态类型

Python是动态类型语言,变量类型自动推断:

```python
# 不需要声明类型
age = 45  # 自动识别为int
temperature = 37.2  # 自动识别为float
name = "张三"  # 自动识别为str

# 可以改变类型
x = 10  # int
x = "现在是字符串"  # str
x = [1, 2, 3]  # list
```

### 1.2 多重赋值

```python
# 同时赋值多个变量
systolic, diastolic = 140, 90
print(f"血压: {systolic}/{diastolic}")

# 交换变量
a, b = 1, 2
a, b = b, a  # 交换!
print(a, b)  # 2 1

# 解包列表
bp_readings = [140, 90]
systolic, diastolic = bp_readings
```

### 1.3 增强赋值运算符

```python
# 累加
count = 0
count += 1  # 等价于 count = count + 1
count += 5  # count = 6

# 其他运算符
total = 100
total -= 10  # total = 90
total *= 2   # total = 180
total /= 3   # total = 60.0
total //= 7  # total = 8.0 (整除)
total %= 3   # total = 2.0 (取余)
```

## 2. 字符串操作

### 2.1 字符串创建

```python
# 单引号和双引号等价
name1 = 'Zhang San'
name2 = "Zhang San"

# 三引号:多行字符串
diagnosis = """
患者主诉:
头痛、发热3天,
伴有咽痛。
"""

# 转义字符
text = "第一行\n第二行"  # \n 换行
path = "C:\\Users\\Desktop"  # \\ 反斜杠
quote = "他说:\"你好\""  # \" 双引号

# 原始字符串(忽略转义)
path = r"C:\Users\Desktop"  # r前缀
```

### 2.2 字符串格式化

```python
name = "张三"
age = 45
glucose = 7.2

# 方法1: f-string(Python 3.6+,推荐)
report = f"患者{name},{age}岁,血糖{glucose}mmol/L"

# 方法2: format()
report = "患者{},{} 岁,血糖{}mmol/L".format(name, age, glucose)
report = "患者{n},{a}岁,血糖{g}mmol/L".format(n=name, a=age, g=glucose)

# 方法3: %格式化(旧式)
report = "患者%s,%d岁,血糖%.1fmmol/L" % (name, age, glucose)

# 格式化选项
pi = 3.14159
print(f"{pi:.2f}")  # 3.14 (保留2位小数)
print(f"{pi:10.2f}")  # "      3.14" (总宽度10,右对齐)
print(f"{pi:<10.2f}")  # "3.14      " (左对齐)
print(f"{pi:^10.2f}")  # "   3.14   " (居中)

number = 42
print(f"{number:05d}")  # 00042 (补零到5位)
```

### 2.3 字符串方法

```python
diagnosis = "Type 2 Diabetes Mellitus"

# 大小写转换
print(diagnosis.upper())  # TYPE 2 DIABETES MELLITUS
print(diagnosis.lower())  # type 2 diabetes mellitus
print(diagnosis.title())  # Type 2 Diabetes Mellitus
print(diagnosis.capitalize())  # Type 2 diabetes mellitus

# 查找和替换
print(diagnosis.find("Diabetes"))  # 7 (首次出现位置)
print(diagnosis.count("e"))  # 4 (出现次数)
print(diagnosis.replace("Type 2", "2型"))  # 2型 Diabetes Mellitus

# 分割和连接
words = diagnosis.split(" ")  # ['Type', '2', 'Diabetes', 'Mellitus']
new_text = "-".join(words)  # Type-2-Diabetes-Mellitus

# 去除空格
text = "  高血压  "
print(text.strip())  # "高血压"
print(text.lstrip())  # "高血压  "
print(text.rstrip())  # "  高血压"

# 判断
print("123".isdigit())  # True
print("abc".isalpha())  # True
print("abc123".isalnum())  # True
print(diagnosis.startswith("Type"))  # True
print(diagnosis.endswith("Mellitus"))  # True
```

### 2.4 字符串切片

```python
patient_id = "MED-2025-001-12345"

# 基本切片 [start:end:step]
print(patient_id[0:3])  # MED
print(patient_id[4:8])  # 2025
print(patient_id[-5:])  # 12345 (最后5个字符)

# 省略参数
print(patient_id[:3])  # MED (从开头)
print(patient_id[4:])  # 2025-001-12345 (到结尾)
print(patient_id[:])  # 完整复制

# 步长
print(patient_id[::2])  # ME-05001245 (每隔一个)
print(patient_id[::-1])  # 54321-100-5202-DEM (反转)
```

## 3. 列表操作

### 3.1 列表创建和访问

```python
# 创建列表
glucose_levels = [6.2, 5.8, 6.5, 7.1, 6.0]
medications = ["阿司匹林", "二甲双胍", "阿托伐他汀"]
mixed = [1, "text", 3.14, True]  # 可以混合类型

# 访问元素
print(medications[0])  # 阿司匹林 (第一个)
print(medications[-1])  # 阿托伐他汀 (最后一个)
print(medications[1:3])  # ['二甲双胍', '阿托伐他汀']

# 修改元素
medications[1] = "格列美脲"
print(medications)  # ['阿司匹林', '格列美脲', '阿托伐他汀']
```

### 3.2 列表方法

```python
medications = ["阿司匹林", "二甲双胍"]

# 添加元素
medications.append("阿托伐他汀")  # 末尾添加
medications.insert(1, "氯吡格雷")  # 指定位置插入
medications.extend(["辛伐他汀", "贝那普利"])  # 批量添加

# 删除元素
medications.remove("二甲双胍")  # 删除指定元素
last = medications.pop()  # 删除并返回最后一个
second = medications.pop(1)  # 删除并返回索引1的元素
del medications[0]  # 删除索引0的元素
medications.clear()  # 清空列表

# 其他操作
glucose = [6.2, 5.8, 6.5, 7.1, 6.0, 5.9]
print(len(glucose))  # 6 (长度)
print(max(glucose))  # 7.1 (最大值)
print(min(glucose))  # 5.8 (最小值)
print(sum(glucose))  # 38.5 (总和)
print(glucose.count(6.2))  # 1 (6.2出现次数)
print(glucose.index(7.1))  # 3 (7.1的索引)

# 排序
glucose.sort()  # 原地排序(从小到大)
glucose.sort(reverse=True)  # 降序
sorted_glucose = sorted(glucose)  # 返回新列表,原列表不变
glucose.reverse()  # 反转列表
```

### 3.3 列表推导式

```python
# 基本形式
squares = [x**2 for x in range(1, 6)]  # [1, 4, 9, 16, 25]

# 带条件
glucose = [6.2, 5.8, 6.5, 7.1, 6.0, 8.2]
high_glucose = [g for g in glucose if g > 7.0]  # [7.1, 8.2]

# 转换
celsius = [36.5, 37.2, 38.5, 39.1]
fahrenheit = [c * 9/5 + 32 for c in celsius]

# 嵌套
matrix = [[1, 2, 3], [4, 5, 6]]
flat = [num for row in matrix for num in row]  # [1, 2, 3, 4, 5, 6]

# 带if-else
glucose = [6.2, 5.8, 6.5, 7.1]
status = ["正常" if g < 7.0 else "偏高" for g in glucose]
```

## 4. 字典操作

### 4.1 字典创建和访问

```python
# 创建字典
patient = {
    "name": "张三",
    "age": 45,
    "diagnosis": "高血压"
}

# 访问值
print(patient["name"])  # 张三
print(patient.get("name"))  # 张三
print(patient.get("phone", "未登记"))  # 未登记 (默认值)

# 修改和添加
patient["age"] = 46  # 修改
patient["phone"] = "13800138000"  # 添加新键

# 删除
del patient["phone"]  # 删除键
age = patient.pop("age")  # 删除并返回值
patient.clear()  # 清空
```

### 4.2 字典方法

```python
patient = {
    "name": "张三",
    "age": 45,
    "diagnosis": "高血压",
    "medications": ["阿司匹林", "氯沙坦"]
}

# 获取键、值、键值对
print(patient.keys())  # dict_keys(['name', 'age', ...])
print(patient.values())  # dict_values(['张三', 45, ...])
print(patient.items())  # dict_items([('name', '张三'), ...])

# 遍历
for key in patient:
    print(f"{key}: {patient[key]}")

for key, value in patient.items():
    print(f"{key}: {value}")

# 检查键是否存在
if "name" in patient:
    print("有姓名记录")

# 更新(合并字典)
patient.update({"weight": 70, "height": 1.75})
```

### 4.3 嵌套字典

```python
# 复杂结构
patients = {
    "P001": {
        "name": "张三",
        "age": 45,
        "vitals": {
            "bp": {"systolic": 140, "diastolic": 90},
            "temp": 37.2,
            "hr": 75
        },
        "medications": ["阿司匹林", "氯沙坦"]
    },
    "P002": {
        "name": "李四",
        "age": 52,
        "vitals": {
            "bp": {"systolic": 145, "diastolic": 92},
            "temp": 36.8,
            "hr": 80
        },
        "medications": ["二甲双胍"]
    }
}

# 访问嵌套数据
print(patients["P001"]["name"])  # 张三
print(patients["P001"]["vitals"]["bp"]["systolic"])  # 140
print(patients["P002"]["medications"][0])  # 二甲双胍
```

## 5. 文件读写

### 5.1 读取文本文件

```python
# 方法1: 一次读取全部
with open("patient_record.txt", "r", encoding="utf-8") as f:
    content = f.read()
    print(content)

# 方法2: 逐行读取
with open("patient_record.txt", "r", encoding="utf-8") as f:
    for line in f:
        print(line.strip())  # strip()去除换行符

# 方法3: 读取所有行到列表
with open("patient_record.txt", "r", encoding="utf-8") as f:
    lines = f.readlines()  # 返回列表
    for line in lines:
        print(line.strip())
```

### 5.2 写入文本文件

```python
# 写入(覆盖原文件)
with open("output.txt", "w", encoding="utf-8") as f:
    f.write("患者姓名: 张三\n")
    f.write("年龄: 45岁\n")

# 追加(不覆盖)
with open("output.txt", "a", encoding="utf-8") as f:
    f.write("诊断: 高血压\n")

# 写入多行
lines = ["姓名: 张三\n", "年龄: 45岁\n", "诊断: 高血压\n"]
with open("output.txt", "w", encoding="utf-8") as f:
    f.writelines(lines)
```

### 5.3 CSV文件处理

```python
import csv

# 读取CSV
with open("patients.csv", "r", encoding="utf-8") as f:
    reader = csv.reader(f)
    header = next(reader)  # 读取表头
    for row in reader:
        print(row)  # row是列表

# 使用字典读取
with open("patients.csv", "r", encoding="utf-8") as f:
    reader = csv.DictReader(f)
    for row in reader:
        print(row["姓名"], row["年龄"])  # row是字典

# 写入CSV
data = [
    ["姓名", "年龄", "诊断"],
    ["张三", 45, "高血压"],
    ["李四", 52, "糖尿病"]
]

with open("output.csv", "w", encoding="utf-8", newline="") as f:
    writer = csv.writer(f)
    writer.writerows(data)

# 使用字典写入
patients = [
    {"姓名": "张三", "年龄": 45, "诊断": "高血压"},
    {"姓名": "李四", "年龄": 52, "诊断": "糖尿病"}
]

with open("output.csv", "w", encoding="utf-8", newline="") as f:
    fieldnames = ["姓名", "年龄", "诊断"]
    writer = csv.DictWriter(f, fieldnames=fieldnames)
    writer.writeheader()
    writer.writerows(patients)
```

## 6. 实战案例

### 案例1: 病历文本解析

```python
# 病历文本
medical_record = """
患者姓名: 张三
年龄: 45岁
性别: 男
主诉: 头痛、发热3天
体温: 38.5℃
血压: 140/90 mmHg
初步诊断: 上呼吸道感染
"""

# 解析信息
lines = medical_record.strip().split("\n")
patient_info = {}

for line in lines:
    if ":" in line:
        key, value = line.split(":", 1)  # 只分割一次
        patient_info[key.strip()] = value.strip()

# 输出
for key, value in patient_info.items():
    print(f"{key}: {value}")
```

### 案例2: 批量处理患者数据

```python
# 读取CSV文件
import csv

with open("patients.csv", "r", encoding="utf-8") as f:
    reader = csv.DictReader(f)
    patients = list(reader)

# 数据处理
high_bp_patients = []

for patient in patients:
    name = patient["姓名"]
    systolic = int(patient["收缩压"])
    diastolic = int(patient["舒张压"])

    # 筛选高血压患者
    if systolic >= 140 or diastolic >= 90:
        high_bp_patients.append({
            "姓名": name,
            "血压": f"{systolic}/{diastolic}",
            "分级": "1级高血压" if systolic < 160 else "2级高血压"
        })

# 生成报告
with open("high_bp_report.csv", "w", encoding="utf-8", newline="") as f:
    if high_bp_patients:
        writer = csv.DictWriter(f, fieldnames=["姓名", "血压", "分级"])
        writer.writeheader()
        writer.writerows(high_bp_patients)

print(f"筛查完成!发现{len(high_bp_patients)}名高血压患者")
```

### 案例3: 生成标准化病历

```python
def generate_medical_record(patient_info):
    """生成标准化病历"""

    template = """
{'='*60}
病历记录
{'='*60}

基本信息:
  姓名: {name}
  性别: {gender}
  年龄: {age}岁
  病历号: {patient_id}

主诉: {chief_complaint}

现病史: {history}

体格检查:
  体温: {temperature}°C
  血压: {bp}mmHg
  心率: {hr}次/分

初步诊断: {diagnosis}

处理意见: {treatment}

医师签名: {doctor}
日期: {date}
{'='*60}
"""

    return template.format(**patient_info)

# 使用示例
patient = {
    "name": "张三",
    "gender": "男",
    "age": 45,
    "patient_id": "MED-2025-001",
    "chief_complaint": "头痛、发热3天",
    "history": "患者3天前无明显诱因出现头痛、发热,最高体温38.5℃...",
    "temperature": 38.5,
    "bp": "140/90",
    "hr": 88,
    "diagnosis": "上呼吸道感染",
    "treatment": "1. 卧床休息\n  2. 多饮水\n  3. 退热药物对症处理",
    "doctor": "李医生",
    "date": "2025-01-15"
}

record = generate_medical_record(patient)
print(record)

# 保存到文件
with open(f"{patient['patient_id']}.txt", "w", encoding="utf-8") as f:
    f.write(record)
```

## 💡 关键要点

### Python语法特点

1. **简洁明了** - 接近自然语言
2. **缩进敏感** - 用缩进表示代码块
3. **动态类型** - 变量类型自动推断
4. **丰富的数据结构** - 列表、字典等内置

### 常用数据结构选择

| 需求 | 使用 |
|------|------|
| 有序集合,可重复 | list 列表 |
| 键值对,快速查找 | dict 字典 |
| 不可变序列 | tuple 元组 |
| 唯一值集合 | set 集合 |

### 文件操作要点

1. **始终使用with语句** - 自动关闭文件
2. **指定encoding="utf-8"** - 避免中文乱码
3. **CSV用csv模块** - 而不是手动split

## 下一步

掌握了Python基础语法后,下一节[必备标准库](3.5-standard-libraries.md)将学习常用的Python标准库!

---

## 🔨 实践练习

```python
# 练习1: 处理患者姓名列表
names = ["Zhang San", "Li Si", "Wang Wu"]
# 转换为大写,并用逗号连接

# 练习2: 统计血糖达标率
glucose_levels = [6.2, 5.8, 6.5, 7.1, 6.0, 8.2, 5.9, 7.5]
# 计算<7.0的百分比

# 练习3: 读取CSV并筛选
# 读取patients.csv,筛选年龄>60的患者,保存到elderly.csv

# 练习4: 病历模板填充
# 创建一个病历模板,用字典数据填充
```
