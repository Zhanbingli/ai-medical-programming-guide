# 3.2 环境搭建:Anaconda一键安装

## 为什么选择Anaconda?

### Python安装方式对比

| 安装方式 | 优点 | 缺点 | 推荐度 |
|---------|------|------|--------|
| **官方Python** | 纯净 | 需手动安装所有库 | ⭐⭐ |
| **Anaconda** | 一键安装,自带常用库 | 安装包较大(~500MB) | ⭐⭐⭐⭐⭐ |
| **Miniconda** | 轻量级 | 需要自己配置 | ⭐⭐⭐ |

**医学工作者强烈推荐Anaconda!**

### Anaconda的优势

✅ **一键安装** - 自动配置环境变量
✅ **自带常用库** - NumPy、Pandas、Matplotlib等开箱即用
✅ **Jupyter Notebook** - 交互式编程环境
✅ **环境管理** - 轻松管理不同项目的依赖
✅ **跨平台** - Windows/macOS/Linux通用
✅ **图形界面** - Anaconda Navigator,适合新手

## 安装步骤

### Step 1: 下载Anaconda

#### 1.1 访问官网

```
官方地址: https://www.anaconda.com/download
```

或使用清华镜像(国内速度更快):
```
清华镜像: https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/
```

#### 1.2 选择版本

**Windows用户**:
- 64位系统(推荐): `Anaconda3-2024.02-1-Windows-x86_64.exe`
- 32位系统: `Anaconda3-2024.02-1-Windows-x86.exe`

**macOS用户**:
- Intel芯片: `Anaconda3-2024.02-1-MacOSX-x86_64.pkg`
- Apple芯片(M1/M2): `Anaconda3-2024.02-1-MacOSX-arm64.pkg`

**Linux用户**:
- `Anaconda3-2024.02-1-Linux-x86_64.sh`

**查看系统位数**:
- Windows: 右键"此电脑" → 属性
- macOS: 点击  → 关于本机 → 处理器(Intel或Apple)

### Step 2: 安装Anaconda

#### Windows安装

1. **双击安装程序**
   ```
   Anaconda3-2024.02-1-Windows-x86_64.exe
   ```

2. **安装向导**
   - 点击 "Next"
   - 同意许可协议 "I Agree"
   - 选择 "Just Me" (推荐)
   - 选择安装路径(默认即可,或选择D盘)
     ```
     推荐路径: C:\Users\你的用户名\anaconda3
     或: D:\anaconda3
     ```

3. **重要选项** ⚠️
   - ✅ **勾选**: "Add Anaconda to my PATH environment variable"
     (虽然不推荐,但对新手更方便)
   - ✅ **勾选**: "Register Anaconda as my default Python"
   - 点击 "Install"

4. **等待安装**(约5-10分钟)

5. **完成**
   - 取消勾选 "Learn more about Anaconda"
   - 点击 "Finish"

#### macOS安装

1. **双击安装包**
   ```
   Anaconda3-2024.02-1-MacOSX-arm64.pkg
   ```

2. **安装向导**
   - 点击 "继续"
   - 同意许可协议
   - 选择安装位置(默认即可)
   - 点击 "安装"
   - 输入Mac密码

3. **等待安装**(约5-10分钟)

4. **完成**
   - 点击 "关闭"

#### Linux安装

```bash
# 下载安装脚本
wget https://repo.anaconda.com/archive/Anaconda3-2024.02-1-Linux-x86_64.sh

# 运行安装
bash Anaconda3-2024.02-1-Linux-x86_64.sh

# 按Enter阅读协议
# 输入yes同意
# 确认安装路径(默认~/anaconda3)
# 是否初始化Anaconda? yes

# 重启终端
source ~/.bashrc
```

### Step 3: 验证安装

#### 3.1 打开终端/命令提示符

**Windows**:
```
方法1: 开始菜单 → Anaconda3 → Anaconda Prompt
方法2: Win + R → 输入cmd → 回车
```

**macOS**:
```
方法1: 启动台 → 其他 → 终端
方法2: Cmd + 空格 → 输入terminal → 回车
```

**Linux**:
```
Ctrl + Alt + T
```

#### 3.2 检查Python版本

```bash
python --version
```

**预期输出**:
```
Python 3.11.7
```

或类似的3.x版本(只要是3.8+即可)

#### 3.3 检查conda

```bash
conda --version
```

**预期输出**:
```
conda 24.1.2
```

#### 3.4 检查常用库

```bash
python -c "import pandas; print(pandas.__version__)"
python -c "import numpy; print(numpy.__version__)"
python -c "import matplotlib; print(matplotlib.__version__)"
```

**如果都能输出版本号,说明安装成功!** ✅

### Step 4: 配置国内镜像(可选但强烈推荐)

由于国外服务器速度慢,配置国内镜像可以大幅提升下载速度。

#### 4.1 配置conda镜像

```bash
# 添加清华镜像
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --set show_channel_urls yes

# 查看配置
conda config --show channels
```

#### 4.2 配置pip镜像

创建配置文件:

**Windows**:
```
在C:\Users\你的用户名\目录下创建pip文件夹
在pip文件夹中创建pip.ini文件,内容:

[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
```

**macOS/Linux**:
```bash
mkdir -p ~/.pip
cat > ~/.pip/pip.conf << EOF
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
EOF
```

#### 4.3 测试镜像

```bash
# 安装一个小库测试速度
pip install requests

# 如果几秒内完成,说明镜像配置成功!
```

## 启动Jupyter Notebook

### 什么是Jupyter Notebook?

**Jupyter Notebook** = 交互式编程环境,特别适合:
- 数据分析
- 学习Python
- 快速测试代码
- 编写技术文档

### 启动方法

#### 方法1: 通过Anaconda Navigator(图形界面)

1. **打开Anaconda Navigator**
   - Windows: 开始菜单 → Anaconda Navigator
   - macOS: 启动台 → Anaconda Navigator

2. **点击Jupyter Notebook的Launch按钮**

3. **浏览器自动打开**
   ```
   http://localhost:8888
   ```

#### 方法2: 通过命令行(推荐)

```bash
# 打开终端/命令提示符
jupyter notebook
```

**预期结果**:
```
[I 10:30:00.000 NotebookApp] Serving notebooks from local directory: /Users/xxx
[I 10:30:00.000 NotebookApp] Jupyter Notebook is running at:
[I 10:30:00.000 NotebookApp] http://localhost:8888/?token=xxxxx
```

浏览器自动打开Jupyter界面。

### Jupyter Notebook基本使用

#### 1. 创建新笔记本

```
点击右上角 "New" → "Python 3"
```

#### 2. 运行代码

在单元格中输入:
```python
print("Hello, Medical World!")
```

**运行方式**:
- 方法1: 点击工具栏的▶️按钮
- 方法2: 按 `Shift + Enter`
- 方法3: 按 `Ctrl + Enter`(运行但不跳到下一格)

#### 3. 常用快捷键

| 快捷键 | 功能 |
|--------|------|
| `Shift + Enter` | 运行当前单元格并跳到下一个 |
| `Ctrl + Enter` | 运行当前单元格 |
| `A` | 在上方插入单元格(命令模式) |
| `B` | 在下方插入单元格(命令模式) |
| `DD` | 删除当前单元格(命令模式) |
| `M` | 转为Markdown单元格 |
| `Y` | 转为代码单元格 |
| `Esc` | 进入命令模式 |
| `Enter` | 进入编辑模式 |

#### 4. 示例:第一个医学数据分析

```python
# 单元格1: 导入库
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# 单元格2: 创建患者数据
patients = pd.DataFrame({
    '姓名': ['张三', '李四', '王五', '赵六', '孙七'],
    '年龄': [45, 52, 38, 68, 55],
    '收缩压': [135, 145, 128, 155, 140],
    '舒张压': [85, 92, 78, 95, 88]
})

# 单元格3: 查看数据
patients

# 单元格4: 统计分析
print(f"平均年龄: {patients['年龄'].mean():.1f}岁")
print(f"平均血压: {patients['收缩压'].mean():.1f}/{patients['舒张压'].mean():.1f} mmHg")

# 单元格5: 可视化
plt.scatter(patients['年龄'], patients['收缩压'])
plt.xlabel('年龄')
plt.ylabel('收缩压')
plt.title('年龄与血压关系')
plt.show()
```

**每个单元格运行后都会显示结果,非常直观!**

## 安装额外的库

### 使用conda安装

```bash
# 安装单个库
conda install pandas

# 安装多个库
conda install numpy scipy matplotlib

# 安装特定版本
conda install pandas=2.0.0

# 搜索库
conda search pandas
```

### 使用pip安装

```bash
# 安装单个库
pip install requests

# 安装多个库
pip install requests beautifulsoup4 openpyxl

# 安装特定版本
pip install requests==2.31.0

# 升级库
pip install --upgrade pandas

# 查看已安装的库
pip list
```

### conda vs pip选择

| 情况 | 使用 | 原因 |
|------|------|------|
| 数据科学库(NumPy/Pandas) | conda优先 | 更稳定,自动处理依赖 |
| 通用库(requests) | pip | 库更全 |
| 两者都有 | conda优先 | 兼容性更好 |

### 常用医学相关库安装

```bash
# 数据处理
conda install pandas numpy scipy

# 可视化
conda install matplotlib seaborn

# 统计分析
conda install statsmodels scikit-learn

# 医学影像
pip install pydicom

# Excel处理
conda install openpyxl xlrd

# PDF处理
pip install PyPDF2

# 网页抓取
pip install requests beautifulsoup4
```

## 创建虚拟环境(进阶)

### 为什么需要虚拟环境?

```
场景:
项目A需要 pandas 1.5
项目B需要 pandas 2.0

在同一个环境会冲突!

解决方案:
为每个项目创建独立的虚拟环境
```

### 创建环境

```bash
# 创建名为medical的环境,Python 3.11
conda create -n medical python=3.11

# 激活环境
conda activate medical

# 在这个环境中安装库
conda install pandas numpy matplotlib

# 退出环境
conda deactivate

# 删除环境
conda env remove -n medical

# 查看所有环境
conda env list
```

### 导出和还原环境

```bash
# 导出当前环境
conda env export > environment.yml

# 从文件创建环境
conda env create -f environment.yml
```

**新手可以先跳过虚拟环境,等有需要再学!**

## 常见问题解决

### 问题1: conda不是内部或外部命令

**原因**: 环境变量未配置

**解决方案(Windows)**:
1. 右键"此电脑" → 属性 → 高级系统设置 → 环境变量
2. 在"系统变量"中找到Path,点击编辑
3. 添加以下路径(根据实际安装路径修改):
   ```
   C:\Users\你的用户名\anaconda3
   C:\Users\你的用户名\anaconda3\Scripts
   C:\Users\你的用户名\anaconda3\Library\bin
   ```
4. 确定,重启命令提示符

### 问题2: Jupyter启动后浏览器不自动打开

**解决方案**:
```bash
# 手动打开浏览器,访问:
http://localhost:8888

# 或生成配置文件
jupyter notebook --generate-config

# 编辑配置文件,修改:
c.NotebookApp.browser = 'chrome'  # 或你的默认浏览器
```

### 问题3: 安装库时速度很慢

**解决方案**:
1. 配置国内镜像(见前文)
2. 使用pip代替conda:
   ```bash
   pip install pandas -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

### 问题4: import库时报错"No module named xxx"

**解决方案**:
```bash
# 先确认库是否安装
pip list | grep pandas

# 如果没有,安装
pip install pandas

# 如果已安装但还报错,检查环境
which python  # macOS/Linux
where python  # Windows
```

### 问题5: Jupyter中中文显示乱码

**解决方案**:
```python
import matplotlib.pyplot as plt

# 设置中文字体
plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows
# 或
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']  # macOS

# 解决负号显示问题
plt.rcParams['axes.unicode_minus'] = False
```

## 验证安装清单

运行以下代码,确保所有组件正常:

```python
# 验证脚本
import sys
print(f"Python版本: {sys.version}")

import pandas as pd
print(f"✅ Pandas {pd.__version__}")

import numpy as np
print(f"✅ NumPy {np.__version__}")

import matplotlib
print(f"✅ Matplotlib {matplotlib.__version__}")

import scipy
print(f"✅ SciPy {scipy.__version__}")

print("\n🎉 环境配置成功!可以开始编程了!")
```

**预期输出**:
```
Python版本: 3.11.7 ...
✅ Pandas 2.2.0
✅ NumPy 1.26.3
✅ Matplotlib 3.8.2
✅ SciPy 1.12.0

🎉 环境配置成功!可以开始编程了!
```

## 💡 关键要点

### 安装总结

1. **下载** - Anaconda官网或清华镜像
2. **安装** - 一路Next,勾选添加到PATH
3. **验证** - `python --version` 和 `conda --version`
4. **配置** - 国内镜像(提升速度)
5. **启动** - `jupyter notebook`

### 记住这些命令

```bash
# 安装库
conda install 库名
pip install 库名

# 启动Jupyter
jupyter notebook

# 查看已安装
pip list

# 更新库
pip install --upgrade 库名
```

## 下一步

环境搭建完成!下一节[第一个程序:Hello Medical World](3.3-first-program.md),我们将编写第一个Python程序!

---

## 🔧 实践任务

1. 安装Anaconda
2. 启动Jupyter Notebook
3. 创建一个新笔记本
4. 运行以下代码:
   ```python
   print("我的Python环境配置成功!")

   import pandas as pd
   data = pd.DataFrame({
       '患者': ['张三', '李四', '王五'],
       '年龄': [45, 52, 38]
   })
   print(data)
   ```
5. 截图保存,这是你编程之路的第一步! 📸

> 💡 提示:如果遇到问题,先Google搜索错误信息,90%的问题都能找到答案!
