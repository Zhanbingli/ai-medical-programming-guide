# 4.4 å®æˆ˜:åˆ†æä¸´åºŠè¯•éªŒæ•°æ®

## é¡¹ç›®èƒŒæ™¯

### ç ”ç©¶è®¾è®¡

**ç ”ç©¶é¢˜ç›®**:æ–°å‹é™å‹è¯ç‰©å¤šä¸­å¿ƒéšæœºå¯¹ç…§è¯•éªŒ

**ç ”ç©¶ç›®æ ‡**:è¯„ä¼°æ–°è¯ç›¸æ¯”å®‰æ…°å‰‚çš„é™å‹æ•ˆæœ

**ç ”ç©¶è®¾è®¡**:
- æ ·æœ¬é‡: 200åé«˜è¡€å‹æ‚£è€…
- åˆ†ç»„: å¯¹ç…§ç»„(å®‰æ…°å‰‚)100äºº,æ²»ç–—ç»„(æ–°è¯)100äºº
- éšè®¿æ—¶é—´: 12å‘¨
- ä¸»è¦ç»ˆç‚¹: æ”¶ç¼©å‹é™ä½å¹…åº¦
- æ¬¡è¦ç»ˆç‚¹: è¾¾æ ‡ç‡(<140/90 mmHg)

### æ•°æ®æ–‡ä»¶

**trial_data.csv**åŒ…å«ä»¥ä¸‹å­—æ®µ:
- æ‚£è€…ID
- ç»„åˆ«(å¯¹ç…§ç»„/æ²»ç–—ç»„)
- å¹´é¾„ã€æ€§åˆ«
- åŸºçº¿è¡€å‹(æ”¶ç¼©å‹ã€èˆ’å¼ å‹)
- åŸºçº¿å¿ƒç‡ã€BMI
- éšè®¿è¡€å‹(4å‘¨ã€8å‘¨ã€12å‘¨)
- ä¸è‰¯ååº”

## é¡¹ç›®ç›®æ ‡

ä½¿ç”¨Pythonå®Œæˆ:
1. âœ… æ•°æ®å¯¼å…¥å’Œæ¸…æ´—
2. âœ… æè¿°æ€§ç»Ÿè®¡åˆ†æ
3. âœ… ç»„é—´åŸºçº¿æ¯”è¾ƒ
4. âœ… é™å‹æ•ˆæœåˆ†æ
5. âœ… å¯è§†åŒ–å±•ç¤º
6. âœ… ç”Ÿæˆåˆ†ææŠ¥å‘Š

## æ­¥éª¤1:å‡†å¤‡æ•°æ®

### 1.1 ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®

```python
import pandas as pd
import numpy as np

def generate_trial_data(n=200, seed=42):
    """ç”Ÿæˆæ¨¡æ‹Ÿä¸´åºŠè¯•éªŒæ•°æ®"""

    np.random.seed(seed)

    # åŸºæœ¬ä¿¡æ¯
    patient_ids = [f"P{i:04d}" for i in range(1, n+1)]
    groups = ['å¯¹ç…§ç»„'] * (n//2) + ['æ²»ç–—ç»„'] * (n//2)
    np.random.shuffle(groups)

    ages = np.random.normal(55, 12, n).astype(int)
    ages = np.clip(ages, 25, 80)

    genders = np.random.choice(['ç”·', 'å¥³'], n, p=[0.55, 0.45])

    # åŸºçº¿æ•°æ®
    baseline_sbp = np.random.normal(155, 15, n)
    baseline_dbp = np.random.normal(95, 10, n)
    baseline_hr = np.random.normal(75, 10, n).astype(int)
    bmi = np.random.normal(26, 4, n)

    # éšè®¿æ•°æ®
    followup_4w_sbp = []
    followup_8w_sbp = []
    followup_12w_sbp = []
    followup_4w_dbp = []
    followup_8w_dbp = []
    followup_12w_dbp = []

    for i in range(n):
        if groups[i] == 'å¯¹ç…§ç»„':
            # å¯¹ç…§ç»„:è½»å¾®ä¸‹é™
            reduce_4w = np.random.normal(5, 8, 1)[0]
            reduce_8w = np.random.normal(7, 10, 1)[0]
            reduce_12w = np.random.normal(8, 12, 1)[0]
        else:
            # æ²»ç–—ç»„:æ˜¾è‘—ä¸‹é™
            reduce_4w = np.random.normal(15, 8, 1)[0]
            reduce_8w = np.random.normal(22, 10, 1)[0]
            reduce_12w = np.random.normal(25, 12, 1)[0]

        followup_4w_sbp.append(baseline_sbp[i] - reduce_4w)
        followup_8w_sbp.append(baseline_sbp[i] - reduce_8w)
        followup_12w_sbp.append(baseline_sbp[i] - reduce_12w)

        followup_4w_dbp.append(baseline_dbp[i] - reduce_4w * 0.6)
        followup_8w_dbp.append(baseline_dbp[i] - reduce_8w * 0.6)
        followup_12w_dbp.append(baseline_dbp[i] - reduce_12w * 0.6)

    # åˆ›å»ºDataFrame
    df = pd.DataFrame({
        'æ‚£è€…ID': patient_ids,
        'ç»„åˆ«': groups,
        'å¹´é¾„': ages,
        'æ€§åˆ«': genders,
        'åŸºçº¿æ”¶ç¼©å‹': baseline_sbp,
        'åŸºçº¿èˆ’å¼ å‹': baseline_dbp,
        'åŸºçº¿å¿ƒç‡': baseline_hr,
        'BMI': bmi,
        '4å‘¨æ”¶ç¼©å‹': followup_4w_sbp,
        '8å‘¨æ”¶ç¼©å‹': followup_8w_sbp,
        '12å‘¨æ”¶ç¼©å‹': followup_12w_sbp,
        '4å‘¨èˆ’å¼ å‹': followup_4w_dbp,
        '8å‘¨èˆ’å¼ å‹': followup_8w_dbp,
        '12å‘¨èˆ’å¼ å‹': followup_12w_dbp
    })

    # ä¿å­˜
    df.to_csv('trial_data.csv', index=False, encoding='utf-8-sig')
    print("âœ“ æ¨¡æ‹Ÿæ•°æ®å·²ç”Ÿæˆ: trial_data.csv")

    return df

# ç”Ÿæˆæ•°æ®
df = generate_trial_data()
```

### 1.2 æ•°æ®å¯¼å…¥å’Œæ£€æŸ¥

```python
import pandas as pd
import numpy as np

# è¯»å–æ•°æ®
df = pd.read_csv('trial_data.csv')

print("="*70)
print("æ•°æ®å¯¼å…¥æ£€æŸ¥")
print("="*70)

# åŸºæœ¬ä¿¡æ¯
print(f"\næ€»æ ·æœ¬é‡: {len(df)}ä¾‹")
print(f"æ•°æ®ç»´åº¦: {df.shape}")
print(f"\næ•°æ®åˆ—:\n{df.columns.tolist()}")

# å‰5è¡Œ
print(f"\nå‰5è¡Œæ•°æ®:")
print(df.head())

# æ•°æ®ç±»å‹
print(f"\næ•°æ®ç±»å‹:")
print(df.dtypes)

# ç¼ºå¤±å€¼æ£€æŸ¥
print(f"\nç¼ºå¤±å€¼ç»Ÿè®¡:")
missing = df.isnull().sum()
if missing.sum() == 0:
    print("  âœ“ æ— ç¼ºå¤±å€¼")
else:
    print(missing[missing > 0])

print("="*70)
```

## æ­¥éª¤2:æè¿°æ€§ç»Ÿè®¡

```python
import pandas as pd
import numpy as np

df = pd.read_csv('trial_data.csv')

print("="*70)
print("å…¨ä½“æ‚£è€…åŸºçº¿ç‰¹å¾")
print("="*70)

# åŸºæœ¬ä¿¡æ¯
print(f"\næ ·æœ¬é‡: {len(df)}ä¾‹")

# å¹´é¾„
print(f"\nå¹´é¾„ (å²):")
print(f"  å‡å€¼ Â± æ ‡å‡†å·®: {df['å¹´é¾„'].mean():.1f} Â± {df['å¹´é¾„'].std():.1f}")
print(f"  ä¸­ä½æ•° [IQR]: {df['å¹´é¾„'].median():.0f} [{df['å¹´é¾„'].quantile(0.25):.0f}-{df['å¹´é¾„'].quantile(0.75):.0f}]")
print(f"  èŒƒå›´: {df['å¹´é¾„'].min()}-{df['å¹´é¾„'].max()}")

# æ€§åˆ«
print(f"\næ€§åˆ«:")
gender_count = df['æ€§åˆ«'].value_counts()
for gender, count in gender_count.items():
    pct = count / len(df) * 100
    print(f"  {gender}: {count}ä¾‹ ({pct:.1f}%)")

# åŸºçº¿è¡€å‹
print(f"\nåŸºçº¿æ”¶ç¼©å‹ (mmHg):")
print(f"  {df['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f} Â± {df['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}")

print(f"\nåŸºçº¿èˆ’å¼ å‹ (mmHg):")
print(f"  {df['åŸºçº¿èˆ’å¼ å‹'].mean():.1f} Â± {df['åŸºçº¿èˆ’å¼ å‹'].std():.1f}")

# BMI
print(f"\nBMI (kg/mÂ²):")
print(f"  {df['BMI'].mean():.1f} Â± {df['BMI'].std():.1f}")

print("="*70)
```

## æ­¥éª¤3:åŸºçº¿ç‰¹å¾æ¯”è¾ƒ

```python
import pandas as pd
import numpy as np
from scipy import stats

df = pd.read_csv('trial_data.csv')

# åˆ†ç»„
control = df[df['ç»„åˆ«'] == 'å¯¹ç…§ç»„']
treatment = df[df['ç»„åˆ«'] == 'æ²»ç–—ç»„']

print("="*70)
print("åŸºçº¿ç‰¹å¾ç»„é—´æ¯”è¾ƒ")
print("="*70)

# æ ·æœ¬é‡
print(f"\næ ·æœ¬é‡:")
print(f"  å¯¹ç…§ç»„: {len(control)}ä¾‹")
print(f"  æ²»ç–—ç»„: {len(treatment)}ä¾‹")

# å¹´é¾„
print(f"\nå¹´é¾„ (å²):")
print(f"  å¯¹ç…§ç»„: {control['å¹´é¾„'].mean():.1f} Â± {control['å¹´é¾„'].std():.1f}")
print(f"  æ²»ç–—ç»„: {treatment['å¹´é¾„'].mean():.1f} Â± {treatment['å¹´é¾„'].std():.1f}")
t_stat, p_val = stats.ttest_ind(control['å¹´é¾„'], treatment['å¹´é¾„'])
print(f"  På€¼: {p_val:.3f}")

# æ€§åˆ«
print(f"\næ€§åˆ« (ç”·æ€§%):")
control_male_pct = (control['æ€§åˆ«'] == 'ç”·').sum() / len(control) * 100
treatment_male_pct = (treatment['æ€§åˆ«'] == 'ç”·').sum() / len(treatment) * 100
print(f"  å¯¹ç…§ç»„: {control_male_pct:.1f}%")
print(f"  æ²»ç–—ç»„: {treatment_male_pct:.1f}%")

# å¡æ–¹æ£€éªŒ
contingency_table = pd.crosstab(df['ç»„åˆ«'], df['æ€§åˆ«'])
chi2, p_val, dof, expected = stats.chi2_contingency(contingency_table)
print(f"  På€¼: {p_val:.3f}")

# åŸºçº¿æ”¶ç¼©å‹
print(f"\nåŸºçº¿æ”¶ç¼©å‹ (mmHg):")
print(f"  å¯¹ç…§ç»„: {control['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f} Â± {control['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}")
print(f"  æ²»ç–—ç»„: {treatment['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f} Â± {treatment['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}")
t_stat, p_val = stats.ttest_ind(control['åŸºçº¿æ”¶ç¼©å‹'], treatment['åŸºçº¿æ”¶ç¼©å‹'])
print(f"  På€¼: {p_val:.3f}")

# åŸºçº¿èˆ’å¼ å‹
print(f"\nåŸºçº¿èˆ’å¼ å‹ (mmHg):")
print(f"  å¯¹ç…§ç»„: {control['åŸºçº¿èˆ’å¼ å‹'].mean():.1f} Â± {control['åŸºçº¿èˆ’å¼ å‹'].std():.1f}")
print(f"  æ²»ç–—ç»„: {treatment['åŸºçº¿èˆ’å¼ å‹'].mean():.1f} Â± {treatment['åŸºçº¿èˆ’å¼ å‹'].std():.1f}")
t_stat, p_val = stats.ttest_ind(control['åŸºçº¿èˆ’å¼ å‹'], treatment['åŸºçº¿èˆ’å¼ å‹'])
print(f"  På€¼: {p_val:.3f}")

# BMI
print(f"\nBMI (kg/mÂ²):")
print(f"  å¯¹ç…§ç»„: {control['BMI'].mean():.1f} Â± {control['BMI'].std():.1f}")
print(f"  æ²»ç–—ç»„: {treatment['BMI'].mean():.1f} Â± {treatment['BMI'].std():.1f}")
t_stat, p_val = stats.ttest_ind(control['BMI'], treatment['BMI'])
print(f"  På€¼: {p_val:.3f}")

print("\nç»“è®º: ä¸¤ç»„åŸºçº¿ç‰¹å¾å‡è¡¡å¯æ¯” (P>0.05)")
print("="*70)
```

## æ­¥éª¤4:ä¸»è¦ç–—æ•ˆåˆ†æ

```python
import pandas as pd
import numpy as np
from scipy import stats

df = pd.read_csv('trial_data.csv')

# è®¡ç®—è¡€å‹å˜åŒ–
df['æ”¶ç¼©å‹å˜åŒ–'] = df['12å‘¨æ”¶ç¼©å‹'] - df['åŸºçº¿æ”¶ç¼©å‹']
df['èˆ’å¼ å‹å˜åŒ–'] = df['12å‘¨èˆ’å¼ å‹'] - df['åŸºçº¿èˆ’å¼ å‹']

# åˆ†ç»„
control = df[df['ç»„åˆ«'] == 'å¯¹ç…§ç»„']
treatment = df[df['ç»„åˆ«'] == 'æ²»ç–—ç»„']

print("="*70)
print("ä¸»è¦ç–—æ•ˆåˆ†æ (12å‘¨)")
print("="*70)

# æ”¶ç¼©å‹å˜åŒ–
print(f"\næ”¶ç¼©å‹å˜åŒ– (mmHg):")
print(f"  å¯¹ç…§ç»„: {-control['æ”¶ç¼©å‹å˜åŒ–'].mean():.1f} Â± {control['æ”¶ç¼©å‹å˜åŒ–'].std():.1f}")
print(f"  æ²»ç–—ç»„: {-treatment['æ”¶ç¼©å‹å˜åŒ–'].mean():.1f} Â± {treatment['æ”¶ç¼©å‹å˜åŒ–'].std():.1f}")

t_stat, p_val = stats.ttest_ind(control['æ”¶ç¼©å‹å˜åŒ–'], treatment['æ”¶ç¼©å‹å˜åŒ–'])
diff = treatment['æ”¶ç¼©å‹å˜åŒ–'].mean() - control['æ”¶ç¼©å‹å˜åŒ–'].mean()
print(f"  ç»„é—´å·®å¼‚: {-diff:.1f} mmHg")
print(f"  På€¼: {p_val:.4f}")
print(f"  ç»“è®º: {'æœ‰ç»Ÿè®¡å­¦å·®å¼‚ âœ“' if p_val < 0.05 else 'æ— ç»Ÿè®¡å­¦å·®å¼‚'}")

# èˆ’å¼ å‹å˜åŒ–
print(f"\nèˆ’å¼ å‹å˜åŒ– (mmHg):")
print(f"  å¯¹ç…§ç»„: {-control['èˆ’å¼ å‹å˜åŒ–'].mean():.1f} Â± {control['èˆ’å¼ å‹å˜åŒ–'].std():.1f}")
print(f"  æ²»ç–—ç»„: {-treatment['èˆ’å¼ å‹å˜åŒ–'].mean():.1f} Â± {treatment['èˆ’å¼ å‹å˜åŒ–'].std():.1f}")

t_stat, p_val = stats.ttest_ind(control['èˆ’å¼ å‹å˜åŒ–'], treatment['èˆ’å¼ å‹å˜åŒ–'])
diff = treatment['èˆ’å¼ å‹å˜åŒ–'].mean() - control['èˆ’å¼ å‹å˜åŒ–'].mean()
print(f"  ç»„é—´å·®å¼‚: {-diff:.1f} mmHg")
print(f"  På€¼: {p_val:.4f}")
print(f"  ç»“è®º: {'æœ‰ç»Ÿè®¡å­¦å·®å¼‚ âœ“' if p_val < 0.05 else 'æ— ç»Ÿè®¡å­¦å·®å¼‚'}")

# è¾¾æ ‡ç‡
print(f"\nè¡€å‹è¾¾æ ‡ç‡ (<140/90 mmHg):")
control_target = ((control['12å‘¨æ”¶ç¼©å‹'] < 140) & (control['12å‘¨èˆ’å¼ å‹'] < 90)).sum()
treatment_target = ((treatment['12å‘¨æ”¶ç¼©å‹'] < 140) & (treatment['12å‘¨èˆ’å¼ å‹'] < 90)).sum()

control_target_pct = control_target / len(control) * 100
treatment_target_pct = treatment_target / len(treatment) * 100

print(f"  å¯¹ç…§ç»„: {control_target}/{len(control)} ({control_target_pct:.1f}%)")
print(f"  æ²»ç–—ç»„: {treatment_target}/{len(treatment)} ({treatment_target_pct:.1f}%)")
print(f"  å·®å¼‚: {treatment_target_pct - control_target_pct:.1f}%")

# å¡æ–¹æ£€éªŒ
contingency = pd.crosstab(
    df['ç»„åˆ«'],
    (df['12å‘¨æ”¶ç¼©å‹'] < 140) & (df['12å‘¨èˆ’å¼ å‹'] < 90)
)
chi2, p_val, dof, expected = stats.chi2_contingency(contingency)
print(f"  På€¼: {p_val:.4f}")
print(f"  ç»“è®º: {'æœ‰ç»Ÿè®¡å­¦å·®å¼‚ âœ“' if p_val < 0.05 else 'æ— ç»Ÿè®¡å­¦å·®å¼‚'}")

print("="*70)
```

## æ­¥éª¤5:æ•°æ®å¯è§†åŒ–

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# é…ç½®ä¸­æ–‡
plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

df = pd.read_csv('trial_data.csv')
df['æ”¶ç¼©å‹å˜åŒ–'] = df['12å‘¨æ”¶ç¼©å‹'] - df['åŸºçº¿æ”¶ç¼©å‹']

control = df[df['ç»„åˆ«'] == 'å¯¹ç…§ç»„']
treatment = df[df['ç»„åˆ«'] == 'æ²»ç–—ç»„']

# åˆ›å»ºå›¾è¡¨
fig = plt.figure(figsize=(16, 12))

# å­å›¾1:åŸºçº¿è¡€å‹åˆ†å¸ƒ
ax1 = plt.subplot(2, 3, 1)
ax1.boxplot([control['åŸºçº¿æ”¶ç¼©å‹'], treatment['åŸºçº¿æ”¶ç¼©å‹']],
           labels=['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'])
ax1.set_ylabel('æ”¶ç¼©å‹ (mmHg)')
ax1.set_title('åŸºçº¿æ”¶ç¼©å‹åˆ†å¸ƒ')
ax1.grid(True, alpha=0.3, axis='y')

# å­å›¾2:12å‘¨è¡€å‹åˆ†å¸ƒ
ax2 = plt.subplot(2, 3, 2)
ax2.boxplot([control['12å‘¨æ”¶ç¼©å‹'], treatment['12å‘¨æ”¶ç¼©å‹']],
           labels=['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'])
ax2.set_ylabel('æ”¶ç¼©å‹ (mmHg)')
ax2.set_title('12å‘¨æ”¶ç¼©å‹åˆ†å¸ƒ')
ax2.axhline(y=140, color='r', linestyle='--', alpha=0.5)
ax2.grid(True, alpha=0.3, axis='y')

# å­å›¾3:é™å‹å¹…åº¦å¯¹æ¯”
ax3 = plt.subplot(2, 3, 3)
reduction_data = [-control['æ”¶ç¼©å‹å˜åŒ–'].mean(), -treatment['æ”¶ç¼©å‹å˜åŒ–'].mean()]
bars = ax3.bar(['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'], reduction_data, color=['lightcoral', 'lightblue'])
ax3.set_ylabel('é™å‹å¹…åº¦ (mmHg)')
ax3.set_title('å¹³å‡é™å‹æ•ˆæœ')
ax3.grid(True, alpha=0.3, axis='y')

# æ·»åŠ æ•°å€¼æ ‡ç­¾
for bar in bars:
    height = bar.get_height()
    ax3.text(bar.get_x() + bar.get_width()/2., height,
            f'{height:.1f}', ha='center', va='bottom')

# å­å›¾4:è¡€å‹å˜åŒ–æ•£ç‚¹å›¾(å¯¹ç…§ç»„)
ax4 = plt.subplot(2, 3, 4)
ax4.scatter(control['åŸºçº¿æ”¶ç¼©å‹'], control['12å‘¨æ”¶ç¼©å‹'], alpha=0.6)
ax4.plot([90, 180], [90, 180], 'r--', label='æ— å˜åŒ–çº¿')
ax4.set_xlabel('åŸºçº¿æ”¶ç¼©å‹ (mmHg)')
ax4.set_ylabel('12å‘¨æ”¶ç¼©å‹ (mmHg)')
ax4.set_title('å¯¹ç…§ç»„è¡€å‹å˜åŒ–')
ax4.legend()
ax4.grid(True, alpha=0.3)

# å­å›¾5:è¡€å‹å˜åŒ–æ•£ç‚¹å›¾(æ²»ç–—ç»„)
ax5 = plt.subplot(2, 3, 5)
ax5.scatter(treatment['åŸºçº¿æ”¶ç¼©å‹'], treatment['12å‘¨æ”¶ç¼©å‹'],
           alpha=0.6, color='green')
ax5.plot([90, 180], [90, 180], 'r--', label='æ— å˜åŒ–çº¿')
ax5.set_xlabel('åŸºçº¿æ”¶ç¼©å‹ (mmHg)')
ax5.set_ylabel('12å‘¨æ”¶ç¼©å‹ (mmHg)')
ax5.set_title('æ²»ç–—ç»„è¡€å‹å˜åŒ–')
ax5.legend()
ax5.grid(True, alpha=0.3)

# å­å›¾6:è¾¾æ ‡ç‡å¯¹æ¯”
ax6 = plt.subplot(2, 3, 6)
control_target_pct = ((control['12å‘¨æ”¶ç¼©å‹'] < 140) &
                     (control['12å‘¨èˆ’å¼ å‹'] < 90)).sum() / len(control) * 100
treatment_target_pct = ((treatment['12å‘¨æ”¶ç¼©å‹'] < 140) &
                       (treatment['12å‘¨èˆ’å¼ å‹'] < 90)).sum() / len(treatment) * 100

bars = ax6.bar(['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'],
              [control_target_pct, treatment_target_pct],
              color=['lightcoral', 'lightblue'])
ax6.set_ylabel('è¾¾æ ‡ç‡ (%)')
ax6.set_title('è¡€å‹è¾¾æ ‡ç‡ (<140/90 mmHg)')
ax6.set_ylim([0, 100])

for bar in bars:
    height = bar.get_height()
    ax6.text(bar.get_x() + bar.get_width()/2., height,
            f'{height:.1f}%', ha='center', va='bottom')

plt.suptitle('é™å‹è¯ç‰©ä¸´åºŠè¯•éªŒå¯è§†åŒ–åˆ†æ', fontsize=16, fontweight='bold')
plt.tight_layout()
plt.savefig('trial_analysis.png', dpi=300, bbox_inches='tight')
plt.show()

print("âœ“ å¯è§†åŒ–å›¾è¡¨å·²ä¿å­˜: trial_analysis.png")
```

## æ­¥éª¤6:ç”Ÿæˆå®Œæ•´æŠ¥å‘Š

```python
import pandas as pd
import numpy as np
from scipy import stats
from datetime import datetime

df = pd.read_csv('trial_data.csv')
df['æ”¶ç¼©å‹å˜åŒ–'] = df['12å‘¨æ”¶ç¼©å‹'] - df['åŸºçº¿æ”¶ç¼©å‹']
df['èˆ’å¼ å‹å˜åŒ–'] = df['12å‘¨èˆ’å¼ å‹'] - df['åŸºçº¿èˆ’å¼ å‹']

control = df[df['ç»„åˆ«'] == 'å¯¹ç…§ç»„']
treatment = df[df['ç»„åˆ«'] == 'æ²»ç–—ç»„']

# ç”ŸæˆæŠ¥å‘Š
report = []
report.append("="*70)
report.append("é™å‹è¯ç‰©ä¸´åºŠè¯•éªŒç»Ÿè®¡åˆ†ææŠ¥å‘Š")
report.append("="*70)
report.append(f"æŠ¥å‘Šç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")

# 1. ç ”ç©¶æ¦‚å†µ
report.append("ä¸€ã€ç ”ç©¶æ¦‚å†µ")
report.append("-"*70)
report.append(f"ç ”ç©¶é¢˜ç›®: æ–°å‹é™å‹è¯ç‰©å¤šä¸­å¿ƒéšæœºå¯¹ç…§è¯•éªŒ")
report.append(f"æ ·æœ¬é‡: {len(df)}ä¾‹")
report.append(f"  å¯¹ç…§ç»„: {len(control)}ä¾‹")
report.append(f"  æ²»ç–—ç»„: {len(treatment)}ä¾‹")
report.append(f"éšè®¿æ—¶é—´: 12å‘¨\n")

# 2. åŸºçº¿ç‰¹å¾
report.append("äºŒã€åŸºçº¿ç‰¹å¾")
report.append("-"*70)

# å¹´é¾„
t_stat, p_age = stats.ttest_ind(control['å¹´é¾„'], treatment['å¹´é¾„'])
report.append(f"å¹´é¾„ (å²):")
report.append(f"  å¯¹ç…§ç»„: {control['å¹´é¾„'].mean():.1f} Â± {control['å¹´é¾„'].std():.1f}")
report.append(f"  æ²»ç–—ç»„: {treatment['å¹´é¾„'].mean():.1f} Â± {treatment['å¹´é¾„'].std():.1f}")
report.append(f"  På€¼: {p_age:.3f}\n")

# æ€§åˆ«
contingency = pd.crosstab(df['ç»„åˆ«'], df['æ€§åˆ«'])
chi2, p_gender, dof, expected = stats.chi2_contingency(contingency)
control_male_pct = (control['æ€§åˆ«'] == 'ç”·').sum() / len(control) * 100
treatment_male_pct = (treatment['æ€§åˆ«'] == 'ç”·').sum() / len(treatment) * 100
report.append(f"æ€§åˆ« (ç”·æ€§%):")
report.append(f"  å¯¹ç…§ç»„: {control_male_pct:.1f}%")
report.append(f"  æ²»ç–—ç»„: {treatment_male_pct:.1f}%")
report.append(f"  På€¼: {p_gender:.3f}\n")

# åŸºçº¿è¡€å‹
t_stat, p_sbp = stats.ttest_ind(control['åŸºçº¿æ”¶ç¼©å‹'], treatment['åŸºçº¿æ”¶ç¼©å‹'])
report.append(f"åŸºçº¿æ”¶ç¼©å‹ (mmHg):")
report.append(f"  å¯¹ç…§ç»„: {control['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f} Â± {control['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}")
report.append(f"  æ²»ç–—ç»„: {treatment['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f} Â± {treatment['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}")
report.append(f"  På€¼: {p_sbp:.3f}\n")

report.append(f"ç»“è®º: ä¸¤ç»„åŸºçº¿ç‰¹å¾å‡è¡¡å¯æ¯” (P>0.05)\n")

# 3. ä¸»è¦ç–—æ•ˆåˆ†æ
report.append("ä¸‰ã€ä¸»è¦ç–—æ•ˆåˆ†æ (12å‘¨)")
report.append("-"*70)

# æ”¶ç¼©å‹å˜åŒ–
t_stat, p_sbp_change = stats.ttest_ind(control['æ”¶ç¼©å‹å˜åŒ–'], treatment['æ”¶ç¼©å‹å˜åŒ–'])
diff_sbp = treatment['æ”¶ç¼©å‹å˜åŒ–'].mean() - control['æ”¶ç¼©å‹å˜åŒ–'].mean()
report.append(f"æ”¶ç¼©å‹å˜åŒ– (mmHg):")
report.append(f"  å¯¹ç…§ç»„: {-control['æ”¶ç¼©å‹å˜åŒ–'].mean():.1f} Â± {control['æ”¶ç¼©å‹å˜åŒ–'].std():.1f}")
report.append(f"  æ²»ç–—ç»„: {-treatment['æ”¶ç¼©å‹å˜åŒ–'].mean():.1f} Â± {treatment['æ”¶ç¼©å‹å˜åŒ–'].std():.1f}")
report.append(f"  ç»„é—´å·®å¼‚: {-diff_sbp:.1f} mmHg")
report.append(f"  På€¼: {p_sbp_change:.4f}")
report.append(f"  ç»“è®º: {'æœ‰ç»Ÿè®¡å­¦å·®å¼‚(P<0.05)' if p_sbp_change < 0.05 else 'æ— ç»Ÿè®¡å­¦å·®å¼‚'}\n")

# è¾¾æ ‡ç‡
control_target = ((control['12å‘¨æ”¶ç¼©å‹'] < 140) & (control['12å‘¨èˆ’å¼ å‹'] < 90)).sum()
treatment_target = ((treatment['12å‘¨æ”¶ç¼©å‹'] < 140) & (treatment['12å‘¨èˆ’å¼ å‹'] < 90)).sum()
control_target_pct = control_target / len(control) * 100
treatment_target_pct = treatment_target / len(treatment) * 100

contingency = pd.crosstab(
    df['ç»„åˆ«'],
    (df['12å‘¨æ”¶ç¼©å‹'] < 140) & (df['12å‘¨èˆ’å¼ å‹'] < 90)
)
chi2, p_target, dof, expected = stats.chi2_contingency(contingency)

report.append(f"è¡€å‹è¾¾æ ‡ç‡ (<140/90 mmHg):")
report.append(f"  å¯¹ç…§ç»„: {control_target}/{len(control)} ({control_target_pct:.1f}%)")
report.append(f"  æ²»ç–—ç»„: {treatment_target}/{len(treatment)} ({treatment_target_pct:.1f}%)")
report.append(f"  å·®å¼‚: {treatment_target_pct - control_target_pct:.1f}%")
report.append(f"  På€¼: {p_target:.4f}")
report.append(f"  ç»“è®º: {'æœ‰ç»Ÿè®¡å­¦å·®å¼‚(P<0.05)' if p_target < 0.05 else 'æ— ç»Ÿè®¡å­¦å·®å¼‚'}\n")

# 4. ç»“è®º
report.append("å››ã€ç ”ç©¶ç»“è®º")
report.append("-"*70)
report.append(f"1. æ–°å‹é™å‹è¯ç‰©ç›¸æ¯”å®‰æ…°å‰‚æ˜¾è‘—é™ä½æ”¶ç¼©å‹({-diff_sbp:.1f} mmHg, P<0.001)")
report.append(f"2. æ²»ç–—ç»„è¡€å‹è¾¾æ ‡ç‡æ˜¾è‘—é«˜äºå¯¹ç…§ç»„({treatment_target_pct:.1f}% vs {control_target_pct:.1f}%, P<0.05)")
report.append(f"3. æ–°å‹é™å‹è¯ç‰©ç–—æ•ˆç¡®åˆ‡,å€¼å¾—ä¸´åºŠæ¨å¹¿")

report.append("\n" + "="*70)

# è¾“å‡ºåˆ°æ§åˆ¶å°
report_text = "\n".join(report)
print(report_text)

# ä¿å­˜åˆ°æ–‡ä»¶
with open('trial_report.txt', 'w', encoding='utf-8') as f:
    f.write(report_text)

print("\nâœ“ åˆ†ææŠ¥å‘Šå·²ä¿å­˜: trial_report.txt")

# åŒæ—¶ä¿å­˜ä¸ºExcel
summary_df = pd.DataFrame({
    'æŒ‡æ ‡': ['æ ·æœ¬é‡', 'å¹³å‡å¹´é¾„', 'åŸºçº¿æ”¶ç¼©å‹', '12å‘¨æ”¶ç¼©å‹', 'é™å‹å¹…åº¦', 'è¾¾æ ‡ç‡'],
    'å¯¹ç…§ç»„': [
        len(control),
        f"{control['å¹´é¾„'].mean():.1f}Â±{control['å¹´é¾„'].std():.1f}",
        f"{control['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f}Â±{control['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}",
        f"{control['12å‘¨æ”¶ç¼©å‹'].mean():.1f}Â±{control['12å‘¨æ”¶ç¼©å‹'].std():.1f}",
        f"{-control['æ”¶ç¼©å‹å˜åŒ–'].mean():.1f}Â±{control['æ”¶ç¼©å‹å˜åŒ–'].std():.1f}",
        f"{control_target_pct:.1f}%"
    ],
    'æ²»ç–—ç»„': [
        len(treatment),
        f"{treatment['å¹´é¾„'].mean():.1f}Â±{treatment['å¹´é¾„'].std():.1f}",
        f"{treatment['åŸºçº¿æ”¶ç¼©å‹'].mean():.1f}Â±{treatment['åŸºçº¿æ”¶ç¼©å‹'].std():.1f}",
        f"{treatment['12å‘¨æ”¶ç¼©å‹'].mean():.1f}Â±{treatment['12å‘¨æ”¶ç¼©å‹'].std():.1f}",
        f"{-treatment['æ”¶ç¼©å‹å˜åŒ–'].mean():.1f}Â±{treatment['æ”¶ç¼©å‹å˜åŒ–'].std():.1f}",
        f"{treatment_target_pct:.1f}%"
    ]
})

summary_df.to_excel('trial_summary.xlsx', index=False)
print("âœ“ æ±‡æ€»è¡¨å·²ä¿å­˜: trial_summary.xlsx")
```

## é¡¹ç›®æ€»ç»“

### å®Œæˆçš„å·¥ä½œ

âœ… æ•°æ®ç”Ÿæˆå’Œå¯¼å…¥
âœ… æ•°æ®æ¸…æ´—å’Œæ£€æŸ¥
âœ… æè¿°æ€§ç»Ÿè®¡åˆ†æ
âœ… ç»„é—´åŸºçº¿æ¯”è¾ƒ
âœ… ç–—æ•ˆåˆ†æ(tæ£€éªŒã€å¡æ–¹æ£€éªŒ)
âœ… æ•°æ®å¯è§†åŒ–(6ç§å›¾è¡¨)
âœ… è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ

### ä½¿ç”¨çš„æŠ€èƒ½

| æŠ€èƒ½ | åº”ç”¨ |
|------|------|
| Pandas | æ•°æ®è¯»å–ã€æ¸…æ´—ã€åˆ†ç»„ç»Ÿè®¡ |
| NumPy | æ•°å€¼è®¡ç®—ã€éšæœºæ•°ç”Ÿæˆ |
| SciPy | ç»Ÿè®¡æ£€éªŒ(tæ£€éªŒã€å¡æ–¹æ£€éªŒ) |
| Matplotlib | æ•°æ®å¯è§†åŒ–(ç®±çº¿å›¾ã€æŸ±çŠ¶å›¾ã€æ•£ç‚¹å›¾) |

### é¡¹ç›®ä»·å€¼

1. **è‡ªåŠ¨åŒ–** - ä»æ•°æ®åˆ°æŠ¥å‘Šå…¨è‡ªåŠ¨
2. **å¯å¤ç”¨** - ä»£ç å¯ç”¨äºå…¶ä»–ä¸´åºŠè¯•éªŒ
3. **æ ‡å‡†åŒ–** - åˆ†ææµç¨‹è§„èŒƒåŒ–
4. **é«˜æ•ˆ** - å‡ åˆ†é’Ÿå®Œæˆä¼ ç»Ÿéœ€è¦å‡ å¤©çš„å·¥ä½œ

## ğŸ’¡ å…³é”®è¦ç‚¹

### ä¸´åºŠè¯•éªŒåˆ†ææµç¨‹

```
1. æ•°æ®å‡†å¤‡ â†’ å¯¼å…¥ã€æ¸…æ´—
2. æè¿°æ€§ç»Ÿè®¡ â†’ äº†è§£æ•°æ®
3. åŸºçº¿æ¯”è¾ƒ â†’ éªŒè¯å‡è¡¡æ€§
4. ç–—æ•ˆåˆ†æ â†’ ç»Ÿè®¡æ£€éªŒ
5. å¯è§†åŒ– â†’ ç›´è§‚å±•ç¤º
6. ç”ŸæˆæŠ¥å‘Š â†’ è‡ªåŠ¨åŒ–è¾“å‡º
```

### Pythonæ•°æ®åˆ†æä¼˜åŠ¿

- âœ… å¯é‡å¤ - ä»£ç å¯ä¿å­˜å¤ç”¨
- âœ… é€æ˜ - åˆ†æè¿‡ç¨‹å¯å®¡æŸ¥
- âœ… é«˜æ•ˆ - æ‰¹é‡å¤„ç†å¤§æ•°æ®
- âœ… ä¸“ä¸š - ç”Ÿæˆå‘è¡¨çº§å›¾è¡¨

## ä¸‹ä¸€æ­¥

æ­å–œå®Œæˆç¬¬4ç« !ä½ å·²ç»æŒæ¡äº†:
- âœ… Pandasæ•°æ®å¤„ç†
- âœ… NumPyæ•°å€¼è®¡ç®—
- âœ… Matplotlibå¯è§†åŒ–
- âœ… ä¸´åºŠè¯•éªŒæ•°æ®åˆ†æ

**æ¥ä¸‹æ¥**:ç¬¬5ç« å°†å­¦ä¹ å¼€å‘ç¯å¢ƒå’Œå·¥å…·é“¾,è®©ä½ çš„ç¼–ç¨‹æ›´é«˜æ•ˆ!

---

## ğŸ¯ æ‰©å±•æŒ‘æˆ˜

### ä»»åŠ¡:æ”¹è¿›åˆ†æè„šæœ¬

1. **å¢åŠ äºšç»„åˆ†æ**
   - æŒ‰å¹´é¾„åˆ†ç»„(<60 vs â‰¥60)
   - æŒ‰æ€§åˆ«åˆ†ç»„
   - åˆ†æä¸åŒäºšç»„çš„ç–—æ•ˆå·®å¼‚

2. **æ·»åŠ è¶‹åŠ¿åˆ†æ**
   - ç»˜åˆ¶4å‘¨ã€8å‘¨ã€12å‘¨çš„è¡€å‹å˜åŒ–è¶‹åŠ¿
   - åˆ†æé™å‹é€Ÿåº¦

3. **æ”¹è¿›å¯è§†åŒ–**
   - ä½¿ç”¨Seabornç¾åŒ–å›¾è¡¨
   - æ·»åŠ æ£®æ—å›¾å±•ç¤ºäºšç»„åˆ†æ
   - åˆ›å»ºäº¤äº’å¼å›¾è¡¨(Plotly)

4. **å®Œå–„æŠ¥å‘Š**
   - ç”ŸæˆWordæ ¼å¼æŠ¥å‘Š
   - è‡ªåŠ¨æ’å…¥å›¾è¡¨
   - æ·»åŠ ç»Ÿè®¡è¡¨æ ¼

è¯•è¯•çœ‹èƒ½å®ç°å¤šå°‘åŠŸèƒ½!é‡åˆ°é—®é¢˜å°±é—®ChatGPT! ğŸš€
