# 4.3 Matplotlib:ç»˜åˆ¶ç»Ÿè®¡å›¾è¡¨

## ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å¯è§†åŒ–?

> "ä¸€å›¾èƒœåƒè¨€" - æ•°æ®å¯è§†åŒ–è®©å¤æ‚æ•°æ®ä¸€ç›®äº†ç„¶

**åœºæ™¯**:ä½ åˆ†æäº†100åæ‚£è€…çš„è¡€å‹æ•°æ®,æƒ³å‘ä¸»ä»»æ±‡æŠ¥ã€‚

### æ–¹å¼1:çº¯æ–‡å­—

```
å¹³å‡æ”¶ç¼©å‹: 135.2 mmHg
æ ‡å‡†å·®: 18.5 mmHg
æœ€å°å€¼: 98 mmHg
æœ€å¤§å€¼: 182 mmHg
...
```

âŒ æ¯ç‡¥ã€éš¾ä»¥ç†è§£ã€æ— æ³•çœ‹å‡ºåˆ†å¸ƒè§„å¾‹

### æ–¹å¼2:å›¾è¡¨

ğŸ“Š ä¸€å¼ ç›´æ–¹å›¾æ¸…æ™°å±•ç¤º:
- è¡€å‹åˆ†å¸ƒæƒ…å†µ
- å¼‚å¸¸å€¼ä½ç½®
- é›†ä¸­è¶‹åŠ¿

âœ… ç›´è§‚ã€ä¸“ä¸šã€æ˜“äºæ²Ÿé€š

## MatplotlibåŸºç¡€

### 1. ç¬¬ä¸€ä¸ªå›¾è¡¨

```python
import matplotlib.pyplot as plt

# æ•°æ®
x = [1, 2, 3, 4, 5]
y = [2, 4, 6, 8, 10]

# ç»˜å›¾
plt.plot(x, y)
plt.xlabel('Xè½´')
plt.ylabel('Yè½´')
plt.title('æˆ‘çš„ç¬¬ä¸€ä¸ªå›¾è¡¨')
plt.show()
```

### 2. åŒ»å­¦åœºæ™¯:è¡€ç³–ç›‘æµ‹æ›²çº¿

```python
import matplotlib.pyplot as plt

# ä¸€å‘¨è¡€ç³–æ•°æ®
days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥']
glucose = [6.2, 5.8, 6.5, 7.1, 6.0, 5.9, 6.3]

# ç»˜åˆ¶æŠ˜çº¿å›¾
plt.figure(figsize=(10, 6))
plt.plot(days, glucose, marker='o', linewidth=2, markersize=8)

# æ·»åŠ ç›®æ ‡çº¿
plt.axhline(y=7.0, color='r', linestyle='--', label='ç›®æ ‡å€¼')

# æ ‡ç­¾å’Œæ ‡é¢˜
plt.xlabel('æ—¥æœŸ', fontsize=12)
plt.ylabel('è¡€ç³– (mmol/L)', fontsize=12)
plt.title('æ‚£è€…è¡€ç³–ç›‘æµ‹ - ä¸€å‘¨è¶‹åŠ¿', fontsize=14, fontweight='bold')
plt.legend()
plt.grid(True, alpha=0.3)

# æ˜¾ç¤º
plt.tight_layout()
plt.show()
```

## å¸¸ç”¨å›¾è¡¨ç±»å‹

### 1. æŠ˜çº¿å›¾ - è¶‹åŠ¿å˜åŒ–

```python
import matplotlib.pyplot as plt
import numpy as np

# æ‚£è€…ä½“æ¸©ç›‘æµ‹(24å°æ—¶)
hours = np.arange(0, 24)
temperature = 37.0 + np.sin(hours/24 * 2 * np.pi) * 1.5 + np.random.rand(24) * 0.3

plt.figure(figsize=(12, 5))
plt.plot(hours, temperature, marker='o', linestyle='-', color='steelblue')
plt.axhline(y=37.3, color='red', linestyle='--', label='å‘çƒ­çº¿')
plt.xlabel('æ—¶é—´ (å°æ—¶)')
plt.ylabel('ä½“æ¸© (Â°C)')
plt.title('æ‚£è€…24å°æ—¶ä½“æ¸©ç›‘æµ‹')
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

### 2. æŸ±çŠ¶å›¾ - åˆ†ç±»æ¯”è¾ƒ

```python
import matplotlib.pyplot as plt

# å„ç§‘å®¤æ‚£è€…æ•°
departments = ['å¿ƒå†…ç§‘', 'ç¥ç»å†…ç§‘', 'å‘¼å¸å†…ç§‘', 'æ¶ˆåŒ–å†…ç§‘', 'å†…åˆ†æ³Œç§‘']
patient_counts = [45, 38, 52, 31, 42]

plt.figure(figsize=(10, 6))
plt.bar(departments, patient_counts, color='skyblue', edgecolor='black')
plt.xlabel('ç§‘å®¤')
plt.ylabel('æ‚£è€…æ•°')
plt.title('å„ç§‘å®¤ä½é™¢æ‚£è€…ç»Ÿè®¡')
plt.xticks(rotation=45)  # æ—‹è½¬æ ‡ç­¾
plt.tight_layout()
plt.show()
```

### 3. æ°´å¹³æŸ±çŠ¶å›¾

```python
import matplotlib.pyplot as plt

# ç–¾ç—…è°±ç»Ÿè®¡
diseases = ['é«˜è¡€å‹', 'ç³–å°¿ç—…', 'å† å¿ƒç—…', 'é«˜è¡€è„‚', 'æ…¢æ€§è‚¾ç—…']
patient_nums = [120, 95, 78, 85, 62]

plt.figure(figsize=(10, 6))
plt.barh(diseases, patient_nums, color='coral')
plt.xlabel('æ‚£è€…æ•°')
plt.ylabel('è¯Šæ–­')
plt.title('ç–¾ç—…è°±ç»Ÿè®¡(Top 5)')
plt.tight_layout()
plt.show()
```

### 4. ç›´æ–¹å›¾ - æ•°æ®åˆ†å¸ƒ

```python
import matplotlib.pyplot as plt
import numpy as np

# 100åæ‚£è€…çš„å¹´é¾„åˆ†å¸ƒ
np.random.seed(42)
ages = np.random.normal(55, 15, 100).astype(int)
ages = np.clip(ages, 18, 90)

plt.figure(figsize=(10, 6))
plt.hist(ages, bins=15, color='lightgreen', edgecolor='black', alpha=0.7)
plt.xlabel('å¹´é¾„ (å²)')
plt.ylabel('äººæ•°')
plt.title('æ‚£è€…å¹´é¾„åˆ†å¸ƒç›´æ–¹å›¾')
plt.grid(True, alpha=0.3, axis='y')
plt.tight_layout()
plt.show()
```

### 5. æ•£ç‚¹å›¾ - ç›¸å…³æ€§åˆ†æ

```python
import matplotlib.pyplot as plt
import numpy as np

# èº«é«˜ä½“é‡å…³ç³»
np.random.seed(42)
heights = np.random.normal(1.70, 0.10, 100)
weights = heights * 40 + np.random.normal(0, 5, 100)

plt.figure(figsize=(10, 6))
plt.scatter(heights, weights, alpha=0.6, s=50)
plt.xlabel('èº«é«˜ (m)')
plt.ylabel('ä½“é‡ (kg)')
plt.title('èº«é«˜ä¸ä½“é‡å…³ç³»')
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
```

### 6. ç®±çº¿å›¾ - æ•°æ®åˆ†å¸ƒå’Œå¼‚å¸¸å€¼

```python
import matplotlib.pyplot as plt
import numpy as np

# ä¸‰ç»„æ‚£è€…çš„è¡€å‹æ•°æ®
np.random.seed(42)
group1 = np.random.normal(130, 15, 50)
group2 = np.random.normal(140, 18, 50)
group3 = np.random.normal(150, 20, 50)

data = [group1, group2, group3]
labels = ['å¯¹ç…§ç»„', 'æ²»ç–—ç»„A', 'æ²»ç–—ç»„B']

plt.figure(figsize=(10, 6))
plt.boxplot(data, labels=labels)
plt.ylabel('æ”¶ç¼©å‹ (mmHg)')
plt.title('å„ç»„è¡€å‹åˆ†å¸ƒç®±çº¿å›¾')
plt.grid(True, alpha=0.3, axis='y')
plt.tight_layout()
plt.show()
```

### 7. é¥¼å›¾ - æ¯”ä¾‹æ„æˆ

```python
import matplotlib.pyplot as plt

# ç–¾ç—…æ„æˆ
diseases = ['é«˜è¡€å‹', 'ç³–å°¿ç—…', 'å† å¿ƒç—…', 'é«˜è¡€è„‚', 'å…¶ä»–']
proportions = [35, 25, 18, 12, 10]

plt.figure(figsize=(8, 8))
plt.pie(proportions, labels=diseases, autopct='%1.1f%%',
        startangle=90, colors=['#ff9999','#66b3ff','#99ff99','#ffcc99','#ff99cc'])
plt.title('ç–¾ç—…è°±æ„æˆ')
plt.axis('equal')
plt.tight_layout()
plt.show()
```

## å­å›¾å¸ƒå±€

### 1. å¤šå­å›¾

```python
import matplotlib.pyplot as plt
import numpy as np

# åˆ›å»º2Ã—2å­å›¾
fig, axes = plt.subplots(2, 2, figsize=(12, 10))

# å­å›¾1:æŠ˜çº¿å›¾
days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”']
glucose = [6.2, 5.8, 6.5, 7.1, 6.0]
axes[0, 0].plot(days, glucose, marker='o')
axes[0, 0].set_title('è¡€ç³–è¶‹åŠ¿')
axes[0, 0].set_ylabel('è¡€ç³– (mmol/L)')

# å­å›¾2:æŸ±çŠ¶å›¾
axes[0, 1].bar(['ç”·', 'å¥³'], [45, 55])
axes[0, 1].set_title('æ€§åˆ«åˆ†å¸ƒ')
axes[0, 1].set_ylabel('äººæ•°')

# å­å›¾3:ç›´æ–¹å›¾
ages = np.random.normal(55, 15, 100).astype(int)
axes[1, 0].hist(ages, bins=15, color='lightgreen', edgecolor='black')
axes[1, 0].set_title('å¹´é¾„åˆ†å¸ƒ')
axes[1, 0].set_xlabel('å¹´é¾„ (å²)')

# å­å›¾4:æ•£ç‚¹å›¾
heights = np.random.normal(1.70, 0.10, 100)
weights = heights * 40 + np.random.normal(0, 5, 100)
axes[1, 1].scatter(heights, weights, alpha=0.6)
axes[1, 1].set_title('èº«é«˜-ä½“é‡å…³ç³»')
axes[1, 1].set_xlabel('èº«é«˜ (m)')
axes[1, 1].set_ylabel('ä½“é‡ (kg)')

plt.tight_layout()
plt.show()
```

## å›¾è¡¨ç¾åŒ–

### 1. é¢œè‰²å’Œæ ·å¼

```python
import matplotlib.pyplot as plt

# æ•°æ®
x = [1, 2, 3, 4, 5]
y1 = [2, 4, 6, 8, 10]
y2 = [1, 3, 5, 7, 9]

plt.figure(figsize=(10, 6))

# ä¸åŒé¢œè‰²å’Œæ ·å¼
plt.plot(x, y1, color='blue', linestyle='-', linewidth=2, marker='o', label='ç»„1')
plt.plot(x, y2, color='red', linestyle='--', linewidth=2, marker='s', label='ç»„2')

plt.xlabel('æ—¶é—´ç‚¹')
plt.ylabel('è¡€å‹ (mmHg)')
plt.title('ä¸¤ç»„æ‚£è€…è¡€å‹å¯¹æ¯”')
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
```

### 2. ä¸­æ–‡æ˜¾ç¤ºé…ç½®

```python
import matplotlib.pyplot as plt

# é…ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows
# plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']  # macOS
plt.rcParams['axes.unicode_minus'] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜

# ç°åœ¨å¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡äº†
plt.figure(figsize=(8, 6))
plt.plot([1, 2, 3], [4, 5, 6])
plt.xlabel('æ—¶é—´')
plt.ylabel('è¡€å‹')
plt.title('è¡€å‹ç›‘æµ‹å›¾è¡¨')
plt.show()
```

### 3. ä¿å­˜å›¾è¡¨

```python
import matplotlib.pyplot as plt

plt.figure(figsize=(10, 6))
plt.plot([1, 2, 3], [4, 5, 6])
plt.title('ç¤ºä¾‹å›¾è¡¨')

# ä¿å­˜ä¸ºä¸åŒæ ¼å¼
plt.savefig('chart.png', dpi=300, bbox_inches='tight')  # é«˜åˆ†è¾¨ç‡PNG
plt.savefig('chart.pdf', bbox_inches='tight')  # PDF(çŸ¢é‡å›¾)
plt.savefig('chart.svg', bbox_inches='tight')  # SVG(çŸ¢é‡å›¾)

plt.show()
```

## åŒ»å­¦åœºæ™¯ç»¼åˆæ¡ˆä¾‹

### æ¡ˆä¾‹:ä¸´åºŠè¯•éªŒå¯è§†åŒ–æŠ¥å‘Š

```python
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd

# é…ç½®ä¸­æ–‡
plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

# æ¨¡æ‹Ÿæ•°æ®
np.random.seed(42)

# å¯¹ç…§ç»„å’Œæ²»ç–—ç»„æ•°æ®
control_baseline = np.random.normal(150, 15, 50)
control_followup = control_baseline - np.random.normal(5, 8, 50)

treatment_baseline = np.random.normal(148, 16, 50)
treatment_followup = treatment_baseline - np.random.normal(20, 10, 50)

# åˆ›å»ºå›¾è¡¨
fig = plt.figure(figsize=(16, 12))

# å­å›¾1:åŸºçº¿è¡€å‹å¯¹æ¯”(ç®±çº¿å›¾)
ax1 = plt.subplot(2, 3, 1)
ax1.boxplot([control_baseline, treatment_baseline],
            labels=['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'])
ax1.set_ylabel('æ”¶ç¼©å‹ (mmHg)')
ax1.set_title('åŸºçº¿è¡€å‹åˆ†å¸ƒ')
ax1.grid(True, alpha=0.3, axis='y')

# å­å›¾2:éšè®¿è¡€å‹å¯¹æ¯”(ç®±çº¿å›¾)
ax2 = plt.subplot(2, 3, 2)
ax2.boxplot([control_followup, treatment_followup],
            labels=['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'])
ax2.set_ylabel('æ”¶ç¼©å‹ (mmHg)')
ax2.set_title('éšè®¿è¡€å‹åˆ†å¸ƒ')
ax2.grid(True, alpha=0.3, axis='y')

# å­å›¾3:é™å‹å¹…åº¦å¯¹æ¯”(æŸ±çŠ¶å›¾)
ax3 = plt.subplot(2, 3, 3)
control_reduction = control_baseline.mean() - control_followup.mean()
treatment_reduction = treatment_baseline.mean() - treatment_followup.mean()
ax3.bar(['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'], [control_reduction, treatment_reduction],
       color=['lightcoral', 'lightblue'])
ax3.set_ylabel('é™å‹å¹…åº¦ (mmHg)')
ax3.set_title('å¹³å‡é™å‹æ•ˆæœ')
ax3.grid(True, alpha=0.3, axis='y')

# å­å›¾4:å¯¹ç…§ç»„æ•£ç‚¹å›¾
ax4 = plt.subplot(2, 3, 4)
ax4.scatter(control_baseline, control_followup, alpha=0.6)
ax4.plot([90, 180], [90, 180], 'r--', label='æ— å˜åŒ–çº¿')
ax4.set_xlabel('åŸºçº¿è¡€å‹ (mmHg)')
ax4.set_ylabel('éšè®¿è¡€å‹ (mmHg)')
ax4.set_title('å¯¹ç…§ç»„è¡€å‹å˜åŒ–')
ax4.legend()
ax4.grid(True, alpha=0.3)

# å­å›¾5:æ²»ç–—ç»„æ•£ç‚¹å›¾
ax5 = plt.subplot(2, 3, 5)
ax5.scatter(treatment_baseline, treatment_followup, alpha=0.6, color='green')
ax5.plot([90, 180], [90, 180], 'r--', label='æ— å˜åŒ–çº¿')
ax5.set_xlabel('åŸºçº¿è¡€å‹ (mmHg)')
ax5.set_ylabel('éšè®¿è¡€å‹ (mmHg)')
ax5.set_title('æ²»ç–—ç»„è¡€å‹å˜åŒ–')
ax5.legend()
ax5.grid(True, alpha=0.3)

# å­å›¾6:è¾¾æ ‡ç‡å¯¹æ¯”(é¥¼å›¾)
ax6 = plt.subplot(2, 3, 6)
control_target = np.sum(control_followup < 140) / 50 * 100
treatment_target = np.sum(treatment_followup < 140) / 50 * 100

x = np.arange(2)
bars = ax6.bar(x, [control_target, treatment_target],
               color=['lightcoral', 'lightblue'])
ax6.set_xticks(x)
ax6.set_xticklabels(['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'])
ax6.set_ylabel('è¾¾æ ‡ç‡ (%)')
ax6.set_title('è¡€å‹è¾¾æ ‡ç‡(<140 mmHg)')
ax6.set_ylim([0, 100])

# åœ¨æŸ±ä¸Šæ˜¾ç¤ºæ•°å€¼
for bar in bars:
    height = bar.get_height()
    ax6.text(bar.get_x() + bar.get_width()/2., height,
            f'{height:.1f}%', ha='center', va='bottom')

plt.suptitle('é™å‹è¯ç‰©ä¸´åºŠè¯•éªŒå¯è§†åŒ–åˆ†ææŠ¥å‘Š', fontsize=16, fontweight='bold', y=0.98)
plt.tight_layout(rect=[0, 0, 1, 0.96])

# ä¿å­˜
plt.savefig('clinical_trial_report.png', dpi=300, bbox_inches='tight')
plt.show()

# æ‰“å°ç»Ÿè®¡æ‘˜è¦
print("="*60)
print("ä¸´åºŠè¯•éªŒç»Ÿè®¡æ‘˜è¦")
print("="*60)
print(f"\nå¯¹ç…§ç»„ (n=50):")
print(f"  åŸºçº¿è¡€å‹: {control_baseline.mean():.1f} Â± {control_baseline.std():.1f} mmHg")
print(f"  éšè®¿è¡€å‹: {control_followup.mean():.1f} Â± {control_followup.std():.1f} mmHg")
print(f"  é™å‹å¹…åº¦: {control_reduction:.1f} mmHg")
print(f"  è¾¾æ ‡ç‡: {control_target:.1f}%")

print(f"\næ²»ç–—ç»„ (n=50):")
print(f"  åŸºçº¿è¡€å‹: {treatment_baseline.mean():.1f} Â± {treatment_baseline.std():.1f} mmHg")
print(f"  éšè®¿è¡€å‹: {treatment_followup.mean():.1f} Â± {treatment_followup.std():.1f} mmHg")
print(f"  é™å‹å¹…åº¦: {treatment_reduction:.1f} mmHg")
print(f"  è¾¾æ ‡ç‡: {treatment_target:.1f}%")

print(f"\nç»„é—´å·®å¼‚:")
print(f"  é™å‹å¹…åº¦å·®å¼‚: {treatment_reduction - control_reduction:.1f} mmHg")
print(f"  è¾¾æ ‡ç‡å·®å¼‚: {treatment_target - control_target:.1f}%")
print("="*60)
```

## ğŸ’¡ å…³é”®è¦ç‚¹

### å¸¸ç”¨å›¾è¡¨é€‰æ‹©æŒ‡å—

| æ•°æ®ç±»å‹ | æ¨èå›¾è¡¨ | ç”¨é€” |
|---------|---------|------|
| æ—¶é—´åºåˆ— | æŠ˜çº¿å›¾ | è¶‹åŠ¿å˜åŒ– |
| åˆ†ç±»æ¯”è¾ƒ | æŸ±çŠ¶å›¾ | ç»„é—´å¯¹æ¯” |
| æ•°æ®åˆ†å¸ƒ | ç›´æ–¹å›¾ã€ç®±çº¿å›¾ | åˆ†å¸ƒæƒ…å†µ |
| ç›¸å…³å…³ç³» | æ•£ç‚¹å›¾ | ä¸¤å˜é‡å…³ç³» |
| æ¯”ä¾‹æ„æˆ | é¥¼å›¾ | å æ¯”æƒ…å†µ |

### Matplotlibå¸¸ç”¨å‘½ä»¤

```python
# åˆ›å»ºå›¾è¡¨
plt.figure(figsize=(10, 6))

# ç»˜å›¾
plt.plot(x, y)  # æŠ˜çº¿å›¾
plt.bar(x, y)  # æŸ±çŠ¶å›¾
plt.hist(data)  # ç›´æ–¹å›¾
plt.scatter(x, y)  # æ•£ç‚¹å›¾
plt.boxplot(data)  # ç®±çº¿å›¾

# æ ‡ç­¾
plt.xlabel('Xè½´æ ‡ç­¾')
plt.ylabel('Yè½´æ ‡ç­¾')
plt.title('æ ‡é¢˜')
plt.legend()  # å›¾ä¾‹

# å…¶ä»–
plt.grid(True)  # ç½‘æ ¼
plt.tight_layout()  # è‡ªåŠ¨è°ƒæ•´å¸ƒå±€
plt.savefig('file.png')  # ä¿å­˜
plt.show()  # æ˜¾ç¤º
```

## ä¸‹ä¸€æ­¥

æŒæ¡äº†æ•°æ®å¯è§†åŒ–å,ä¸‹ä¸€èŠ‚[å®æˆ˜:åˆ†æä¸´åºŠè¯•éªŒæ•°æ®](4.4-practice-analysis.md)å°†ç»¼åˆè¿ç”¨Pandasã€NumPyå’ŒMatplotlib!

---

## ğŸ”¨ ç»ƒä¹ ä»»åŠ¡

```python
# ä»»åŠ¡1: ç»˜åˆ¶ä¸€å‘¨è¡€å‹ç›‘æµ‹å›¾
# æŠ˜çº¿å›¾,åŒ…å«æ”¶ç¼©å‹å’Œèˆ’å¼ å‹ä¸¤æ¡çº¿

# ä»»åŠ¡2: ç–¾ç—…è°±ç»Ÿè®¡
# è¯»å–æ‚£è€…æ•°æ®,ç»˜åˆ¶Top 10ç–¾ç—…çš„æ°´å¹³æŸ±çŠ¶å›¾

# ä»»åŠ¡3: å¹´é¾„-è¡€å‹å…³ç³»
# ç»˜åˆ¶æ•£ç‚¹å›¾,åˆ†æå¹´é¾„å’Œè¡€å‹çš„å…³ç³»

# ä»»åŠ¡4: åˆ›å»º2Ã—2å­å›¾
# åŒ…å«:æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€ç›´æ–¹å›¾ã€ç®±çº¿å›¾
```

> ğŸ’¡ æç¤º:Matplotlibçš„Galleryæœ‰å¤§é‡ç¤ºä¾‹,å¯ä»¥å‚è€ƒå­¦ä¹ !
