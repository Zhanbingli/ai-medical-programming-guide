# 4.2 NumPy:æ•°å€¼è®¡ç®—åŸºç¡€

## ä¸ºä»€ä¹ˆéœ€è¦NumPy?

### Pythonåˆ—è¡¨ vs NumPyæ•°ç»„

**åœºæ™¯**:è®¡ç®—100åæ‚£è€…çš„BMI

#### Pythonåˆ—è¡¨æ–¹å¼

```python
weights = [70, 85, 55, 92, 68, ...]  # 100ä¸ªæ•°æ®
heights = [1.75, 1.68, 1.62, 1.80, 1.72, ...]

# è®¡ç®—BMI(éœ€è¦å¾ªç¯)
bmis = []
for w, h in zip(weights, heights):
    bmi = w / (h ** 2)
    bmis.append(bmi)
```

#### NumPyæ•°ç»„æ–¹å¼

```python
import numpy as np

weights = np.array([70, 85, 55, 92, 68, ...])
heights = np.array([1.75, 1.68, 1.62, 1.80, 1.72, ...])

# å‘é‡åŒ–è®¡ç®—(æ— éœ€å¾ªç¯!)
bmis = weights / (heights ** 2)
```

**NumPyä¼˜åŠ¿**:
- âœ… **é€Ÿåº¦å¿«** - æ¯”Pythonåˆ—è¡¨å¿«10-100å€
- âœ… **ä»£ç ç®€æ´** - å‘é‡åŒ–æ“ä½œ,æ— éœ€å¾ªç¯
- âœ… **å†…å­˜æ•ˆç‡é«˜** - å­˜å‚¨æ›´ç´§å‡‘
- âœ… **åŠŸèƒ½å¼ºå¤§** - çŸ©é˜µè¿ç®—ã€ç»Ÿè®¡åˆ†æ

## NumPyåŸºç¡€

### 1. åˆ›å»ºæ•°ç»„

```python
import numpy as np

# ä»åˆ—è¡¨åˆ›å»º
arr = np.array([1, 2, 3, 4, 5])
print(arr)  # [1 2 3 4 5]

# äºŒç»´æ•°ç»„(çŸ©é˜µ)
matrix = np.array([[1, 2, 3], [4, 5, 6]])
print(matrix)
# [[1 2 3]
#  [4 5 6]]

# ç‰¹æ®Šæ•°ç»„
zeros = np.zeros(5)  # [0. 0. 0. 0. 0.]
ones = np.ones((3, 4))  # 3Ã—4å…¨1çŸ©é˜µ
empty = np.empty((2, 3))  # æœªåˆå§‹åŒ–æ•°ç»„

# ç­‰å·®æ•°åˆ—
arr = np.arange(0, 10, 2)  # [0 2 4 6 8]
arr = np.linspace(0, 10, 5)  # [0.  2.5 5.  7.5 10.]

# éšæœºæ•°ç»„
random_arr = np.random.rand(5)  # 5ä¸ª[0,1)éšæœºæ•°
random_int = np.random.randint(1, 100, 10)  # 10ä¸ª[1,100)éšæœºæ•´æ•°
```

### 2. æ•°ç»„å±æ€§

```python
import numpy as np

arr = np.array([[1, 2, 3], [4, 5, 6]])

print(arr.shape)  # (2, 3) - å½¢çŠ¶
print(arr.ndim)  # 2 - ç»´åº¦æ•°
print(arr.size)  # 6 - å…ƒç´ æ€»æ•°
print(arr.dtype)  # int64 - æ•°æ®ç±»å‹
```

### 3. æ•°ç»„ç´¢å¼•å’Œåˆ‡ç‰‡

```python
import numpy as np

# ä¸€ç»´æ•°ç»„
arr = np.array([10, 20, 30, 40, 50])
print(arr[0])  # 10
print(arr[-1])  # 50
print(arr[1:4])  # [20 30 40]

# äºŒç»´æ•°ç»„
matrix = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
print(matrix[0, 0])  # 1 - ç¬¬1è¡Œç¬¬1åˆ—
print(matrix[1, 2])  # 6 - ç¬¬2è¡Œç¬¬3åˆ—
print(matrix[0, :])  # [1 2 3] - ç¬¬1è¡Œæ‰€æœ‰åˆ—
print(matrix[:, 1])  # [2 5 8] - æ‰€æœ‰è¡Œç¬¬2åˆ—

# æ¡ä»¶ç´¢å¼•(å¸ƒå°”ç´¢å¼•)
arr = np.array([10, 20, 30, 40, 50])
high_values = arr[arr > 25]  # [30 40 50]
```

## æ•°ç»„è¿ç®—

### 1. ç®—æœ¯è¿ç®—(å‘é‡åŒ–)

```python
import numpy as np

# åŸºæœ¬è¿ç®—
arr = np.array([1, 2, 3, 4, 5])

print(arr + 10)  # [11 12 13 14 15]
print(arr * 2)  # [2 4 6 8 10]
print(arr ** 2)  # [1 4 9 16 25]
print(1 / arr)  # [1.  0.5 0.333... 0.25 0.2]

# æ•°ç»„é—´è¿ç®—
arr1 = np.array([1, 2, 3])
arr2 = np.array([4, 5, 6])

print(arr1 + arr2)  # [5 7 9]
print(arr1 * arr2)  # [4 10 18]
```

### 2. åŒ»å­¦åœºæ™¯:BMIæ‰¹é‡è®¡ç®—

```python
import numpy as np

# 100åæ‚£è€…æ•°æ®
np.random.seed(42)
weights = np.random.uniform(50, 100, 100)  # ä½“é‡50-100kg
heights = np.random.uniform(1.5, 1.9, 100)  # èº«é«˜1.5-1.9m

# æ‰¹é‡è®¡ç®—BMI(å‘é‡åŒ–)
bmis = weights / (heights ** 2)

# ç»Ÿè®¡
print(f"å¹³å‡BMI: {bmis.mean():.2f}")
print(f"BMIæ ‡å‡†å·®: {bmis.std():.2f}")
print(f"BMIèŒƒå›´: {bmis.min():.2f} - {bmis.max():.2f}")

# BMIåˆ†ç±»
normal = np.sum((bmis >= 18.5) & (bmis < 24))
overweight = np.sum((bmis >= 24) & (bmis < 28))
obese = np.sum(bmis >= 28)

print(f"\nä½“é‡æ­£å¸¸: {normal}äºº ({normal/100*100:.1f}%)")
print(f"è¶…é‡: {overweight}äºº ({overweight/100*100:.1f}%)")
print(f"è‚¥èƒ–: {obese}äºº ({obese/100*100:.1f}%)")
```

## ç»Ÿè®¡å‡½æ•°

### 1. åŸºæœ¬ç»Ÿè®¡

```python
import numpy as np

data = np.array([6.2, 5.8, 6.5, 7.1, 6.0, 5.9, 6.3])

# æè¿°æ€§ç»Ÿè®¡
print(f"å¹³å‡å€¼: {np.mean(data):.2f}")
print(f"ä¸­ä½æ•°: {np.median(data):.2f}")
print(f"æ ‡å‡†å·®: {np.std(data):.2f}")
print(f"æ–¹å·®: {np.var(data):.2f}")
print(f"æœ€å°å€¼: {np.min(data):.2f}")
print(f"æœ€å¤§å€¼: {np.max(data):.2f}")
print(f"æ±‚å’Œ: {np.sum(data):.2f}")

# ç™¾åˆ†ä½æ•°
print(f"25%åˆ†ä½æ•°: {np.percentile(data, 25):.2f}")
print(f"75%åˆ†ä½æ•°: {np.percentile(data, 75):.2f}")
```

### 2. è½´å‘æ“ä½œ

```python
import numpy as np

# äºŒç»´æ•°ç»„(3åæ‚£è€…,5æ¬¡è¡€ç³–æµ‹é‡)
glucose = np.array([
    [6.2, 5.8, 6.5, 7.1, 6.0],  # æ‚£è€…1
    [7.5, 8.2, 7.8, 7.3, 7.6],  # æ‚£è€…2
    [5.5, 5.3, 5.8, 5.6, 5.4]   # æ‚£è€…3
])

# æ¯ä¸ªæ‚£è€…çš„å¹³å‡è¡€ç³–(æ²¿è¡Œæ–¹å‘)
patient_avg = np.mean(glucose, axis=1)
print(f"å„æ‚£è€…å¹³å‡è¡€ç³–: {patient_avg}")

# æ¯æ¬¡æµ‹é‡çš„å¹³å‡å€¼(æ²¿åˆ—æ–¹å‘)
time_avg = np.mean(glucose, axis=0)
print(f"å„æ¬¡æµ‹é‡å¹³å‡: {time_avg}")

# å…¨ä½“å¹³å‡
total_avg = np.mean(glucose)
print(f"æ€»ä½“å¹³å‡è¡€ç³–: {total_avg:.2f}")
```

## æ•°ç»„å˜å½¢

```python
import numpy as np

# åŸæ•°ç»„
arr = np.array([1, 2, 3, 4, 5, 6])

# å˜å½¢
matrix = arr.reshape(2, 3)  # å˜ä¸º2Ã—3çŸ©é˜µ
print(matrix)
# [[1 2 3]
#  [4 5 6]]

# è½¬ç½®
transposed = matrix.T
print(transposed)
# [[1 4]
#  [2 5]
#  [3 6]]

# å±•å¹³
flattened = matrix.flatten()
print(flattened)  # [1 2 3 4 5 6]

# å¢åŠ ç»´åº¦
arr_2d = arr[:, np.newaxis]  # å˜ä¸ºåˆ—å‘é‡
```

## æ•°ç»„åˆå¹¶ä¸åˆ†å‰²

```python
import numpy as np

# åˆå¹¶
arr1 = np.array([1, 2, 3])
arr2 = np.array([4, 5, 6])

# å‚ç›´å †å 
vstacked = np.vstack([arr1, arr2])
print(vstacked)
# [[1 2 3]
#  [4 5 6]]

# æ°´å¹³å †å 
hstacked = np.hstack([arr1, arr2])
print(hstacked)  # [1 2 3 4 5 6]

# æ‹¼æ¥
concatenated = np.concatenate([arr1, arr2])
print(concatenated)  # [1 2 3 4 5 6]

# åˆ†å‰²
arr = np.array([1, 2, 3, 4, 5, 6])
split = np.split(arr, 3)  # åˆ†æˆ3ä»½
print(split)  # [array([1, 2]), array([3, 4]), array([5, 6])]
```

## åŒ»å­¦åœºæ™¯:è¡€å‹æ•°æ®åˆ†æ

```python
import numpy as np

# æ¨¡æ‹Ÿ100åæ‚£è€…çš„è¡€å‹æ•°æ®
np.random.seed(42)

# ç”Ÿæˆæ•°æ®
systolic = np.random.normal(130, 20, 100)  # æ”¶ç¼©å‹,å‡å€¼130,æ ‡å‡†å·®20
diastolic = np.random.normal(80, 10, 100)  # èˆ’å¼ å‹,å‡å€¼80,æ ‡å‡†å·®10

# ç¡®ä¿åˆç†èŒƒå›´
systolic = np.clip(systolic, 90, 200)
diastolic = np.clip(diastolic, 60, 120)

print("="*60)
print("è¡€å‹æ•°æ®åˆ†æ")
print("="*60)

# æè¿°æ€§ç»Ÿè®¡
print("\næ”¶ç¼©å‹ç»Ÿè®¡:")
print(f"  å¹³å‡å€¼: {np.mean(systolic):.1f} mmHg")
print(f"  ä¸­ä½æ•°: {np.median(systolic):.1f} mmHg")
print(f"  æ ‡å‡†å·®: {np.std(systolic):.1f} mmHg")
print(f"  èŒƒå›´: {np.min(systolic):.1f} - {np.max(systolic):.1f} mmHg")

print("\nèˆ’å¼ å‹ç»Ÿè®¡:")
print(f"  å¹³å‡å€¼: {np.mean(diastolic):.1f} mmHg")
print(f"  ä¸­ä½æ•°: {np.median(diastolic):.1f} mmHg")
print(f"  æ ‡å‡†å·®: {np.std(diastolic):.1f} mmHg")
print(f"  èŒƒå›´: {np.min(diastolic):.1f} - {np.max(diastolic):.1f} mmHg")

# è¡€å‹åˆ†çº§
normal = np.sum((systolic < 120) & (diastolic < 80))
prehypertension = np.sum(((systolic >= 120) & (systolic < 140)) |
                         ((diastolic >= 80) & (diastolic < 90)))
stage1 = np.sum(((systolic >= 140) & (systolic < 160)) |
                ((diastolic >= 90) & (diastolic < 100)))
stage2 = np.sum((systolic >= 160) | (diastolic >= 100))

print("\nè¡€å‹åˆ†çº§:")
print(f"  æ­£å¸¸è¡€å‹: {normal}äºº ({normal/100*100:.1f}%)")
print(f"  æ­£å¸¸é«˜å€¼: {prehypertension}äºº ({prehypertension/100*100:.1f}%)")
print(f"  1çº§é«˜è¡€å‹: {stage1}äºº ({stage1/100*100:.1f}%)")
print(f"  2çº§é«˜è¡€å‹: {stage2}äºº ({stage2/100*100:.1f}%)")

# è„‰å‹å·®åˆ†æ
pulse_pressure = systolic - diastolic
print("\nè„‰å‹å·®åˆ†æ:")
print(f"  å¹³å‡è„‰å‹å·®: {np.mean(pulse_pressure):.1f} mmHg")
print(f"  è„‰å‹å·® >60 çš„äººæ•°: {np.sum(pulse_pressure > 60)}äºº")

# ç›¸å…³æ€§åˆ†æ(ç®€å•)
correlation = np.corrcoef(systolic, diastolic)[0, 1]
print(f"\næ”¶ç¼©å‹ä¸èˆ’å¼ å‹ç›¸å…³ç³»æ•°: {correlation:.3f}")

print("="*60)
```

## éšæœºæ•°ç”Ÿæˆ

### 1. åŸºæœ¬éšæœºæ•°

```python
import numpy as np

# è®¾ç½®éšæœºç§å­(ä¿è¯å¯é‡å¤)
np.random.seed(42)

# å‡åŒ€åˆ†å¸ƒ[0, 1)
uniform = np.random.rand(5)

# æ­£æ€åˆ†å¸ƒ(å‡å€¼0,æ ‡å‡†å·®1)
normal = np.random.randn(5)

# æŒ‡å®šèŒƒå›´çš„å‡åŒ€åˆ†å¸ƒ
ages = np.random.uniform(20, 80, 100)  # å¹´é¾„20-80å²

# æŒ‡å®šå‚æ•°çš„æ­£æ€åˆ†å¸ƒ
glucose = np.random.normal(6.0, 1.5, 100)  # è¡€ç³–,å‡å€¼6.0,æ ‡å‡†å·®1.5

# éšæœºæ•´æ•°
patient_ids = np.random.randint(1, 1000, 50)  # 50ä¸ª1-999çš„ID

# éšæœºé€‰æ‹©
diagnoses = np.random.choice(['é«˜è¡€å‹', 'ç³–å°¿ç—…', 'é«˜è¡€è„‚'], 100)
```

### 2. åŒ»å­¦åœºæ™¯:æ¨¡æ‹Ÿä¸´åºŠè¯•éªŒæ•°æ®

```python
import numpy as np

def generate_trial_data(n_patients=100, seed=42):
    """
    ç”Ÿæˆæ¨¡æ‹Ÿä¸´åºŠè¯•éªŒæ•°æ®

    å‚æ•°:
        n_patients: æ‚£è€…æ•°é‡
        seed: éšæœºç§å­

    è¿”å›:
        dict: åŒ…å«å„é¡¹æ•°æ®çš„å­—å…¸
    """
    np.random.seed(seed)

    # åŸºæœ¬ä¿¡æ¯
    ages = np.random.normal(55, 15, n_patients).astype(int)
    ages = np.clip(ages, 18, 90)  # é™åˆ¶åœ¨18-90å²

    genders = np.random.choice(['ç”·', 'å¥³'], n_patients)

    # åŸºçº¿æ•°æ®
    baseline_sbp = np.random.normal(150, 20, n_patients)
    baseline_dbp = np.random.normal(95, 10, n_patients)

    # æ²»ç–—åæ•°æ®(å‡è®¾æ²»ç–—æœ‰æ•ˆ,é™ä½è¡€å‹)
    # æ²»ç–—ç»„é™å‹æ•ˆæœæ›´å¥½
    treatment_effect = np.random.normal(-20, 5, n_patients)
    followup_sbp = baseline_sbp + treatment_effect
    followup_dbp = baseline_dbp + treatment_effect * 0.5

    # ç¡®ä¿åˆç†èŒƒå›´
    followup_sbp = np.clip(followup_sbp, 90, 180)
    followup_dbp = np.clip(followup_dbp, 60, 110)

    # è®¡ç®—å˜åŒ–
    sbp_change = followup_sbp - baseline_sbp
    dbp_change = followup_dbp - baseline_dbp

    return {
        'å¹´é¾„': ages,
        'æ€§åˆ«': genders,
        'åŸºçº¿æ”¶ç¼©å‹': baseline_sbp,
        'åŸºçº¿èˆ’å¼ å‹': baseline_dbp,
        'éšè®¿æ”¶ç¼©å‹': followup_sbp,
        'éšè®¿èˆ’å¼ å‹': followup_dbp,
        'æ”¶ç¼©å‹å˜åŒ–': sbp_change,
        'èˆ’å¼ å‹å˜åŒ–': dbp_change
    }

# ç”Ÿæˆæ•°æ®
data = generate_trial_data(100)

# åˆ†æ
print("="*60)
print("ä¸´åºŠè¯•éªŒæ•°æ®åˆ†æ")
print("="*60)

print(f"\næ€»æ ·æœ¬é‡: {len(data['å¹´é¾„'])}äºº")
print(f"å¹³å‡å¹´é¾„: {np.mean(data['å¹´é¾„']):.1f}å²")
print(f"ç”·æ€§æ¯”ä¾‹: {np.sum(data['æ€§åˆ«']=='ç”·')/len(data['æ€§åˆ«'])*100:.1f}%")

print("\nåŸºçº¿è¡€å‹:")
print(f"  æ”¶ç¼©å‹: {np.mean(data['åŸºçº¿æ”¶ç¼©å‹']):.1f} Â± {np.std(data['åŸºçº¿æ”¶ç¼©å‹']):.1f} mmHg")
print(f"  èˆ’å¼ å‹: {np.mean(data['åŸºçº¿èˆ’å¼ å‹']):.1f} Â± {np.std(data['åŸºçº¿èˆ’å¼ å‹']):.1f} mmHg")

print("\néšè®¿è¡€å‹:")
print(f"  æ”¶ç¼©å‹: {np.mean(data['éšè®¿æ”¶ç¼©å‹']):.1f} Â± {np.std(data['éšè®¿æ”¶ç¼©å‹']):.1f} mmHg")
print(f"  èˆ’å¼ å‹: {np.mean(data['éšè®¿èˆ’å¼ å‹']):.1f} Â± {np.std(data['éšè®¿èˆ’å¼ å‹']):.1f} mmHg")

print("\nè¡€å‹å˜åŒ–:")
print(f"  æ”¶ç¼©å‹é™ä½: {-np.mean(data['æ”¶ç¼©å‹å˜åŒ–']):.1f} Â± {np.std(data['æ”¶ç¼©å‹å˜åŒ–']):.1f} mmHg")
print(f"  èˆ’å¼ å‹é™ä½: {-np.mean(data['èˆ’å¼ å‹å˜åŒ–']):.1f} Â± {np.std(data['èˆ’å¼ å‹å˜åŒ–']):.1f} mmHg")

# è¾¾æ ‡ç‡(æ”¶ç¼©å‹<140)
target_achieved = np.sum(data['éšè®¿æ”¶ç¼©å‹'] < 140)
print(f"\nè¾¾æ ‡ç‡: {target_achieved/len(data['å¹´é¾„'])*100:.1f}%")

print("="*60)
```

## NumPyä¸Pandasç»“åˆ

```python
import numpy as np
import pandas as pd

# NumPyæ•°ç»„è½¬DataFrame
ages = np.array([45, 52, 38, 68, 55])
names = np.array(['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'å­™ä¸ƒ'])

df = pd.DataFrame({
    'å§“å': names,
    'å¹´é¾„': ages
})

# DataFrameè½¬NumPyæ•°ç»„
age_array = df['å¹´é¾„'].values  # æå–ä¸ºNumPyæ•°ç»„
all_data = df.values  # æ•´ä¸ªDataFrameè½¬ä¸ºæ•°ç»„

# NumPyè¿ç®—ç»“æœæ·»åŠ åˆ°DataFrame
df['BMI'] = np.random.uniform(20, 30, 5)
df['å¹´é¾„ç»„'] = np.where(df['å¹´é¾„'] >= 60, 'è€å¹´', 'ä¸­é’å¹´')

print(df)
```

## ğŸ’¡ å…³é”®è¦ç‚¹

### NumPyæ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æ–¹æ³• | ç¤ºä¾‹ |
|------|------|------|
| **åˆ›å»ºæ•°ç»„** | array, zeros, ones | `np.array([1,2,3])` |
| **ç®—æœ¯è¿ç®—** | +, -, *, /, ** | `arr * 2` |
| **ç»Ÿè®¡** | mean, std, min, max | `np.mean(arr)` |
| **æ¡ä»¶ç­›é€‰** | å¸ƒå°”ç´¢å¼• | `arr[arr > 10]` |
| **å˜å½¢** | reshape, T | `arr.reshape(2,3)` |
| **éšæœºæ•°** | random.rand, normal | `np.random.rand(5)` |

### NumPy vs Pythonåˆ—è¡¨

| ç‰¹æ€§ | Pythonåˆ—è¡¨ | NumPyæ•°ç»„ |
|------|-----------|----------|
| **é€Ÿåº¦** | æ…¢ | å¿«(10-100å€) |
| **å†…å­˜** | å¤§ | å° |
| **åŠŸèƒ½** | åŸºç¡€ | ä¸°å¯Œ(ç»Ÿè®¡ã€çº¿æ€§ä»£æ•°) |
| **æ“ä½œ** | éœ€è¦å¾ªç¯ | å‘é‡åŒ– |

### ä½•æ—¶ä½¿ç”¨NumPy?

- âœ… å¤§é‡æ•°å€¼è®¡ç®—
- âœ… çŸ©é˜µè¿ç®—
- âœ… ç»Ÿè®¡åˆ†æ
- âœ… éœ€è¦æ€§èƒ½ä¼˜åŒ–

## ä¸‹ä¸€æ­¥

æŒæ¡äº†NumPyå,ä¸‹ä¸€èŠ‚[Matplotlib:ç»˜åˆ¶ç»Ÿè®¡å›¾è¡¨](4.3-matplotlib.md)å°†å­¦ä¹ æ•°æ®å¯è§†åŒ–!

---

## ğŸ”¨ ç»ƒä¹ ä»»åŠ¡

```python
# ä»»åŠ¡1: æ‰¹é‡è®¡ç®—100åæ‚£è€…çš„BMIå¹¶åˆ†ç±»
weights = np.random.uniform(50, 100, 100)
heights = np.random.uniform(1.5, 1.9, 100)
# è®¡ç®—BMI,ç»Ÿè®¡å„åˆ†ç±»äººæ•°

# ä»»åŠ¡2: åˆ†æä¸€å‘¨è¡€ç³–æ•°æ®
glucose = np.random.normal(6.5, 1.5, (10, 7))  # 10åæ‚£è€…,7å¤©æ•°æ®
# è®¡ç®—æ¯ä¸ªæ‚£è€…çš„å¹³å‡è¡€ç³–
# è®¡ç®—æ¯å¤©çš„å¹³å‡è¡€ç³–
# æ‰¾å‡ºè¡€ç³–æ§åˆ¶æœ€å¥½çš„æ‚£è€…

# ä»»åŠ¡3: æ¨¡æ‹Ÿè¯ç‰©è¯•éªŒ
# ç”Ÿæˆ100åæ‚£è€…çš„åŸºçº¿å’Œéšè®¿è¡€å‹æ•°æ®
# è®¡ç®—é™å‹æ•ˆæœ
# ç»Ÿè®¡è¾¾æ ‡ç‡
```

> ğŸ’¡ æç¤º:NumPyçš„å…³é”®æ˜¯å‘é‡åŒ–æ€ç»´,é¿å…ä½¿ç”¨å¾ªç¯!
