# 6.5 实战:用AI学习新的Python库

## 学习目标

通过一个完整案例,掌握用AI快速学习新Python库的方法:
- 案例: 学习`seaborn`库绘制医学统计图
- 时间: 30分钟从零到能用
- 成果: 绘制一张专业的临床数据可视化图表

## 传统学习 vs AI辅助学习

### 传统学习路径

```
1. 搜索"seaborn教程" → 找到一堆文章
2. 阅读官方文档 → 几百页,不知道从哪看起
3. 看视频教程 → 2小时,很多不相关内容
4. 找代码示例 → 复制粘贴,半懂不懂
5. 遇到问题 → 再搜索,再卡壳...

总耗时: 3-5小时,挫败感强
```

### AI辅助学习路径

```
1. 问AI: "seaborn是什么,能做什么?"
2. 问AI: "给个医学场景的最简示例"
3. 运行示例,遇到问题问AI
4. 问AI: "如何定制图表样式?"
5. 完成第一个实际项目

总耗时: 30分钟,成就感强
```

## 完整学习流程演示

### 第1步: 了解库的基本信息

**你问**:
```
我想学习seaborn库用于医学数据可视化。

请简要介绍:
1. seaborn是什么,解决什么问题(50字以内)
2. 与matplotlib的关系
3. 最适合绘制哪类医学图表
4. 安装方法
```

**AI答**:
```
1. seaborn简介:
基于matplotlib的高级可视化库,用一行代码生成
美观的统计图表,特别适合探索性数据分析。

2. 与matplotlib关系:
matplotlib = 画笔和颜料(底层,灵活但复杂)
seaborn = 预设的绘画模板(高级,简单但强大)

seaborn内部调用matplotlib,可以混用。

3. 适合的医学图表:
✓ 箱线图(Box plot) - 多组数据分布对比
✓ 小提琴图(Violin plot) - 数据分布可视化
✓ 散点图矩阵(Pair plot) - 多变量关系探索
✓ 热力图(Heatmap) - 相关性矩阵
✓ 分组柱状图 - 分类数据对比
✓ 回归图 - 变量关系分析

4. 安装:
```bash
pip install seaborn

# 或使用conda
conda install seaborn
```

验证安装:
```python
import seaborn as sns
print(sns.__version__)
```
```

### 第2步: 5分钟快速上手

**你问**:
```
给我一个5分钟上手教程,用seaborn绘制医学数据图表。

要求:
1. 使用简单的示例数据(患者年龄、血压等)
2. 绘制一个有意义的统计图
3. 代码带详细注释
4. 可以直接运行

从最基础的开始,让我快速看到效果。
```

**AI答**:
```python
# === 5分钟Seaborn入门:医学数据可视化 ===

import seaborn as sns
import matplotlib.pyplot as plt
import pandas as pd

# 设置中文显示
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']  # Mac
# plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows

# 1. 准备示例数据:三个科室的患者血压数据
data = pd.DataFrame({
    '科室': ['心内科']*30 + ['肾内科']*30 + ['内分泌科']*30,
    '收缩压': [135, 142, 138, 145, 132, 140, 136, 141, 139, 143,
              137, 144, 133, 139, 141, 138, 142, 136, 140, 139,
              134, 141, 137, 143, 138, 140, 136, 139, 142, 135,  # 心内科

              148, 152, 145, 149, 146, 150, 147, 151, 144, 148,
              149, 153, 146, 150, 147, 145, 151, 148, 149, 146,
              147, 150, 148, 152, 145, 149, 147, 146, 150, 148,  # 肾内科

              128, 132, 125, 130, 127, 131, 129, 126, 128, 133,
              127, 130, 126, 129, 128, 131, 127, 130, 125, 129,
              128, 132, 126, 130, 127, 129, 131, 128, 130, 126]  # 内分泌科
})

# 2. 绘制箱线图:对比三个科室的血压分布
# 一行代码搞定!
sns.boxplot(data=data, x='科室', y='收缩压')

# 3. 美化图表
plt.title('不同科室患者收缩压分布对比', fontsize=14, fontweight='bold')
plt.ylabel('收缩压 (mmHg)', fontsize=12)
plt.xlabel('科室', fontsize=12)
plt.axhline(y=140, color='r', linestyle='--', alpha=0.5, label='高血压阈值')
plt.legend()

# 4. 显示图表
plt.tight_layout()
plt.show()

print("✓ 图表已生成!")
print("\n图表解读:")
print("- 肾内科患者血压普遍较高")
print("- 内分泌科患者血压控制较好")
print("- 心内科患者血压居中")
```

**运行效果**:
[图表显示三个箱线图,清晰对比三个科室的血压分布]

**学到的知识**:
1. seaborn基本语法: sns.函数名(data=数据, x=x轴, y=y轴)
2. 箱线图可以直观显示数据分布和异常值
3. seaborn自动美化,不需要手动设置颜色、样式
```

### 第3步: 理解核心概念

**你问**:
```
我运行成功了!现在想深入理解:

1. seaborn有哪几种核心绘图类型?
2. 它们各自适合什么医学场景?
3. 给每种类型一个简短示例

请以表格形式总结。
```

**AI答**:
```
Seaborn核心绘图类型(医学应用)

┌──────────────┬──────────────────┬─────────────────────────┐
│ 图表类型      │ 适用场景          │ 代码示例                 │
├──────────────┼──────────────────┼─────────────────────────┤
│ 箱线图        │ 多组数据分布对比  │ sns.boxplot(data, x, y)  │
│ (boxplot)    │ 如:不同年龄段血压  │                          │
├──────────────┼──────────────────┼─────────────────────────┤
│ 小提琴图      │ 数据分布+密度     │ sns.violinplot(data, x, y│
│ (violinplot) │ 如:两组疗效对比   │)                         │
├──────────────┼──────────────────┼─────────────────────────┤
│ 散点图        │ 两变量相关性      │ sns.scatterplot(data, x, │
│ (scatterplot)│ 如:年龄vs血压     │y, hue)                   │
├──────────────┼──────────────────┼─────────────────────────┤
│ 折线图        │ 时间序列趋势      │ sns.lineplot(data, x, y) │
│ (lineplot)   │ 如:血压随访变化   │                          │
├──────────────┼──────────────────┼─────────────────────────┤
│ 柱状图        │ 分类数据计数      │ sns.countplot(data, x)   │
│ (countplot)  │ 如:各科室患者数   │                          │
├──────────────┼──────────────────┼─────────────────────────┤
│ 热力图        │ 多变量相关性矩阵  │ sns.heatmap(corr_matrix) │
│ (heatmap)    │ 如:指标相关性分析 │                          │
├──────────────┼──────────────────┼─────────────────────────┤
│ 分布图        │ 单变量分布+直方图 │ sns.histplot(data, x)    │
│ (histplot)   │ 如:年龄分布       │                          │
├──────────────┼──────────────────┼─────────────────────────┤
│ 散点矩阵      │ 多变量两两关系    │ sns.pairplot(df)         │
│ (pairplot)   │ 如:体检指标探索   │                          │
└──────────────┴──────────────────┴─────────────────────────┘

**医学场景示例**:

1. 箱线图 - 药物疗效对比
```python
sns.boxplot(data=trial_data, x='treatment_group', y='blood_pressure_change')
plt.title('A药vs B药降压效果对比')
```

2. 小提琴图 - 年龄与住院时长
```python
sns.violinplot(data=patient_data, x='age_group', y='length_of_stay')
```

3. 散点图 - BMI与血糖关系
```python
sns.scatterplot(data=df, x='bmi', y='blood_glucose', hue='diabetes')
```

4. 折线图 - 患者血压随访
```python
sns.lineplot(data=followup, x='visit_date', y='systolic_bp', hue='patient_id')
```

5. 热力图 - 检验指标相关性
```python
corr = df[['age', 'bp', 'glucose', 'cholesterol']].corr()
sns.heatmap(corr, annot=True, cmap='coolwarm')
```

**选择指南**:
- 对比分布 → 箱线图/小提琴图
- 探索关系 → 散点图/散点矩阵
- 查看趋势 → 折线图
- 统计计数 → 柱状图
- 相关分析 → 热力图
```

### 第4步: 解决实际问题

**你问**:
```
实战任务:我有一份临床试验数据,需要绘制:

数据:
- 100名患者
- 两组:治疗组(A药) vs 对照组(B药)
- 指标:治疗前后收缩压变化

需求:
1. 对比两组的降压效果
2. 图表要专业,可以用于论文
3. 显示统计学差异(如果有)

请给出完整代码,包括数据准备、绘图、美化。
```

**AI答**:
```python
# === 临床试验数据可视化:A药vs B药降压效果 ===

import seaborn as sns
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
from scipy import stats

# 设置图表样式
sns.set_style("whitegrid")
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']
plt.rcParams['axes.unicode_minus'] = False

# 1. 准备数据(模拟临床试验数据)
np.random.seed(42)

# A药(治疗组):降压效果较好
group_a = pd.DataFrame({
    '组别': ['A药'] * 50,
    '降压幅度': np.random.normal(15, 5, 50)  # 平均降15mmHg
})

# B药(对照组):降压效果一般
group_b = pd.DataFrame({
    '组别': ['B药'] * 50,
    '降压幅度': np.random.normal(8, 4, 50)   # 平均降8mmHg
})

# 合并数据
data = pd.concat([group_a, group_b], ignore_index=True)

# 2. 统计学检验(独立样本t检验)
a_values = group_a['降压幅度']
b_values = group_b['降压幅度']
t_stat, p_value = stats.ttest_ind(a_values, b_values)

# 3. 绘制图表
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# 左图:箱线图
sns.boxplot(data=data, x='组别', y='降压幅度', ax=axes[0], palette='Set2')
axes[0].set_title('两组降压效果对比(箱线图)', fontsize=14, fontweight='bold')
axes[0].set_ylabel('收缩压降低幅度 (mmHg)', fontsize=12)
axes[0].set_xlabel('治疗组别', fontsize=12)

# 添加统计学标注
if p_value < 0.05:
    axes[0].text(0.5, max(data['降压幅度']) * 0.95,
                 f'p < 0.001***' if p_value < 0.001 else f'p = {p_value:.3f}*',
                 ha='center', fontsize=11, fontweight='bold')

# 右图:小提琴图(显示数据分布)
sns.violinplot(data=data, x='组别', y='降压幅度', ax=axes[1], palette='Set2')
axes[1].set_title('两组降压效果对比(小提琴图)', fontsize=14, fontweight='bold')
axes[1].set_ylabel('收缩压降低幅度 (mmHg)', fontsize=12)
axes[1].set_xlabel('治疗组别', fontsize=12)

# 4. 添加统计信息文本框
stats_text = f'''
统计结果:
A药: {a_values.mean():.1f} ± {a_values.std():.1f} mmHg
B药: {b_values.mean():.1f} ± {b_values.std():.1f} mmHg
t = {t_stat:.2f}, p = {p_value:.4f}
'''
fig.text(0.5, -0.05, stats_text, ha='center', fontsize=10,
         bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.3))

plt.tight_layout()
plt.savefig('clinical_trial_result.png', dpi=300, bbox_inches='tight')  # 保存高分辨率图片
plt.show()

# 5. 打印详细统计报告
print("=" * 50)
print("临床试验统计报告")
print("=" * 50)
print(f"\n【A药组】(n={len(group_a)})")
print(f"  降压幅度: {a_values.mean():.2f} ± {a_values.std():.2f} mmHg")
print(f"  中位数: {a_values.median():.2f} mmHg")
print(f"  范围: {a_values.min():.2f} - {a_values.max():.2f} mmHg")

print(f"\n【B药组】(n={len(group_b)})")
print(f"  降压幅度: {b_values.mean():.2f} ± {b_values.std():.2f} mmHg")
print(f"  中位数: {b_values.median():.2f} mmHg")
print(f"  范围: {b_values.min():.2f} - {b_values.max():.2f} mmHg")

print(f"\n【统计学检验】")
print(f"  t统计量: {t_stat:.4f}")
print(f"  p值: {p_value:.4f}")
if p_value < 0.001:
    print(f"  结论: A药降压效果显著优于B药 (p < 0.001, 极显著)")
elif p_value < 0.05:
    print(f"  结论: A药降压效果优于B药 (p < 0.05, 显著)")
else:
    print(f"  结论: 两组差异无统计学意义 (p > 0.05)")

print("\n✓ 图表已保存至: clinical_trial_result.png")
```

**代码说明**:

1. **数据准备**: 模拟真实临床数据(你可以替换为实际数据)
2. **统计检验**: 使用t检验判断差异显著性
3. **双图对比**: 箱线图+小提琴图,全面展示数据
4. **专业美化**:
   - 清晰的标题和坐标轴标签
   - 统计学标注(p值)
   - 统计摘要文本框
5. **高分辨率保存**: dpi=300,适合论文发表

**如何使用你的数据**:
```python
# 读取你的CSV文件
data = pd.read_csv('your_data.csv')

# 确保列名正确
# data应该包含:'组别'列 和 '降压幅度'列
# 或者重命名:
data = data.rename(columns={
    'treatment_group': '组别',
    'bp_reduction': '降压幅度'
})

# 然后运行上面的绘图代码...
```
```

### 第5步: 个性化定制

**你问**:
```
我想进一步定制图表:

1. 修改配色方案为蓝色系
2. 添加每个数据点(散点叠加)
3. 调整图例位置
4. 添加网格线

请告诉我如何修改代码。
```

**AI答**:
```python
# === 定制化版本 ===

# 1. 修改配色为蓝色系
# 原代码: palette='Set2'
# 新代码:
custom_colors = ['#4A90E2', '#7FCDCD']  # 蓝色系
sns.boxplot(data=data, x='组别', y='降压幅度', palette=custom_colors)

# 或使用内置配色方案
sns.boxplot(data=data, x='组别', y='降压幅度', palette='Blues')

# 2. 添加散点叠加(显示每个数据点)
sns.boxplot(data=data, x='组别', y='降压幅度', palette=custom_colors)
sns.stripplot(data=data, x='组别', y='降压幅度',
              color='black', alpha=0.3, size=3)  # 叠加散点

# 3. 调整图例
plt.legend(loc='upper right')           # 右上角
# 或
plt.legend(loc='best')                  # 自动最佳位置
# 或
plt.legend(bbox_to_anchor=(1.05, 1))   # 图外右侧

# 4. 添加网格线
plt.grid(True, linestyle='--', alpha=0.7)  # 虚线网格
# 或只显示y轴网格
ax.yaxis.grid(True, linestyle='--', alpha=0.5)
ax.xaxis.grid(False)

# 完整示例:
fig, ax = plt.subplots(figsize=(10, 6))

# 绘制箱线图
sns.boxplot(data=data, x='组别', y='降压幅度',
            palette=custom_colors, ax=ax)

# 叠加散点
sns.stripplot(data=data, x='组别', y='降压幅度',
              color='gray', alpha=0.4, size=4, ax=ax)

# 美化
ax.set_title('临床试验降压效果对比', fontsize=16, fontweight='bold')
ax.set_ylabel('收缩压降低 (mmHg)', fontsize=13)
ax.set_xlabel('治疗组别', fontsize=13)
ax.grid(axis='y', linestyle='--', alpha=0.5)

plt.tight_layout()
plt.show()
```

**seaborn常用样式参数**:

```python
# 全局样式设置
sns.set_style("white")      # 白色背景
sns.set_style("darkgrid")   # 深色网格
sns.set_style("whitegrid")  # 白色网格
sns.set_style("ticks")      # 带刻度

# 配色方案
palette='deep'      # 深色
palette='muted'     # 柔和
palette='pastel'    # 粉彩
palette='bright'    # 明亮
palette='dark'      # 暗色
palette='colorblind' # 色盲友好

# 自定义颜色
palette=['#FF6B6B', '#4ECDC4', '#45B7D1']

# 图表尺寸
sns.set_context("paper")     # 小(论文)
sns.set_context("notebook")  # 中(默认)
sns.set_context("talk")      # 大(演讲)
sns.set_context("poster")    # 超大(海报)
```
```

### 第6步: 疑难解答

**你问**:
```
遇到问题:

1. 中文显示为方块
2. 图例重叠
3. 保存的图片分辨率太低

如何解决?
```

**AI答**:
```python
# 问题1: 中文显示为方块
# 解决方案:

# Mac系统
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']
plt.rcParams['axes.unicode_minus'] = False

# Windows系统
plt.rcParams['font.sans-serif'] = ['SimHei']  # 黑体
plt.rcParams['axes.unicode_minus'] = False

# Linux系统
plt.rcParams['font.sans-serif'] = ['WenQuanYi Micro Hei']

# 检查可用字体
from matplotlib.font_manager import FontManager
fm = FontManager()
fonts = [f.name for f in fm.ttflist if 'Chinese' in f.name or 'Hei' in f.name]
print(fonts)  # 查看可用中文字体

# 问题2: 图例重叠
# 解决方案:

# 方法1: 移到图外
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
plt.tight_layout()  # 自动调整

# 方法2: 调整图表大小留出空间
fig, ax = plt.subplots(figsize=(12, 6))  # 加宽

# 方法3: 减小图例字体
plt.legend(fontsize=8)

# 方法4: 分多列显示
plt.legend(ncol=2)

# 问题3: 保存图片分辨率低
# 解决方案:

# 高分辨率保存(论文级别)
plt.savefig('output.png', dpi=300, bbox_inches='tight')

# 矢量图(无限放大不失真)
plt.savefig('output.pdf', format='pdf', bbox_inches='tight')
plt.savefig('output.svg', format='svg', bbox_inches='tight')

# 完整参数
plt.savefig('output.png',
            dpi=300,              # 分辨率
            bbox_inches='tight',  # 裁剪空白
            facecolor='white',    # 背景色
            edgecolor='none',     # 边框色
            transparent=False)    # 透明背景

# 常见分辨率参考:
# 72 dpi:  屏幕显示
# 150 dpi: 普通打印
# 300 dpi: 高质量打印/论文
# 600 dpi: 专业印刷
```
```

## 学习总结

### 30分钟学会seaborn的关键

1. **第1-5分钟**: 理解seaborn是什么,能做什么
2. **第6-15分钟**: 运行第一个示例,看到效果
3. **第16-20分钟**: 理解核心绘图类型
4. **第21-25分钟**: 完成实际项目(临床数据可视化)
5. **第26-30分钟**: 个性化定制,解决问题

### 有效学习的要素

✅ **目标导向**: 明确要解决的实际问题
✅ **立即实践**: 每学一个知识点就动手试
✅ **递进式学习**: 从简单到复杂
✅ **解决真实问题**: 用自己的数据练习
✅ **善用AI**: 遇到问题立刻问

## 举一反三:学习其他库

### 通用模板

```
第1步: 了解基本信息
"[库名]是什么,用于解决什么问题?
安装方法?与[相关库]的关系?"

第2步: 快速上手
"给一个5分钟[领域]场景的示例,
要求可运行,有注释。"

第3步: 核心概念
"[库名]的核心功能有哪些?
各适合什么场景?给出示例代码。"

第4步: 实战项目
"我要实现[具体需求],
使用[库名],给出完整代码。"

第5步: 定制优化
"如何[定制需求]?
如何解决[常见问题]?"
```

### 示例:学习plotly库

```
第1步: "plotly是什么?与seaborn/matplotlib的区别?"

第2步: "给一个医学数据的交互式图表示例"

第3步: "plotly的主要图表类型?各适合什么医学场景?"

第4步: "绘制患者血压随访的交互式折线图,
       可以悬停查看具体数值,可以缩放"

第5步: "如何导出为HTML?如何自定义颜色主题?"
```

## 实战练习

### 练习1: 学习pydicom

用本章学到的方法,30分钟学习pydicom库:

**任务**:
1. 了解pydicom是什么
2. 读取一个DICOM文件
3. 查看元数据信息
4. 显示医学影像
5. 解决遇到的问题

**Prompt起点**:
```
我想学习pydicom库处理医学影像。

请提供:
1. pydicom简介和安装方法
2. 读取DICOM文件的最简示例
3. 如何查看患者信息、影像参数
4. 如何显示影像
5. 常见问题及解决方案

从零开始,每步给出可运行的代码。
```

### 练习2: 学习scikit-learn

**任务**: 用患者数据训练一个简单的分类模型

**Prompt起点**:
```
我想学习scikit-learn进行患者数据分类。

背景: 有患者的年龄、BMI、血压等数据,
       需要预测是否患有糖尿病(是/否)

请教我:
1. scikit-learn是什么
2. 如何准备数据
3. 选择合适的分类器
4. 训练模型
5. 评估准确率

给出完整代码示例。
```

### 练习3: 学习statsmodels

**任务**: 进行临床数据的统计检验

**Prompt起点**:
```
我想学习statsmodels进行医学统计分析。

场景: 两组患者(治疗组vs对照组)的疗效对比,
      需要进行t检验、方差分析等

请教我statsmodels的基础用法和常用统计检验方法。
```

## 检查清单

- [ ] 理解AI辅助学习新库的5步法
- [ ] 能够设计有效的学习Prompt
- [ ] 完成了seaborn的完整学习流程
- [ ] 能够绘制基本的医学统计图表
- [ ] 知道如何解决常见问题(中文、图例、分辨率)
- [ ] 能够将方法迁移到其他库的学习
- [ ] 养成"问AI→实践→再问"的学习循环

## 下一步

- **第7章 AI编程工具实战**: 学习Copilot, Cursor等工具
- **第9-13章 实战项目**: 在真实项目中应用所学的库

## 推荐学习的医学相关库

### 数据分析类
- **pandas**: 表格数据处理(必学)
- **numpy**: 数值计算(必学)
- **scipy**: 科学计算、统计检验
- **statsmodels**: 统计建模

### 可视化类
- **matplotlib**: 基础绘图(必学)
- **seaborn**: 统计图表(推荐)
- **plotly**: 交互式图表
- **bokeh**: Web交互可视化

### 医学专用
- **pydicom**: DICOM医学影像
- **nibabel**: NIfTI神经影像
- **lifelines**: 生存分析
- **scipy.stats**: 统计检验

### 机器学习
- **scikit-learn**: 通用机器学习(入门)
- **tensorflow/pytorch**: 深度学习(进阶)
- **xgboost**: 结构化数据建模

## 资源链接

- Seaborn官方教程: https://seaborn.pydata.org/tutorial.html
- Seaborn图表画廊: https://seaborn.pydata.org/examples/index.html
- 医学数据可视化案例: https://github.com/mwaskom/seaborn-data
