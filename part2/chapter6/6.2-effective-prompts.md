# 6.2 如何提问才能获得有效答案

## Prompt工程:提问是一门艺术

### 什么是Prompt?

**Prompt** = 你给AI的指令/问题

```
普通prompt: "写一个Python函数"
专业prompt: "写一个Python函数,输入是患者列表(每个患者是字典,
            包含name和age),输出是60岁以上患者的姓名列表,
            需要添加类型提示和文档字符串"
```

**差别**: 后者得到的代码可以直接使用,前者可能需要反复修改。

### 医学类比

```
不好的医嘱: "给药"
→ 护士不知道给什么药、剂量、途径、时间

好的医嘱: "地塞米松5mg,静脉注射,立即执行,注意监测血糖"
→ 清晰、具体、可执行

同理,好的prompt = 清晰的医嘱
```

## Prompt的黄金公式

### 基础公式

```
[角色] + [任务] + [要求] + [格式] + [示例]
```

### 详细拆解

#### 1. 角色(Role)

告诉AI它应该扮演什么角色:

```
❌ 不指定角色:
"解释pandas的merge函数"

✅ 指定角色:
"你是一位Python数据分析导师,面对的是医学背景但编程零基础的学生。
请解释pandas的merge函数。"
```

**常用角色设定**:
- Python导师(耐心解释)
- 代码审查专家(找出问题)
- 调试助手(快速定位错误)
- 技术文档作者(详细说明)

#### 2. 任务(Task)

明确你想要AI做什么:

```
❌ 模糊:
"帮我处理数据"

✅ 明确:
"帮我写一个函数,读取CSV文件,删除age列中的缺失值,
并计算剩余患者的平均年龄"
```

#### 3. 要求(Requirements)

约束条件、技术规范:

```
✅ 详细要求:
"
使用pandas库
添加异常处理(文件不存在、列名错误等)
添加类型提示
符合PEP 8代码规范
添加详细注释
"
```

#### 4. 格式(Format)

期望的输出格式:

```
✅ 指定格式:
"
请以以下格式回答:
1. 简短解释(50字以内)
2. 完整代码
3. 使用示例
4. 常见问题及解决方案
"
```

#### 5. 示例(Example)

提供输入输出示例:

```
✅ 包含示例:
"
输入示例:
patients = [
    {"name": "张三", "age": 45},
    {"name": "李四", "age": None},
    {"name": "王五", "age": 52}
]

期望输出:
48.5 (删除缺失值后的平均年龄)
"
```

## 实战案例:从差到优

### 案例1: 学习新概念

**Level 0 - 太简单**
```
"什么是装饰器?"
```
→ AI会给出通用解释,可能太学术

**Level 1 - 添加背景**
```
"我是Python初学者,什么是装饰器?"
```
→ 好一些,但还不够具体

**Level 2 - 明确需求**
```
"我是Python初学者,想理解装饰器。
请用简单的语言解释,并给一个实际例子。"
```
→ 更好,但可以更具体

**Level 3 - 完整prompt**
```
你是一位Python导师,学生是医学背景的编程初学者。

任务:解释Python装饰器

要求:
1. 用医学场景类比(如病历记录、处方流程等)
2. 提供一个简单的代码示例
3. 逐行解释代码
4. 说明装饰器的实际应用场景(数据分析中)
5. 指出新手常见的误区

请分步骤,循序渐进地讲解。
```
→ ⭐ 最佳!会得到定制化的详细解答

### 案例2: 调试代码

**Level 0 - 信息不足**
```
"代码报错了,帮我看看"
```
→ AI无法帮忙,没有代码和错误信息

**Level 1 - 有代码但不完整**
```
df['age'].mean()
报错: KeyError
```
→ 缺少上下文,不知道df是什么

**Level 2 - 信息较全**
```
import pandas as pd
df = pd.read_csv('data.csv')
print(df['age'].mean())

报错: KeyError: 'age'
```
→ 好一些,但缺少环境信息

**Level 3 - 完整prompt**
```
我在处理患者数据时遇到错误,需要你帮忙调试。

环境信息:
- Python 3.11
- pandas 2.1.4
- macOS

完整代码:
```python
import pandas as pd
df = pd.read_csv('patients.csv')
print(df['age'].mean())
```

报错信息:
```
Traceback (most recent call last):
  File "analysis.py", line 3, in <module>
    print(df['age'].mean())
KeyError: 'age'
```

我的目标:计算患者平均年龄
我的猜测:可能是列名大小写问题?

请:
1. 分析错误原因
2. 提供解决方案
3. 给出防止类似错误的最佳实践
```
→ ⭐ 最佳!AI可以给出精准的诊断和解决方案

### 案例3: 生成代码

**Level 0 - 太宽泛**
```
"写一个数据分析脚本"
```
→ AI不知道分析什么数据,做什么分析

**Level 1 - 有基本描述**
```
"写一个脚本分析患者的血压数据"
```
→ 稍好,但仍不具体

**Level 2 - 明确需求**
```
"写一个Python脚本,读取CSV文件,
分析患者血压数据,生成统计报告"
```
→ 更好,但缺少细节

**Level 3 - 完整prompt**
```
请帮我写一个Python脚本,用于血压数据分析。

功能需求:
1. 读取CSV文件(包含:patient_id, name, age, systolic, diastolic)
2. 数据清洗:删除缺失值,识别异常值(收缩压>200或<80)
3. 统计分析:
   - 平均血压
   - 不同年龄段(18-40, 41-60, >60)的血压分布
   - 高血压患者比例(收缩压≥140或舒张压≥90)
4. 生成报告:打印统计结果,并保存为report.txt

技术要求:
- 使用pandas处理数据
- 添加完整的异常处理
- 添加进度提示(如"正在读取数据...")
- 代码添加注释
- 符合PEP 8规范

示例输入文件(patients.csv):
```
patient_id,name,age,systolic,diastolic
P001,张三,45,128,82
P002,李四,52,145,95
...
```

期望输出格式:
```
=== 血压数据分析报告 ===
总患者数: 100
平均收缩压: 132.5 mmHg
平均舒张压: 84.3 mmHg

年龄段分布:
18-40岁: 平均血压 120/78
41-60岁: 平均血压 135/85
>60岁: 平均血压 142/88

高血压患者: 30人 (30%)
```

请提供完整可运行的代码。
```
→ ⭐ 最佳!AI会生成符合所有要求的高质量代码

## Prompt技巧清单

### 技巧1: 使用分隔符

用分隔符让结构更清晰:

```
请帮我审查以下代码:

```python
[代码块用```包裹]
```

重点关注:
- 性能问题
- 潜在bug
- 代码风格

输出格式:
1. 问题列表
2. 改进建议
3. 优化后的代码
```

### 技巧2: 分步骤指令

复杂任务分解:

```
我想学习使用scikit-learn进行患者数据分类。

请分三步教我:

第一步:数据准备
- 如何加载数据
- 如何划分训练集和测试集

第二步:模型训练
- 选择合适的分类器
- 训练模型

第三步:评估模型
- 如何查看准确率
- 如何生成分类报告

每一步请给出代码示例和解释。
```

### 技巧3: 约束输出长度

控制回答的详细程度:

```
❌ 不约束:
"解释pandas的merge函数"
→ 可能得到5000字的长篇大论

✅ 约束长度:
"用100字以内简要解释pandas的merge函数,然后给一个简单示例"
→ 简洁有力的回答

✅ 要详细版:
"详细解释pandas的merge函数,包括所有参数的作用,
给出至少3个不同类型的join示例(inner, left, outer),
并说明每种适合什么场景。"
→ 全面的教程
```

### 技巧4: 指定专业程度

```
初学者版本:
"用最简单的语言解释什么是API,我是完全的编程新手。"

中级版本:
"解释RESTful API的原理,我了解基础的HTTP请求。"

高级版本:
"讨论设计医学数据API时的最佳实践,包括认证、限流、
版本控制等,我有一定的后端开发经验。"
```

### 技巧5: 要求对比

```
"对比pandas的三种合并数据的方法:
merge(), join(), concat()

请以表格形式呈现:
- 适用场景
- 语法差异
- 性能对比
- 各自的优缺点

并给出医学数据处理中的实际应用案例。"
```

### 技巧6: 迭代优化

第一轮提问后,基于回答继续深入:

```
第1轮:
"写一个函数读取CSV文件"

[AI给出基础代码]

第2轮:
"很好!现在添加错误处理,如果文件不存在或格式错误,
给出友好的错误提示"

[AI添加异常处理]

第3轮:
"再添加一个参数,可以指定只读取某些列,
并添加类型提示和文档字符串"

[AI完善代码]

第4轮:
"完美!能再添加单元测试吗?"

[AI补充测试代码]
```

## 特定场景的Prompt模板

### 模板1: 学习新库

```
我需要学习[库名]用于[目的]。

背景: 我是[你的背景],熟悉[已知技能]

请提供:
1. 这个库是什么,解决什么问题(50字以内)
2. 安装方法
3. 最基础的"Hello World"示例
4. 一个[你的领域]的实际应用案例
5. 常见的3个坑和解决方案
6. 推荐的学习资源

示例:
我需要学习pydicom用于处理医学影像。
背景: 我是医生,熟悉Python基础和pandas
[后续要求...]
```

### 模板2: 代码重构

```
以下代码能工作,但我觉得不够优雅,请帮我重构:

[原始代码]

重构目标:
- 提高可读性
- 提高性能(如果可以)
- 使用更Pythonic的写法
- 符合最佳实践

请:
1. 指出当前代码的问题
2. 提供重构后的代码
3. 逐条解释改进之处
4. 对比前后性能(如适用)
```

### 模板3: 调试协助

```
我的代码出现[问题描述],需要帮助调试。

环境:
- Python版本: [版本]
- 相关库: [库名 版本号]
- 操作系统: [OS]

完整代码:
```[语言]
[粘贴完整可运行的代码]
```

错误信息:
```
[完整的traceback]
```

输入数据示例:
[如果相关,提供示例数据]

预期行为:
[描述应该得到什么结果]

实际行为:
[描述实际发生了什么]

我已经尝试:
[列出你尝试过的解决方案]

请:
1. 定位问题根源
2. 解释为什么会出现这个问题
3. 提供修复方案
4. 建议如何避免类似问题
```

### 模板4: 性能优化

```
以下代码运行太慢,需要优化:

[代码]

性能问题:
- 数据量: [如100万行数据]
- 当前运行时间: [如5分钟]
- 目标: [如30秒内完成]

请:
1. 分析性能瓶颈
2. 提供优化方案(可以有多个)
3. 给出优化后的代码
4. 估算性能提升
5. 说明优化的原理
```

### 模板5: 解释复杂代码

```
请帮我理解以下代码:

```python
[复制的代码,可能来自GitHub或文档]
```

背景:
- 代码来源: [GitHub项目/文档页面]
- 我的理解程度: [如"理解大致逻辑,但细节不清楚"]

请:
1. 用简单语言概括代码的作用
2. 逐行/逐块解释关键部分
3. 指出使用的技巧或设计模式
4. 如果有更简单的实现方式,请说明
5. 举一个应用场景的例子
```

## 高级技巧

### 技巧1: Chain of Thought(思维链)

要求AI展示思考过程:

```
问题: 如何优化这个血压数据分析函数?

[代码]

请一步步思考:
1. 首先分析当前代码的逻辑
2. 然后找出可能的性能问题
3. 接着考虑优化方案
4. 最后给出改进后的代码

每一步都说明你的思考过程。
```

### 技巧2: Few-Shot Learning(少样本学习)

提供几个示例,让AI学习模式:

```
我需要为多个函数写单元测试,风格如下:

示例1:
def add(a, b):
    return a + b

测试:
def test_add():
    assert add(2, 3) == 5
    assert add(-1, 1) == 0
    assert add(0, 0) == 0

示例2:
def is_even(n):
    return n % 2 == 0

测试:
def test_is_even():
    assert is_even(2) == True
    assert is_even(3) == False
    assert is_even(0) == True

现在请为以下函数写测试:
def calculate_bmi(weight, height):
    return weight / (height ** 2)

请遵循同样的风格和结构。
```

### 技巧3: 角色扮演对话

模拟真实的学习场景:

```
请扮演一位资深Python导师,我是你的学生。

我说: "老师,我不理解为什么要用虚拟环境?"

请用对话方式教学:
1. 先问我几个引导性问题,了解我的困惑
2. 根据我的回答,循序渐进地解释
3. 用类比和例子帮助理解
4. 最后确认我是否理解

让我们开始对话。
```

### 技巧4: 反向提问

让AI问你问题:

```
我想学习pandas的数据合并操作。

在你解释之前,请先问我5个问题,
了解我的背景和需求,然后根据我的回答
定制你的教学内容。
```

## 常见错误及修正

### 错误1: 问题太开放

```
❌ "帮我学Python"
✅ "我想学习Python处理Excel文件,
   从最基础的读取文件开始,
   给我一个2周的学习计划,
   每天1小时,包含每天的学习目标和练习。"
```

### 错误2: 缺少上下文

```
❌ "这个代码有什么问题?
   df.merge(df2)"

✅ "我想合并两个患者数据表:
   df1包含[patient_id, name]
   df2包含[patient_id, age, gender]
   我想按patient_id合并,保留所有df1的记录。

   我的代码: df.merge(df2)

   但结果不对,可能是什么问题?"
```

### 错误3: 一次问太多

```
❌ "解释pandas的merge, join, concat, append, groupby,
   pivot, melt..."

✅ "请先解释pandas的merge函数,包括:
   - 基本用法
   - 不同类型的join
   - 一个医学数据的例子

   理解后我再问其他函数。"
```

### 错误4: 不验证就使用

```
❌ 直接复制AI的代码,不测试就用于重要数据

✅
1. 理解代码逻辑
2. 用小样本测试
3. 验证结果正确性
4. 再用于实际数据
```

## 实战练习

### 练习1: 改写Prompt

将以下差的prompt改写为好的prompt:

```
差: "pandas怎么用?"

改写: [你来写]
```

### 练习2: 自己构造Complete Prompt

为以下场景写一个完整的prompt:
- 学习matplotlib绘制医学统计图
- 包含角色、任务、要求、格式、示例

### 练习3: 调试场景

假设你有以下报错,写一个完整的调试prompt:
```python
df = pd.read_excel('patients.xlsx')
print(df.mean())

TypeError: Could not convert string to float
```

## 检查清单

- [ ] 理解Prompt工程的重要性
- [ ] 掌握黄金公式:[角色]+[任务]+[要求]+[格式]+[示例]
- [ ] 会使用分隔符组织复杂prompt
- [ ] 能分步骤拆解复杂任务
- [ ] 知道如何约束输出长度和难度
- [ ] 掌握至少3个特定场景的模板
- [ ] 会通过迭代优化prompt
- [ ] 养成提供完整上下文的习惯

## 下一步

- **6.3 让AI解释代码与报错**: 使用优质prompt理解复杂代码
- **6.4 代码审查**: 用prompt让AI找出代码问题
- **附录B**: 常用prompt模板库(可以直接复制使用)

## Prompt模板速查

### 快速模板
```
学习: 我想学[X]用于[Y],请提供[1]安装方法,[2]基础示例,[3]实际案例
调试: 代码:[X],错误:[Y],环境:[Z],请分析原因并修复
优化: 优化这段代码:[X],目标:[性能/可读性],请说明改进之处
解释: 解释这段代码:[X],重点解释[关键部分],用简单语言
```

## 推荐资源

- Learn Prompting: https://learnprompting.org
- OpenAI Prompt Examples: https://platform.openai.com/examples
- Prompt工程指南: https://www.promptingguide.ai/zh
