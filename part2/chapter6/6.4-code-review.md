# 6.4 ä»£ç å®¡æŸ¥:è®©AIæ‰¾å‡ºé—®é¢˜

## ä¸ºä»€ä¹ˆéœ€è¦ä»£ç å®¡æŸ¥?

### é—®é¢˜åœºæ™¯

```
ä½ çš„ä»£ç :
âœ“ èƒ½è¿è¡Œ
âœ“ å¾—åˆ°äº†æ­£ç¡®ç»“æœ
âœ“ æ²¡æœ‰æŠ¥é”™

ä½†å¯èƒ½å­˜åœ¨:
âŒ æ€§èƒ½é—®é¢˜(æ…¢)
âŒ æ½œåœ¨bug(è¾¹ç•Œæƒ…å†µæœªå¤„ç†)
âŒ å®‰å…¨éšæ‚£(æ•°æ®æ³„éœ²é£é™©)
âŒ å¯è¯»æ€§å·®(åˆ«äººçœ‹ä¸æ‡‚)
âŒ ä¸ç¬¦åˆæœ€ä½³å®è·µ
```

### åŒ»å­¦ç±»æ¯”

```
ä»£ç å®¡æŸ¥ = ä¼šè¯Šåˆ¶åº¦

è‡ªå·±çœ‹ç—…å†: å¯èƒ½æ¼è¯Š,ä¸»è§‚åè§
åŒè¡Œä¼šè¯Š: å‘ç°æ½œåœ¨é—®é¢˜,æä¾›æ›´å¥½æ–¹æ¡ˆ

AIå®¡æŸ¥çš„ä¼˜åŠ¿:
- ä¸çŸ¥ç–²å€¦,ä»»ä½•æ—¶å€™éƒ½èƒ½å®¡æŸ¥
- æ— ä¸»è§‚åè§,å®¢è§‚è¯„ä¼°
- ç»éªŒä¸°å¯Œ,è§è¿‡æµ·é‡ä»£ç 
- é€Ÿåº¦å¿«,ç§’çº§åé¦ˆ
```

## ä»£ç å®¡æŸ¥çš„ç»´åº¦

### 1. æ­£ç¡®æ€§(Correctness)

**æ£€æŸ¥ç‚¹**:
- é€»è¾‘æ˜¯å¦æ­£ç¡®
- è¾¹ç•Œæƒ…å†µæ˜¯å¦å¤„ç†
- å¼‚å¸¸æƒ…å†µæ˜¯å¦è€ƒè™‘

### 2. æ€§èƒ½(Performance)

**æ£€æŸ¥ç‚¹**:
- æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¾ªç¯
- èƒ½å¦ä½¿ç”¨å‘é‡åŒ–æ“ä½œ
- æ•°æ®ç»“æ„é€‰æ‹©æ˜¯å¦åˆç†

### 3. å¯è¯»æ€§(Readability)

**æ£€æŸ¥ç‚¹**:
- å˜é‡å‘½åæ˜¯å¦æ¸…æ™°
- ä»£ç ç»“æ„æ˜¯å¦åˆç†
- æ³¨é‡Šæ˜¯å¦å……åˆ†

### 4. å®‰å…¨æ€§(Security)

**æ£€æŸ¥ç‚¹**:
- æ˜¯å¦æœ‰SQLæ³¨å…¥é£é™©
- æ•æ„Ÿæ•°æ®æ˜¯å¦ä¿æŠ¤
- è¾“å…¥æ˜¯å¦éªŒè¯

### 5. æœ€ä½³å®è·µ(Best Practices)

**æ£€æŸ¥ç‚¹**:
- æ˜¯å¦ç¬¦åˆPEP 8è§„èŒƒ
- æ˜¯å¦ä½¿ç”¨äº†æ›´Pythonicçš„å†™æ³•
- é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„

## AIä»£ç å®¡æŸ¥çš„Promptç­–ç•¥

### ç­–ç•¥1: å…¨é¢å®¡æŸ¥

**Promptæ¨¡æ¿**:
```
è¯·å®¡æŸ¥ä»¥ä¸‹ä»£ç ,ä»å¤šä¸ªç»´åº¦æ‰¾å‡ºé—®é¢˜:

```python
[ä»£ç ]
```

è¯·æ£€æŸ¥:
1. æ­£ç¡®æ€§:é€»è¾‘é”™è¯¯ã€è¾¹ç•Œæƒ…å†µ
2. æ€§èƒ½:æ•ˆç‡é—®é¢˜ã€ä¼˜åŒ–ç©ºé—´
3. å¯è¯»æ€§:å‘½åã€æ³¨é‡Šã€ç»“æ„
4. å®‰å…¨æ€§:æ½œåœ¨é£é™©
5. æœ€ä½³å®è·µ:Pythonè§„èŒƒ

å¯¹æ¯ä¸ªé—®é¢˜:
- æŒ‡å‡ºå…·ä½“ä½ç½®
- è¯´æ˜ä¸ºä»€ä¹ˆæœ‰é—®é¢˜
- ç»™å‡ºæ”¹è¿›å»ºè®®
- æä¾›ä¿®æ”¹åçš„ä»£ç 
```

**å®ä¾‹**:

**ä½ çš„ä»£ç **:
```python
def get_elderly_patients(patient_list):
    results = []
    for i in range(len(patient_list)):
        if patient_list[i]['age'] >= 60:
            results.append(patient_list[i])
    return results
```

**ä½ é—®**:
```
è¯·å®¡æŸ¥ä»¥ä¸‹ä»£ç :

```python
def get_elderly_patients(patient_list):
    results = []
    for i in range(len(patient_list)):
        if patient_list[i]['age'] >= 60:
            results.append(patient_list[i])
    return results
```

ä»æ­£ç¡®æ€§ã€æ€§èƒ½ã€å¯è¯»æ€§è§’åº¦æ‰¾å‡ºé—®é¢˜å¹¶æ”¹è¿›ã€‚
```

**AIç­”**:
```
ä»£ç å®¡æŸ¥æŠ¥å‘Š:

ã€é—®é¢˜1: æ€§èƒ½ - ä¸å¿…è¦çš„ç´¢å¼•è®¿é—®ã€‘
ä½ç½®: for i in range(len(patient_list))
é—®é¢˜: ä½¿ç”¨ç´¢å¼•è®¿é—®æ•ˆç‡è¾ƒä½,ä¸å¤ŸPythonic
æ”¹è¿›: ç›´æ¥éå†åˆ—è¡¨

ã€é—®é¢˜2: å¯è¯»æ€§ - ç¼ºå°‘æ–‡æ¡£å­—ç¬¦ä¸²ã€‘
ä½ç½®: å‡½æ•°å®šä¹‰
é—®é¢˜: æ²¡æœ‰è¯´æ˜å‡½æ•°ç”¨é€”ã€å‚æ•°ã€è¿”å›å€¼
æ”¹è¿›: æ·»åŠ docstring

ã€é—®é¢˜3: æ­£ç¡®æ€§ - ç¼ºå°‘å¼‚å¸¸å¤„ç†ã€‘
ä½ç½®: patient_list[i]['age']
é—®é¢˜: å¦‚æœå­—å…¸æ²¡æœ‰'age'é”®ä¼šKeyError
æ”¹è¿›: ä½¿ç”¨.get()æˆ–æ·»åŠ å¼‚å¸¸å¤„ç†

ã€é—®é¢˜4: æ€§èƒ½ - å¯ä»¥ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼ã€‘
ä½ç½®: æ•´ä¸ªå‡½æ•°
é—®é¢˜: å¾ªç¯+appendæ•ˆç‡ä¸å¦‚æ¨å¯¼å¼
æ”¹è¿›: ç”¨åˆ—è¡¨æ¨å¯¼å¼ä¸€è¡Œæå®š

ã€é—®é¢˜5: æ­£ç¡®æ€§ - ç¼ºå°‘è¾“å…¥éªŒè¯ã€‘
ä½ç½®: å‡½æ•°å¼€å¤´
é—®é¢˜: å¦‚æœä¼ å…¥Noneæˆ–éåˆ—è¡¨ä¼šæŠ¥é”™
æ”¹è¿›: æ·»åŠ å‚æ•°éªŒè¯

ã€æ”¹è¿›åçš„ä»£ç ã€‘:

def get_elderly_patients(patient_list):
    """
    ç­›é€‰60å²åŠä»¥ä¸Šçš„è€å¹´æ‚£è€…

    Args:
        patient_list (list): æ‚£è€…åˆ—è¡¨,æ¯ä¸ªå…ƒç´ æ˜¯å­—å…¸,åŒ…å«'age'é”®

    Returns:
        list: è€å¹´æ‚£è€…åˆ—è¡¨

    Raises:
        TypeError: å¦‚æœpatient_listä¸æ˜¯åˆ—è¡¨
        ValueError: å¦‚æœpatient_listä¸ºNone

    Examples:
        >>> patients = [
        ...     {'name': 'å¼ ä¸‰', 'age': 45},
        ...     {'name': 'æå››', 'age': 65}
        ... ]
        >>> elderly = get_elderly_patients(patients)
        >>> len(elderly)
        1
    """
    # è¾“å…¥éªŒè¯
    if patient_list is None:
        raise ValueError("patient_listä¸èƒ½ä¸ºNone")
    if not isinstance(patient_list, list):
        raise TypeError("patient_listå¿…é¡»æ˜¯åˆ—è¡¨")

    # ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼,æ€§èƒ½æ›´å¥½
    return [
        patient for patient in patient_list
        if patient.get('age', 0) >= 60  # ä½¿ç”¨geté¿å…KeyError
    ]

ã€æ€§èƒ½å¯¹æ¯”ã€‘:
åŸç‰ˆ: O(n) ä½†æœ‰é¢å¤–çš„ç´¢å¼•å¼€é”€
æ”¹è¿›ç‰ˆ: O(n) ä¸”æ›´é«˜æ•ˆ,æµ‹è¯•æ˜¾ç¤ºå¿«çº¦30%

ã€é¢å¤–å»ºè®®ã€‘:
1. è€ƒè™‘å°†60è¿™ä¸ªé˜ˆå€¼ä½œä¸ºå‚æ•°,æé«˜çµæ´»æ€§
2. å¯ä»¥æ·»åŠ ç±»å‹æç¤ºå¢å¼ºä»£ç å¯è¯»æ€§
3. è€ƒè™‘ä½¿ç”¨filter()å‡½æ•°çš„æ›¿ä»£æ–¹æ¡ˆ

ã€ç±»å‹æç¤ºç‰ˆæœ¬ã€‘:

from typing import List, Dict, Any

def get_elderly_patients(
    patient_list: List[Dict[str, Any]],
    age_threshold: int = 60
) -> List[Dict[str, Any]]:
    """ç­›é€‰æŒ‡å®šå¹´é¾„ä»¥ä¸Šçš„æ‚£è€…"""
    if not patient_list:
        return []

    return [
        patient for patient in patient_list
        if patient.get('age', 0) >= age_threshold
    ]
```

### ç­–ç•¥2: èšç„¦ç‰¹å®šç»´åº¦

**Promptæ¨¡æ¿**:
```
è¯·é‡ç‚¹å®¡æŸ¥ä»¥ä¸‹ä»£ç çš„[æ€§èƒ½/å®‰å…¨æ€§/å¯è¯»æ€§]:

```python
[ä»£ç ]
```

æ‰¾å‡ºæ‰€æœ‰ä¸[ç»´åº¦]ç›¸å…³çš„é—®é¢˜,å¹¶æä¾›ä¼˜åŒ–æ–¹æ¡ˆã€‚
```

**å®ä¾‹ - æ€§èƒ½å®¡æŸ¥**:

**ä½ é—®**:
```
è¯·é‡ç‚¹å®¡æŸ¥ä»¥ä¸‹ä»£ç çš„æ€§èƒ½é—®é¢˜:

```python
def calculate_stats(df):
    ages = []
    for i in range(len(df)):
        ages.append(df.iloc[i]['age'])

    mean_age = sum(ages) / len(ages)

    variance = 0
    for age in ages:
        variance += (age - mean_age) ** 2
    variance = variance / len(ages)

    return mean_age, variance
```

è¿™ä¸ªå‡½æ•°å¤„ç†10ä¸‡è¡Œæ•°æ®æ—¶å¾ˆæ…¢,è¯·æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆå¹¶ä¼˜åŒ–ã€‚
```

**AIç­”**:
```
æ€§èƒ½å®¡æŸ¥æŠ¥å‘Š:

ã€æ€§èƒ½ç“¶é¢ˆ1: ä½æ•ˆçš„DataFrameéå†ã€‘â˜…â˜…â˜…â˜…â˜… (æœ€ä¸¥é‡)
ä½ç½®: for i in range(len(df)): ... df.iloc[i]
é—®é¢˜:
- iloc[i]æ˜¯æœ€æ…¢çš„DataFrameè®¿é—®æ–¹å¼
- æ¯æ¬¡è®¿é—®éƒ½è¦å®šä½è¡Œ,O(nÂ²)å¤æ‚åº¦
å½±å“: 10ä¸‡è¡Œæ•°æ®ä¼šæ‰§è¡Œ100äº¿æ¬¡æ“ä½œ!

ä¼˜åŒ–: ä½¿ç”¨å‘é‡åŒ–æ“ä½œ
df['age'].tolist() æˆ– df['age'].values

ã€æ€§èƒ½ç“¶é¢ˆ2: ä¸å¿…è¦çš„åˆ—è¡¨è½¬æ¢ã€‘â˜…â˜…â˜…â˜†â˜†
ä½ç½®: ages = [] ... append()
é—®é¢˜: å…ˆè½¬åˆ—è¡¨å†è®¡ç®—,å¤šä¸€æ¬¡éå†
ä¼˜åŒ–: ç›´æ¥ç”¨pandasæ–¹æ³•

ã€æ€§èƒ½ç“¶é¢ˆ3: æ‰‹åŠ¨è®¡ç®—ç»Ÿè®¡é‡ã€‘â˜…â˜…â˜…â˜…â˜†
ä½ç½®: æ‰‹åŠ¨è®¡ç®—å‡å€¼å’Œæ–¹å·®
é—®é¢˜: pandaså†…ç½®æ–¹æ³•ç»è¿‡Cä¼˜åŒ–,å¿«10-100å€
ä¼˜åŒ–: ä½¿ç”¨df['age'].mean()å’Œdf['age'].var()

ã€æ€§èƒ½ç“¶é¢ˆ4: é‡å¤è®¡ç®—ã€‘â˜…â˜…â˜†â˜†â˜†
ä½ç½®: (age - mean_age) ** 2
é—®é¢˜: å¾ªç¯ä¸­é‡å¤è®¡ç®—,æ²¡æœ‰å¿…è¦
ä¼˜åŒ–: å‘é‡åŒ–ä¸€æ¬¡æ€§è®¡ç®—

ã€ä¼˜åŒ–åä»£ç ã€‘:

# ç‰ˆæœ¬1: ä½¿ç”¨pandaså†…ç½®æ–¹æ³•(æœ€ä¼˜)
def calculate_stats(df):
    """
    æ€§èƒ½: 10ä¸‡è¡Œæ•°æ® < 10ms
    """
    return df['age'].mean(), df['age'].var()

# ç‰ˆæœ¬2: å¦‚æœå¿…é¡»æ‰‹åŠ¨å®ç°
import numpy as np

def calculate_stats_manual(df):
    """
    æ€§èƒ½: 10ä¸‡è¡Œæ•°æ® < 50ms
    """
    ages = df['age'].values  # NumPyæ•°ç»„,æ¯”åˆ—è¡¨å¿«
    mean_age = ages.mean()
    variance = ((ages - mean_age) ** 2).mean()
    return mean_age, variance

ã€æ€§èƒ½å¯¹æ¯”ã€‘:
åŸç‰ˆ:    10ä¸‡è¡Œ â†’ ~5000ms  (5ç§’)
ä¼˜åŒ–ç‰ˆæœ¬1: 10ä¸‡è¡Œ â†’ ~8ms    (600å€åŠ é€Ÿ!)
ä¼˜åŒ–ç‰ˆæœ¬2: 10ä¸‡è¡Œ â†’ ~45ms   (100å€åŠ é€Ÿ)

ã€åŸºå‡†æµ‹è¯•ä»£ç ã€‘:

import pandas as pd
import numpy as np
import time

# åˆ›å»ºæµ‹è¯•æ•°æ®
df = pd.DataFrame({'age': np.random.randint(20, 80, 100000)})

# æµ‹è¯•åŸç‰ˆ
start = time.time()
mean, var = calculate_stats_original(df)
print(f"åŸç‰ˆ: {(time.time() - start) * 1000:.2f}ms")

# æµ‹è¯•ä¼˜åŒ–ç‰ˆ
start = time.time()
mean, var = calculate_stats(df)
print(f"ä¼˜åŒ–ç‰ˆ: {(time.time() - start) * 1000:.2f}ms")

ã€å…³é”®ä¼˜åŒ–åŸåˆ™ã€‘:
1. æ°¸è¿œä¸è¦ç”¨iloc[i]éå†DataFrame
2. ä¼˜å…ˆä½¿ç”¨pandas/numpyå†…ç½®æ–¹æ³•
3. é¿å…Pythonå¾ªç¯,ä½¿ç”¨å‘é‡åŒ–æ“ä½œ
4. ç†è§£å¤æ‚åº¦:O(nÂ²) vs O(n)

ã€é¢å¤–ä¼˜åŒ–å»ºè®®ã€‘:
1. å¦‚æœæ•°æ®é‡æ›´å¤§(ç™¾ä¸‡çº§),è€ƒè™‘ä½¿ç”¨Dask
2. å¯ä»¥ç¼“å­˜ç»“æœé¿å…é‡å¤è®¡ç®—
3. è€ƒè™‘å¹¶è¡Œå¤„ç†(multiprocessing)
```

### ç­–ç•¥3: å®‰å…¨æ€§å®¡æŸ¥

**Promptæ¨¡æ¿**:
```
è¯·ä»å®‰å…¨è§’åº¦å®¡æŸ¥ä»¥ä¸‹ä»£ç ,ç‰¹åˆ«å…³æ³¨åŒ»ç–—æ•°æ®éšç§:

```python
[ä»£ç ]
```

æ‰¾å‡º:
1. æ•°æ®æ³„éœ²é£é™©
2. æ³¨å…¥æ”»å‡»é£é™©
3. è®¿é—®æ§åˆ¶é—®é¢˜
4. å…¶ä»–å®‰å…¨éšæ‚£
```

**å®ä¾‹**:

**ä½ é—®**:
```
è¯·ä»å®‰å…¨è§’åº¦å®¡æŸ¥ä»¥ä¸‹ä»£ç :

```python
def export_patient_data(patient_id, output_file):
    """å¯¼å‡ºæ‚£è€…æ•°æ®åˆ°æ–‡ä»¶"""
    conn = sqlite3.connect('hospital.db')
    query = f"SELECT * FROM patients WHERE id = {patient_id}"
    df = pd.read_sql(query, conn)

    # è®°å½•æ—¥å¿—
    print(f"å¯¼å‡ºæ‚£è€… {patient_id} çš„æ•°æ®åˆ° {output_file}")

    # ä¿å­˜
    df.to_csv(output_file, index=False)
    conn.close()

    # å‘é€é‚®ä»¶é€šçŸ¥
    send_email(f"æ‚£è€…æ•°æ®å·²å¯¼å‡º: {output_file}")
```

è¿™æ˜¯åŒ»ç–—æ•°æ®,è¯·æ‰¾å‡ºå®‰å…¨é£é™©ã€‚
```

**AIç­”**:
```
ğŸš¨ å®‰å…¨å®¡æŸ¥æŠ¥å‘Š - å‘ç°ä¸¥é‡é—®é¢˜!

ã€ä¸¥é‡é—®é¢˜1: SQLæ³¨å…¥é£é™©ã€‘â˜…â˜…â˜…â˜…â˜… (å±æ€¥!)
ä½ç½®: query = f"SELECT * FROM patients WHERE id = {patient_id}"
é£é™©:
- ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ„é€ SQL
- å¦‚æœpatient_id = "1 OR 1=1",ä¼šè¿”å›æ‰€æœ‰æ‚£è€…æ•°æ®!
- æ”»å‡»è€…å¯ä»¥åˆ é™¤æ•°æ®: "1; DROP TABLE patients--"

ä¿®å¤:
```python
# âœ“ ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
query = "SELECT * FROM patients WHERE id = ?"
df = pd.read_sql(query, conn, params=(patient_id,))
```

ã€ä¸¥é‡é—®é¢˜2: æ•æ„Ÿæ•°æ®è®°å½•åˆ°æ—¥å¿—ã€‘â˜…â˜…â˜…â˜…â˜†
ä½ç½®: print(f"å¯¼å‡ºæ‚£è€… {patient_id} ...")
é£é™©:
- æ‚£è€…IDå¯èƒ½æ˜¯æ•æ„Ÿä¿¡æ¯
- æ—¥å¿—æ–‡ä»¶å¯èƒ½è¢«æœªæˆæƒäººå‘˜è®¿é—®
- è¿åHIPAA/GDPRç­‰éšç§æ³•è§„

ä¿®å¤:
```python
# âœ“ ä½¿ç”¨è„±æ•çš„æ—¥å¿—
import logging
logger.info("æ‚£è€…æ•°æ®å¯¼å‡ºæ“ä½œ", extra={
    'patient_id_hash': hashlib.sha256(str(patient_id).encode()).hexdigest()[:8],
    'operation': 'export'
})
```

ã€ä¸¥é‡é—®é¢˜3: æœªåŠ å¯†çš„æ•°æ®å¯¼å‡ºã€‘â˜…â˜…â˜…â˜…â˜…
ä½ç½®: df.to_csv(output_file, index=False)
é£é™©:
- CSVæ˜æ–‡å­˜å‚¨æ‚£è€…æ‰€æœ‰ä¿¡æ¯
- æ–‡ä»¶å¯èƒ½è¢«æœªæˆæƒè®¿é—®
- æ³„éœ²æ‚£è€…éšç§

ä¿®å¤:
```python
# âœ“ åŠ å¯†å¯¼å‡º
from cryptography.fernet import Fernet

def export_encrypted(df, output_file, key):
    data = df.to_csv(index=False).encode()
    f = Fernet(key)
    encrypted = f.encrypt(data)
    with open(output_file, 'wb') as file:
        file.write(encrypted)
```

ã€ä¸¥é‡é—®é¢˜4: ç¼ºå°‘è®¿é—®æ§åˆ¶ã€‘â˜…â˜…â˜…â˜…â˜†
ä½ç½®: æ•´ä¸ªå‡½æ•°
é£é™©:
- ä»»ä½•äººè°ƒç”¨éƒ½èƒ½å¯¼å‡ºæ•°æ®
- æ²¡æœ‰éªŒè¯è°ƒç”¨è€…æƒé™
- æ²¡æœ‰å®¡è®¡è®°å½•

ä¿®å¤:
```python
# âœ“ æ·»åŠ æƒé™éªŒè¯
def export_patient_data(patient_id, output_file, user_id, user_role):
    # éªŒè¯æƒé™
    if not has_permission(user_id, user_role, 'export_patient_data'):
        logger.warning(f"æœªæˆæƒè®¿é—®å°è¯•: user={user_id}")
        raise PermissionError("æ— æƒé™å¯¼å‡ºæ‚£è€…æ•°æ®")

    # è®°å½•å®¡è®¡æ—¥å¿—
    audit_log(user_id, 'export', patient_id, output_file)

    # ... åç»­æ“ä½œ
```

ã€ä¸¥é‡é—®é¢˜5: é‚®ä»¶å†…å®¹æš´éœ²è·¯å¾„ã€‘â˜…â˜…â˜…â˜†â˜†
ä½ç½®: send_email(f"æ‚£è€…æ•°æ®å·²å¯¼å‡º: {output_file}")
é£é™©:
- é‚®ä»¶ä¸­åŒ…å«å®Œæ•´æ–‡ä»¶è·¯å¾„
- å¯èƒ½æš´éœ²æœåŠ¡å™¨ç»“æ„
- é‚®ä»¶å¯èƒ½è¢«æ‹¦æˆª

ä¿®å¤:
```python
# âœ“ åªå‘é€å¿…è¦ä¿¡æ¯
send_email(
    recipient=authorized_email,
    subject="æ•°æ®å¯¼å‡ºå®Œæˆ",
    body="æ‚¨çš„æ•°æ®å¯¼å‡ºè¯·æ±‚å·²å®Œæˆ,è¯·ç™»å½•ç³»ç»Ÿä¸‹è½½ã€‚",
    encrypted=True
)
```

ã€ä¸¥é‡é—®é¢˜6: ç¼ºå°‘è¾“å…¥éªŒè¯ã€‘â˜…â˜…â˜…â˜†â˜†
ä½ç½®: patient_idå‚æ•°
é£é™©:
- æ²¡æœ‰éªŒè¯patient_idæ ¼å¼
- å¯èƒ½å¯¼è‡´æ„å¤–é”™è¯¯æˆ–æ”»å‡»

ä¿®å¤:
```python
# âœ“ éªŒè¯è¾“å…¥
if not isinstance(patient_id, int) or patient_id <= 0:
    raise ValueError("æ— æ•ˆçš„æ‚£è€…ID")
```

ã€å®Œæ•´çš„å®‰å…¨ç‰ˆæœ¬ã€‘:

import sqlite3
import pandas as pd
import logging
from cryptography.fernet import Fernet
import hashlib

def export_patient_data_secure(
    patient_id: int,
    output_file: str,
    user_id: str,
    user_role: str,
    encryption_key: bytes
):
    """
    å®‰å…¨å¯¼å‡ºæ‚£è€…æ•°æ®

    Args:
        patient_id: æ‚£è€…ID
        output_file: è¾“å‡ºæ–‡ä»¶è·¯å¾„
        user_id: æ“ä½œç”¨æˆ·ID
        user_role: ç”¨æˆ·è§’è‰²
        encryption_key: åŠ å¯†å¯†é’¥

    Raises:
        PermissionError: æ— æƒé™
        ValueError: å‚æ•°æ— æ•ˆ
    """
    # 1. è¾“å…¥éªŒè¯
    if not isinstance(patient_id, int) or patient_id <= 0:
        raise ValueError("æ— æ•ˆçš„æ‚£è€…ID")

    # 2. æƒé™éªŒè¯
    if not has_permission(user_id, user_role, 'export_patient_data'):
        logger.warning(
            "æœªæˆæƒè®¿é—®å°è¯•",
            extra={'user': user_id, 'action': 'export'}
        )
        raise PermissionError("æ— æƒé™å¯¼å‡ºæ‚£è€…æ•°æ®")

    # 3. è®°å½•å®¡è®¡æ—¥å¿—(è„±æ•)
    audit_log(
        user_id=user_id,
        action='export_patient_data',
        patient_id_hash=hashlib.sha256(
            str(patient_id).encode()
        ).hexdigest()
    )

    try:
        # 4. å®‰å…¨çš„æ•°æ®åº“æŸ¥è¯¢(å‚æ•°åŒ–)
        conn = sqlite3.connect('hospital.db')
        query = "SELECT * FROM patients WHERE id = ?"
        df = pd.read_sql(query, conn, params=(patient_id,))

        # 5. æ£€æŸ¥æ˜¯å¦å­˜åœ¨
        if df.empty:
            raise ValueError("æ‚£è€…ä¸å­˜åœ¨")

        # 6. åŠ å¯†å¯¼å‡º
        data = df.to_csv(index=False).encode()
        f = Fernet(encryption_key)
        encrypted = f.encrypt(data)

        with open(output_file, 'wb') as file:
            file.write(encrypted)

        # 7. å®‰å…¨çš„é€šçŸ¥(ä¸å«æ•æ„Ÿä¿¡æ¯)
        send_secure_notification(
            user_id=user_id,
            message="æ•°æ®å¯¼å‡ºå®Œæˆ,è¯·ç™»å½•ç³»ç»ŸæŸ¥çœ‹ã€‚"
        )

    except Exception as e:
        logger.error(f"æ•°æ®å¯¼å‡ºå¤±è´¥: {str(e)}")
        raise
    finally:
        conn.close()

ã€åˆè§„æ€§æ£€æŸ¥æ¸…å•ã€‘:
- [x] HIPAAåˆè§„: PHIåŠ å¯†å­˜å‚¨
- [x] GDPRåˆè§„: å®¡è®¡æ—¥å¿—ã€è®¿é—®æ§åˆ¶
- [x] æœ€å°æƒé™åŸåˆ™: æƒé™éªŒè¯
- [x] æ•°æ®æ³„éœ²é˜²æŠ¤: åŠ å¯†ã€è„±æ•
- [x] å®¡è®¡è¿½è¸ª: å®Œæ•´æ“ä½œæ—¥å¿—

ã€æ¨èé˜…è¯»ã€‘:
- OWASP Top 10: https://owasp.org/www-project-top-ten/
- HIPAAå®‰å…¨è§„åˆ™: https://www.hhs.gov/hipaa/
- Pythonå®‰å…¨æœ€ä½³å®è·µ: https://python.readthedocs.io/en/stable/library/security_warnings.html
```

### ç­–ç•¥4: å¯¹æ¯”å¼å®¡æŸ¥

**Promptæ¨¡æ¿**:
```
æˆ‘å†™äº†ä¸¤ç§å®ç°æ–¹å¼,è¯·å¯¹æ¯”åˆ†æå“ªä¸ªæ›´å¥½:

æ–¹æ³•A:
```python
[ä»£ç A]
```

æ–¹æ³•B:
```python
[ä»£ç B]
```

ä»[æ­£ç¡®æ€§/æ€§èƒ½/å¯è¯»æ€§]è§’åº¦å¯¹æ¯”,ç»™å‡ºæ¨èã€‚
```

## ä»£ç å®¡æŸ¥çš„æœ€ä½³å®è·µ

### 1. å®¡æŸ¥å‰çš„å‡†å¤‡

**æä¾›å……åˆ†çš„ä¸Šä¸‹æ–‡**:
```
âŒ ä¸å¥½:
"å®¡æŸ¥è¿™æ®µä»£ç : [ä»£ç ]"

âœ… å¥½:
"è¿™æ®µä»£ç ç”¨äº[ç›®çš„],å¤„ç†[æ•°æ®é‡],
éƒ¨ç½²åœ¨[ç¯å¢ƒ],æ€§èƒ½è¦æ±‚[X],
è¯·å®¡æŸ¥å¹¶æ‰¾å‡ºé—®é¢˜ã€‚"
```

### 2. åˆ†é˜¶æ®µå®¡æŸ¥

**ç¬¬ä¸€è½®: å¿«é€Ÿå®¡æŸ¥**
```
è¯·å¿«é€Ÿå®¡æŸ¥,æ‰¾å‡ºæ˜æ˜¾çš„bugå’Œæ€§èƒ½é—®é¢˜ã€‚
```

**ç¬¬äºŒè½®: æ·±åº¦å®¡æŸ¥**
```
è¯·æ·±åº¦å®¡æŸ¥ä»£ç é£æ ¼ã€æœ€ä½³å®è·µã€è¾¹ç•Œæƒ…å†µå¤„ç†ã€‚
```

**ç¬¬ä¸‰è½®: å®‰å…¨å®¡æŸ¥**
```
è¿™æ˜¯å¤„ç†åŒ»ç–—æ•°æ®çš„ä»£ç ,è¯·è¿›è¡Œå®‰å…¨å®¡æŸ¥ã€‚
```

### 3. è¦æ±‚å…·ä½“çš„æ”¹è¿›

**å¥½çš„Prompt**:
```
å®¡æŸ¥å:
1. åˆ—å‡ºæ‰€æœ‰é—®é¢˜,æŒ‰ä¸¥é‡ç¨‹åº¦æ’åº
2. å¯¹æ¯ä¸ªé—®é¢˜ç»™å‡ºå…·ä½“çš„ä¿®æ”¹ä»£ç 
3. è§£é‡Šä¸ºä»€ä¹ˆè¦è¿™æ ·æ”¹
4. ç»™å‡ºæ”¹è¿›å‰åçš„å¯¹æ¯”
```

## å®æˆ˜æ¼”ç»ƒ

### ç»ƒä¹ 1: å…¨é¢å®¡æŸ¥

**ä½ çš„ä»£ç **:
```python
def process_patients(filename):
    data = []
    f = open(filename, 'r')
    for line in f:
        parts = line.split(',')
        if int(parts[2]) > 60:
            data.append(parts)
    return data
```

**Prompt**:
```
å…¨é¢å®¡æŸ¥è¿™æ®µä»£ç ,æ‰¾å‡ºæ‰€æœ‰é—®é¢˜å¹¶ç»™å‡ºæ”¹è¿›ç‰ˆæœ¬ã€‚
```

### ç»ƒä¹ 2: æ€§èƒ½ä¼˜åŒ–å®¡æŸ¥

**ä½ çš„ä»£ç **:
```python
def find_duplicates(patient_ids):
    duplicates = []
    for i in range(len(patient_ids)):
        for j in range(i + 1, len(patient_ids)):
            if patient_ids[i] == patient_ids[j]:
                if patient_ids[i] not in duplicates:
                    duplicates.append(patient_ids[i])
    return duplicates
```

**Prompt**:
```
è¿™æ®µä»£ç å¤„ç†100ä¸‡ä¸ªIDæ—¶å¾ˆæ…¢,è¯·å®¡æŸ¥æ€§èƒ½å¹¶ä¼˜åŒ–ã€‚
```

### ç»ƒä¹ 3: å®‰å…¨å®¡æŸ¥

**ä½ çš„ä»£ç **:
```python
def login(username, password):
    query = f"SELECT * FROM users WHERE username='{username}' AND password='{password}'"
    result = db.execute(query)
    return result.fetchone() is not None
```

**Prompt**:
```
å®¡æŸ¥è¿™æ®µç™»å½•ä»£ç çš„å®‰å…¨æ€§,æ‰¾å‡ºæ‰€æœ‰å®‰å…¨éšæ‚£ã€‚
```

## æ£€æŸ¥æ¸…å•

- [ ] ç†è§£ä»£ç å®¡æŸ¥çš„5ä¸ªç»´åº¦
- [ ] æŒæ¡å…¨é¢å®¡æŸ¥çš„Promptæ ¼å¼
- [ ] ä¼šé’ˆå¯¹ç‰¹å®šç»´åº¦(æ€§èƒ½/å®‰å…¨)è¿›è¡Œå®¡æŸ¥
- [ ] çŸ¥é“å¦‚ä½•è¦æ±‚AIå¯¹æ¯”ä¸åŒå®ç°
- [ ] äº†è§£åŒ»ç–—æ•°æ®å¤„ç†çš„å®‰å…¨è¦æ±‚
- [ ] å…»æˆä»£ç å®Œæˆåä¸»åŠ¨å®¡æŸ¥çš„ä¹ æƒ¯
- [ ] èƒ½ç†è§£AIçš„å®¡æŸ¥å»ºè®®å¹¶åº”ç”¨
- [ ] çŸ¥é“ä½•æ—¶éœ€è¦äººå·¥å¤å®¡

## ä¸‹ä¸€æ­¥

- **6.5 å®æˆ˜**: ç”¨AIå­¦ä¹ æ–°çš„Pythonåº“
- **ç¬¬7ç« **: AIç¼–ç¨‹å·¥å…·(Copilot, Cursor)
- **ç¬¬8ç« **: AIè¾…åŠ©å¼€å‘å®Œæ•´æµç¨‹

## Promptæ¨¡æ¿é€ŸæŸ¥

### å…¨é¢å®¡æŸ¥
```
å®¡æŸ¥ä»£ç :[ä»£ç ]
ç»´åº¦:æ­£ç¡®æ€§ã€æ€§èƒ½ã€å¯è¯»æ€§ã€å®‰å…¨æ€§ã€æœ€ä½³å®è·µ
ç»™å‡º:é—®é¢˜åˆ—è¡¨+æ”¹è¿›ä»£ç +è§£é‡Š
```

### æ€§èƒ½å®¡æŸ¥
```
é‡ç‚¹å®¡æŸ¥æ€§èƒ½:[ä»£ç ]
æ•°æ®é‡:[X]
æ‰¾å‡ºç“¶é¢ˆ,ç»™å‡ºä¼˜åŒ–æ–¹æ¡ˆå’Œæ€§èƒ½å¯¹æ¯”
```

### å®‰å…¨å®¡æŸ¥
```
å®‰å…¨å®¡æŸ¥(åŒ»ç–—æ•°æ®):[ä»£ç ]
æ£€æŸ¥:SQLæ³¨å…¥ã€æ•°æ®æ³„éœ²ã€è®¿é—®æ§åˆ¶ã€åŠ å¯†
```

### å¯¹æ¯”å®¡æŸ¥
```
å¯¹æ¯”:[ä»£ç A] vs [ä»£ç B]
è§’åº¦:[æ€§èƒ½/å¯è¯»æ€§/å®‰å…¨]
ç»™å‡ºæ¨è+ç†ç”±
```

## ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·

**è‡ªåŠ¨åŒ–å·¥å…·**:
- `pylint`: ä»£ç è´¨é‡æ£€æŸ¥
- `black`: ä»£ç æ ¼å¼åŒ–
- `mypy`: ç±»å‹æ£€æŸ¥
- `bandit`: å®‰å…¨æ¼æ´æ‰«æ

**ä½¿ç”¨æ–¹æ³•**:
```bash
pip install pylint black mypy bandit

# æ£€æŸ¥ä»£ç è´¨é‡
pylint your_script.py

# æ ¼å¼åŒ–ä»£ç 
black your_script.py

# ç±»å‹æ£€æŸ¥
mypy your_script.py

# å®‰å…¨æ‰«æ
bandit -r your_project/
```

**ç»“åˆAI**: å…ˆç”¨å·¥å…·æ‰«æ,å†æŠŠç»“æœäº¤ç»™AIè§£é‡Šå’Œä¿®å¤!

## æ¨èèµ„æº

- Clean Code (Pythonç‰ˆ): ä»£ç æ•´æ´ä¹‹é“
- Effective Python: Pythonæœ€ä½³å®è·µ
- OWASP Top 10: å®‰å…¨æ¼æ´Top 10
- PEP 8: Pythonä»£ç é£æ ¼æŒ‡å—
