# 8.5 代码优化:性能与可读性

## 优化的两个维度

### 1. 性能优化(跑得更快)
### 2. 可读性优化(更容易理解)

## 性能优化实例

### 案例: 循环 vs 向量化

**慢的代码**:
```python
# 处理10万患者数据,耗时5秒
bmi_list = []
for i in range(len(df)):
    weight = df.iloc[i]['weight']
    height = df.iloc[i]['height']
    bmi = weight / (height ** 2)
    bmi_list.append(bmi)
df['bmi'] = bmi_list
```

**让AI优化**:
```
这段代码很慢,请用向量化方法优化
```

**AI优化后(0.01秒)**:
```python
df['bmi'] = df['weight'] / (df['height'] ** 2)
```

**性能提升: 500倍!**

## 可读性优化实例

### 案例: 复杂条件判断

**难读的代码**:
```python
if (a>60 and b<90) or (c==1 and d!=0) or (e>100 and f<200):
    process()
```

**让AI优化**:
```
这段代码可读性差,请重构
```

**AI优化后**:
```python
is_elderly = age > 60 and blood_pressure < 90
is_high_risk = risk_score == 1 and complications != 0
is_critical = glucose > 100 and cholesterol < 200

if is_elderly or is_high_risk or is_critical:
    process()
```

## 让AI帮你优化

### Prompt模板

```
请从以下角度优化代码:

1. 性能: 是否有更快的实现方式?
2. 可读性: 变量命名是否清晰?
3. Pythonic: 是否使用了Python最佳实践?
4. 可维护性: 是否易于修改和扩展?

[粘贴代码]
```

## 优化前后对比

### 示例: 数据清洗函数

**原始版本**:
```python
def clean(df):
    df2=df
    for i in range(len(df2)):
        if df2.iloc[i]['age']<0:
            df2=df2.drop(i)
    return df2
```

**AI优化后**:
```python
def clean_patient_data(df: pd.DataFrame) -> pd.DataFrame:
    """
    清洗患者数据,删除年龄异常的记录

    Args:
        df: 原始患者DataFrame

    Returns:
        清洗后的DataFrame
    """
    # 使用向量化操作,性能更好
    cleaned_df = df[df['age'] >= 0].copy()

    print(f"删除了{len(df) - len(cleaned_df)}条异常记录")

    return cleaned_df
```

**改进点**:
- ✅ 添加类型提示
- ✅ 添加文档字符串
- ✅ 使用向量化操作
- ✅ 有意义的变量名
- ✅ 添加日志输出

## 检查清单

代码完成后,让AI审查:

- [ ] 性能是否有优化空间?
- [ ] 变量命名是否清晰?
- [ ] 是否有重复代码可提取为函数?
- [ ] 注释是否充分?
- [ ] 是否符合PEP 8规范?

## 下一步

[8.6 文档生成:AI自动写注释](8.6-documentation.md)
