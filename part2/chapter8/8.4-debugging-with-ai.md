# 8.4 调试修复:AI辅助排错

## AI调试的威力

遇到报错时,AI可以:
- 快速定位错误原因
- 解释技术术语
- 提供多种修复方案
- 预防类似错误

## 调试流程

### 1. 收集错误信息

**完整的错误报告**包括:
```python
# 1. 完整的traceback
Traceback (most recent call last):
  File "analysis.py", line 23, in <module>
    result = df['age'].mean()
KeyError: 'age'

# 2. 相关代码
df = pd.read_csv('patients.csv')
result = df['age'].mean()  # ← 这行报错

# 3. 数据样本
# patients.csv前几行:
patient_id,name,years_old,gender
P001,张三,45,M
```

### 2. 向AI求助

**完整prompt**:
```
我的代码报错了,请帮我修复:

错误信息:
KeyError: 'age'

代码:
df = pd.read_csv('patients.csv')
result = df['age'].mean()

数据文件(前几行):
patient_id,name,years_old,gender
P001,张三,45,M

请告诉我:
1. 错误原因
2. 如何修复
3. 如何预防
```

**AI回答**:
```
错误原因:
你的CSV文件中年龄列叫"years_old",但代码中用的是"age"

修复方案1 - 修改代码:
result = df['years_old'].mean()

修复方案2 - 重命名列:
df = df.rename(columns={'years_old': 'age'})
result = df['age'].mean()

预防措施:
# 读取数据后先检查列名
df = pd.read_csv('patients.csv')
print("列名:", df.columns.tolist())  # 养成这个习惯!
```

## 常见错误场景

### 场景1: 数据类型错误

**错误**:
```python
age = "45"
next_year_age = age + 1
# TypeError: can only concatenate str (not "int") to str
```

**向AI求助**:
```
这段代码报错 TypeError,请帮我修复:
age = "45"
next_year_age = age + 1
```

**AI修复**:
```python
age = int("45")  # 转换为整数
next_year_age = age + 1
# 或
age = "45"
next_year_age = int(age) + 1
```

### 场景2: 列表索引错误

**错误**:
```python
patients = ["张三", "李四"]
print(patients[2])
# IndexError: list index out of range
```

**AI建议**:
```python
# 方法1: 检查长度
if len(patients) > 2:
    print(patients[2])
else:
    print("索引超出范围")

# 方法2: 使用异常处理
try:
    print(patients[2])
except IndexError:
    print("患者不存在")
```

### 场景3: 文件编码问题

**错误**:
```python
df = pd.read_csv('患者数据.csv')
# UnicodeDecodeError
```

**AI修复**:
```python
# 尝试不同编码
df = pd.read_csv('患者数据.csv', encoding='gbk')
# 或
df = pd.read_csv('患者数据.csv', encoding='utf-8-sig')
```

## 进阶调试技巧

### 1. 使用AI解释复杂报错

```
RuntimeError: Expected all tensors to be on the same device

请用简单语言解释这个错误是什么意思?
```

### 2. 让AI审查代码逻辑

```
这段代码逻辑有问题吗?

[粘贴代码]

我预期输出X,但实际输出Y
```

### 3. 性能问题调试

```
这段代码处理10万条数据需要5分钟,太慢了:

[粘贴代码]

请帮我找出性能瓶颈并优化
```

## 调试checklist

遇到错误时:

- [ ] 完整复制错误信息(包括traceback)
- [ ] 确认输入数据格式
- [ ] 检查变量类型
- [ ] 打印中间结果调试
- [ ] 向AI提供完整上下文
- [ ] 测试AI的修复方案

## 下一步

[8.5 代码优化:性能与可读性](8.5-optimization.md)
