# 7.5 å®æˆ˜:ç”¨Cursorå¼€å‘æ•°æ®æ¸…æ´—è„šæœ¬

## é¡¹ç›®ç›®æ ‡

å¼€å‘ä¸€ä¸ªå®Œæ•´çš„æ‚£è€…æ•°æ®æ¸…æ´—å·¥å…·,ä»æ··ä¹±æ•°æ®åˆ°å¯ç”¨æ•°æ®é›†ã€‚

## éœ€æ±‚åˆ†æ

**è¾“å…¥**: `raw_patients.xlsx` (åŒ…å«å„ç§é—®é¢˜çš„åŸå§‹æ•°æ®)
**é—®é¢˜**:
- ç¼ºå¤±å€¼
- é‡å¤è®°å½•
- æ ¼å¼ä¸ç»Ÿä¸€
- å¼‚å¸¸å€¼

**è¾“å‡º**: `cleaned_patients.xlsx` (æ ‡å‡†åŒ–çš„æ¸…æ´—æ•°æ®)

## å¼€å‘æ­¥éª¤

### Step 1: åˆ›å»ºé¡¹ç›®

```bash
mkdir patient_data_cleaner
cd patient_data_cleaner
```

ç”¨Cursoræ‰“å¼€æ­¤æ–‡ä»¶å¤¹ã€‚

### Step 2: ä¸AIå¯¹è¯

æŒ‰ `Cmd+L`,è¾“å…¥éœ€æ±‚:

```
æˆ‘è¦å¼€å‘ä¸€ä¸ªPythonè„šæœ¬,æ¸…æ´—æ‚£è€…æ•°æ®:

è¾“å…¥æ–‡ä»¶: raw_patients.xlsx
åˆ—: patient_id, name, age, gender, blood_pressure

éœ€è¦å¤„ç†:
1. åˆ é™¤é‡å¤çš„patient_id
2. å¹´é¾„: å¡«å……ç¼ºå¤±å€¼ä¸ºä¸­ä½æ•°,åˆ é™¤<0æˆ–>120çš„å¼‚å¸¸å€¼
3. æ€§åˆ«: ç»Ÿä¸€ä¸ºM/F,åˆ é™¤å…¶ä»–å€¼
4. è¡€å‹: æ ¼å¼ç»Ÿä¸€ä¸º"120/80",å¤„ç†å¼‚å¸¸æ ¼å¼

è¾“å‡º: cleaned_patients.xlsx

è¦æ±‚:
- ä½¿ç”¨pandas
- æ·»åŠ å®Œæ•´é”™è¯¯å¤„ç†
- æ˜¾ç¤ºæ¸…æ´—å‰åå¯¹æ¯”
- ç”Ÿæˆæ¸…æ´—æ—¥å¿—
```

### Step 3: AIç”Ÿæˆä»£ç 

Cursorä¼šç”Ÿæˆç±»ä¼¼:

```python
import pandas as pd
import re
from datetime import datetime

def clean_patient_data(input_file, output_file):
    """æ¸…æ´—æ‚£è€…æ•°æ®"""

    print("=" * 50)
    print("æ‚£è€…æ•°æ®æ¸…æ´—å·¥å…·")
    print("=" * 50)

    # è¯»å–æ•°æ®
    try:
        df = pd.read_excel(input_file)
        print(f"\nâœ“ æˆåŠŸè¯»å–æ•°æ®: {len(df)}æ¡è®°å½•")
    except FileNotFoundError:
        print(f"âŒ é”™è¯¯: æ‰¾ä¸åˆ°æ–‡ä»¶ {input_file}")
        return
    except Exception as e:
        print(f"âŒ è¯»å–æ–‡ä»¶å‡ºé”™: {e}")
        return

    original_count = len(df)

    # 1. åˆ é™¤é‡å¤è®°å½•
    df = df.drop_duplicates(subset=['patient_id'], keep='first')
    dup_removed = original_count - len(df)
    print(f"\n1. åˆ é™¤é‡å¤è®°å½•: {dup_removed}æ¡")

    # 2. æ¸…æ´—å¹´é¾„
    df['age'] = pd.to_numeric(df['age'], errors='coerce')
    age_median = df['age'].median()
    age_missing = df['age'].isnull().sum()
    df['age'].fillna(age_median, inplace=True)

    # åˆ é™¤å¼‚å¸¸å¹´é¾„
    age_outliers = len(df[(df['age'] < 0) | (df['age'] > 120)])
    df = df[(df['age'] >= 0) & (df['age'] <= 120)]

    print(f"2. å¹´é¾„æ¸…æ´—:")
    print(f"   - å¡«å……ç¼ºå¤±å€¼: {age_missing}ä¸ª (ç”¨ä¸­ä½æ•°{age_median:.0f})")
    print(f"   - åˆ é™¤å¼‚å¸¸å€¼: {age_outliers}ä¸ª")

    # 3. æ¸…æ´—æ€§åˆ«
    df['gender'] = df['gender'].str.upper()
    df['gender'] = df['gender'].map({'M': 'M', 'MALE': 'M',
                                      'F': 'F', 'FEMALE': 'F'})
    gender_invalid = df['gender'].isnull().sum()
    df = df.dropna(subset=['gender'])
    print(f"3. æ€§åˆ«æ¸…æ´—: åˆ é™¤æ— æ•ˆå€¼{gender_invalid}ä¸ª")

    # 4. æ¸…æ´—è¡€å‹
    def clean_bp(bp_str):
        if pd.isnull(bp_str):
            return None
        # æå–æ•°å­—
        numbers = re.findall(r'\d+', str(bp_str))
        if len(numbers) >= 2:
            return f"{numbers[0]}/{numbers[1]}"
        return None

    df['blood_pressure'] = df['blood_pressure'].apply(clean_bp)
    bp_invalid = df['blood_pressure'].isnull().sum()
    df = df.dropna(subset=['blood_pressure'])
    print(f"4. è¡€å‹æ¸…æ´—: åˆ é™¤æ— æ•ˆæ ¼å¼{bp_invalid}ä¸ª")

    # ä¿å­˜ç»“æœ
    try:
        df.to_excel(output_file, index=False)
        print(f"\nâœ“ æ¸…æ´—å®Œæˆ! ä¿å­˜åˆ°: {output_file}")
        print(f"  åŸå§‹è®°å½•: {original_count}æ¡")
        print(f"  æ¸…æ´—å: {len(df)}æ¡")
        print(f"  æ¸…æ´—ç‡: {(1-len(df)/original_count)*100:.1f}%")

        # ç”Ÿæˆæ—¥å¿—
        log_file = f"cleaning_log_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"
        with open(log_file, 'w', encoding='utf-8') as f:
            f.write(f"æ•°æ®æ¸…æ´—æ—¥å¿—\n")
            f.write(f"æ¸…æ´—æ—¶é—´: {datetime.now()}\n")
            f.write(f"åŸå§‹è®°å½•: {original_count}\n")
            f.write(f"æ¸…æ´—å: {len(df)}\n")
        print(f"  æ—¥å¿—å·²ä¿å­˜: {log_file}")

    except Exception as e:
        print(f"âŒ ä¿å­˜æ–‡ä»¶å‡ºé”™: {e}")

if __name__ == "__main__":
    clean_patient_data('raw_patients.xlsx', 'cleaned_patients.xlsx')
```

### Step 4: æµ‹è¯•å’Œä¼˜åŒ–

è¿è¡Œä»£ç ,å¦‚æœé‡åˆ°é—®é¢˜:

```
ğŸ‘¤: è¿è¡Œæ—¶å‘ç°è¡€å‹åˆ—æœ‰"120-80"æ ¼å¼,è¯·æ”¹è¿›æ­£åˆ™è¡¨è¾¾å¼

ğŸ¤– Cursor: (è‡ªåŠ¨ä¿®æ”¹clean_bpå‡½æ•°)
```

## æ‰©å±•åŠŸèƒ½

ç»§ç»­å¯¹è¯,æ·»åŠ æ›´å¤šåŠŸèƒ½:

```
ğŸ‘¤: è¯·æ·»åŠ :
1. ç”ŸæˆHTMLæ¸…æ´—æŠ¥å‘Š
2. å¯è§†åŒ–æ¸…æ´—å‰åå¯¹æ¯”
3. æ”¯æŒå‘½ä»¤è¡Œå‚æ•°
```

AIä¼šç»§ç»­æ‰©å±•ä»£ç ã€‚

## æ€»ç»“

é€šè¿‡Cursor,æˆ‘ä»¬åœ¨30åˆ†é’Ÿå†…:
- âœ… å¼€å‘äº†å®Œæ•´çš„æ•°æ®æ¸…æ´—å·¥å…·
- âœ… åŒ…å«é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… å¯å¤ç”¨äºå…¶ä»–é¡¹ç›®

**å…³é”®**: æè¿°æ¸…æ¥šéœ€æ±‚,è®©AIç”Ÿæˆ,ä½ åªéœ€å®¡æ ¸å’Œæµ‹è¯•!

## æ£€æŸ¥æ¸…å•

- [ ] æˆåŠŸè¿è¡Œæ•°æ®æ¸…æ´—è„šæœ¬
- [ ] ç†è§£æ¯éƒ¨åˆ†ä»£ç é€»è¾‘
- [ ] èƒ½æ ¹æ®éœ€æ±‚è°ƒæ•´å‚æ•°
- [ ] å¯ä»¥æ‰©å±•åˆ°è‡ªå·±çš„æ•°æ®é›†
